---
title: A historical analysis of the evolution of active travel behaviour in Canada
author:
  - name: Alice Anonymous
    email: alice@example.com
    affiliation: Some Institute of Technology
    correspondingauthor: true
    footnote: 1
  - name: Bob Security
    email: bob@example.com
    affiliation: Some Institute of Technology
    footnote: 1
  - name: Cat Memes
    email: cat@example.com
    affiliation: Some Institute of Technology
address:
  - code: Some Institute of Technology
    organization: Big Wig University
    addressline: 1 main street
    city: Gotham
    state: State
    postcode: 123456
    country: United States
footnote:
  - code: 1
    text: "These authors contributed equally to this work."
abstract: |
    Impedance functions are becoming a popular tool for representing travel behaviour because of their potential to capture traveler responses to geographic distance between origins and destinations. Focusing our analysis on active transportation modes in Canadian metropolitan regions, this study has as objectives to provide an historical overview of active mobility in terms of main origins, destinations and travel time of walking and cycling trips, and to identify appropriate impedance functions for active transportation modes considering a wide range of destinations and time periods. To achieve these objectives, this paper analyzed more than 12,000 active transportation episodes from the Canadian General Social Survey (GSS) from 1992 to 2015. 
    This study confirmed that the typical travel time decreased from 15 to 10 minutes for walking trips and from 20 to 15 minutes for cycling trips during the period analyzed. For walking trips, findings indicate that ‘Home’ continues to be the main hub, either as an origin or destination. For cycling trips, the combination of ‘Home’ and ‘Work or school’ accounted for most of the trips. Additionally, we fitted 64 impedance functions for twelve destinations and over 20 years. The results indicate that none of the parameterized functions were exponential, suggesting that the impedance functions commonly used in active accessibility studies may not accurately capture travel behavior, especially for very short trips, giving shorter trips a higher probability of being made. The estimated impedance functions can be employed in active accessibility analysis to help to reduce the dependence on private vehicles and promote healthier, more sustainable travel behaviour.
keywords: 
  - Active mobility
  - Walking
  - Cycling
  - Impedance function
  - Active accessibility
journal: "An awesome journal"
date: "`r Sys.Date()`"
linenumbers: false
numbersections: true
bibliography: mybibfile.bib
biblio-style: elsarticle-harv # author year style for natbib - use 'elsarticle-num' or 'elsarticle-num-names' for numbered scheme
classoption: preprint, 3p, authoryear # remove authoryear is not using `elsarticle-harv`
# Use a CSL with `citation_package = "default"`
# csl: https://www.zotero.org/styles/elsevier-harvard
output: 
  rticles::elsevier_article:
    keep_tex: true
    citation_package: default
---

```{r install-activeCA, include = FALSE}
#install.packages("pak")
#pak::pak("dias-bruno/ActiveCA")
opts <- options(knitr.kable.NA = "")
rm(list=ls())
```

```{r load-packages, include=FALSE, cache=FALSE}
# Load packages
library(ActiveCA)
library(here)
library(dplyr)
library(tidyr)
library(ggplot2)
library(kableExtra)
library(reshape2)
library(rlang)
library(scales)
library(gridExtra)
library(ggpubr)
library(grid)
library(stats)
```

```{r load-data, include = FALSE}
# Load data
data(gss_impedances)
```

```{r renaming-destinations, echo=FALSE, cache=FALSE, include=FALSE}
# Renaming 'dest_label' and 'orig_label' values to reduce table space
gss_impedances_renamed <- gss_impedances %>%
  mutate(dest_label = case_when(
    dest_label == "Grocery store, other stores or mall" ~ "Grocery store",
    dest_label == "Restaurant, bar or club" ~ "Restaurant",
    dest_label == "Sports centre, field or arena" ~ "Sport area",
    dest_label == "Medical, dental or other health clinic" ~ "Health clinic",
    dest_label == "In the neighbourhood" ~ "Neighbourhood",
    dest_label == "Library, museum or theatre" ~ "Cultural venues",
    TRUE ~ dest_label  # Keep all other values as they are
  ), 
  orig_label = case_when(
    orig_label == "Grocery store, other stores or mall" ~ "Grocery store",
    orig_label == "Restaurant, bar or club" ~ "Restaurant",
    orig_label == "Sports centre, field or arena" ~ "Sport area",
    orig_label == "Medical, dental or other health clinic" ~ "Health clinic",
    orig_label == "In the neighbourhood" ~ "Neighbourhood",
    orig_label == "Library, museum or theatre" ~ "Cultural venues",
    TRUE ~ orig_label))
```

# Introduction

The idea that travel behaviour can be influenced by city form has attracted growing interest in urban and transportation planning. Cities intent to encourage residents to adopt more sustainable modes of transportation, such as walking, cycling, and public transit, by developing environments that offer diverse transportation alternatives while simultaneaously improving accessibility - defined as the of reaching destinations and opportunities [@iacono2008access]. Active transportation modes, including walking and cycling, play a important role in enhancing and promoting urban sustainability [@hino2014built; @lamiquiz2015effects], making them central to urban mobility research and policy-making [@handy1993regional; @clifton2001evaluating; @frank2001built; @krizek2005perspectives; @sallis2004active; @vandenbulcke2009mapping; @wu2019measuring]. Walking and cycling accessibility are closely related, jointly contributing to the concept of "active accessibility" or "non-motorized accessibility". when incorporated into urban and transportation planning, they help to reduce the dependence on private vehicles and promote healthier, more sustainable travel behaviour among residents.

There are two main components when measuring accessibility: the location and power of attraction of urban opportunities (trip benefit), and the barrier in travel from the origin to the destination (trip cost). A way for measuring the cost of travel when calculating accessibility is using impedance functions, a methods that is receiving attention from transportation planning scholars, urban geography, and sustainable development [@frank2005linking; @krizek2005perspectives; @currie2010quantifying; @iacono2010; @yang2012walking; @millward2013active; @nassir2016utility; @saghapour2017measuring; @wu2019measuring]. The impedance functions have different forms and all of them serve as a tool to understand the travel behaviour, since they work as measure of the willingness to travel a certain distance to achieve a desired destination, where a service or an opportunity is located [@taylor1975distance; @fotheringham1981spatial; @kwan1998space; @eldridge1991warped; @luoma1993threshold; @papa2012gravity; @yang2012walking; @millward2013active; @vale2017influence]. In this concept, areas with higher accessibility are those characterized by a lower impedance when traveling to desirable destinations. In relation to active accessibility, increasing the distance between two points generally implies in a probability decrease of that trip being done by walking or biking [@hansen1959accessibility; @pirie1979measuring; @handy1997measuring; @geurs2001accessibility; @bhat2002development; @church2003measuring; @kwan2003recent; @geurs2004; @levinson2005access; @cascetta2013new]. However, more information about the willingness of some individuals to walk or cycle greater distance is needed, as well as more data on how distance affects the type and feasibility of the activity, destinations desirability, and the characteristics of those embarking on the trip in different situations. In this context, investigate the evolution and dynamics of impedance function over time becomes important, since they are easily impacted by changes in the transportation network or in urban spatial configurations [@iacono2008access; @iacono2010]. Luoma, Mikkonen, and Palomaki [-@luoma1993threshold] evidenced a decreasing in the distance decay parameter over time in the province of Vaasa, Finland, attributing this trend to improvements and maturation of the transportation system [@luoma1993threshold]. A few years later, Mikkonen and Luoma [-@mikkonen1999parameters] argued that this difference was mainly caused by the establishment of new big retail store units, elucidating the factors behind these temporal patterns in the gravity models patterns [@mikkonen1999parameters].

Since the beginning applications of the gravity-accessibility models, a range of impedance functions have been applied to describe the distribution of walking and cycling trips, wether for general or specific purposes [@iacono2008access; @iacono2010; @larsen2010beyond; @yang2012walking; @millward2013active; @vale2017influence; @li2020approach]. Selecting an appropriate impedance function can be challenging and results in a diverse range of cost decay functions that are employed as impedance functions in accessibility measures, including *threshold functions* (e.g., binary Step Function and multiple Step Function) and *smooth cost decay functions* (e.g., log-normal, normal, gamma, and exponential function) [@de2009exponential; @reggiani2011accessibility; @osth2016new; @itf2017linking]. The variety of functions relies in how scholars approach the influence of distance, with negative exponential distance-decay functions are commonly used in assessing non-motorized accessibility, capturing the willingness of individuals to walk or cycle to destinations [@handy1997measuring; @geurs2001accessibility; @iacono2010; @vega2012using; @millward2013active; @vale2017influence; @li2020approach].

The merit of negative exponential function is due to its ability to assign decreasing influences to more remote opportunities, giving a more accurate estimate for shorter trips [@iacono2010; @kanafani1983transportation; @fotheringham1989spatial]. However, in addition to determine the form of the impedance function, scholars also need to specify the variable used to measure impedance, which can be either time, distance, monetary cost, a combination these last variables or even a generalized cost concept. Among these options, the choice between time and distance as the impedance has been found to be most used based on previous studies [@iacono2010; @hull2012accessibility; @sun2012measuring; @lowry2012using; @vasconcelos2012evaluation], with distance being more adopted in non-motorized applications since extracting accurate travel times from existing network models can be challenging [@handy1997measuring; @iacono2010; @yang2012walking; @arranz2019measuring]. Additionally, estimate impedance function to active transportation modes requires appropriate travel survey data that captures pedestrian and cycle behaviour, resulting in researchers recurring to retrospective questionnaires to assess subjective aspects such as the frequency and duration of walking and cycling activities. Notably, regional household travel surveys that include trips made by non-motorized modes have been employed for this purpose [@iacono2010; @millward2013active]. In opposition to these specific surveys, some data sets provides a nationwide perspective, including travel for different purposes and detailing the trip with valuable information, named episodes, regarding the origins, destinations, and time-based lengths. Besides this type of data can provides a deeper comprehension about the active transportation behaviour, only few studies have examined travel behaviour nationally.

Having presented this context, this paper poses the questions: What is the typical travel time for active transportation modes (walking and cycling) in Canadian metropolitan regions, considering various destinations and years? Which impedance functions best represent active transportation travel behavior? To answer the research questions, this study has as two main objectives: first, to provide an overview of the active transportation in terms of main origins, destinations, and travel time; and second, to identify appropriate impedance functions for active transportation modes for different destinations and time periods in Canadian metropolitan areas. To do achieve both objectives, we utilize data provided by the `ActiveCA` R package [@dossantos2024ActiveCA], an open data product in the form of an R data package with information about active travel in Canada. This data product is based on Public Use Microdata Files of Statistics Canada's General Social Survey (GSS) program with a focus on the Time Use Survey cycles. To build this package, the authors extracted all walking and cycling episodes and their corresponding episode weights for GSS cycles, Cycles 2 (1986), 7 (1992), 12 (1998), 19 (2005), 24 (2010), and 29 (2015), spanning a period of almost thirty years. Origins and destinations were categorized, enabling the investigation of active travel for broad destination categories and purposes.

We recognize that non-work travel encompasses a range of trip purposes and diverse traveler behaviors, which makes impedance functions essential analytical tools for studying non-work accessibility. Grengs [-@grengs2015nonwork] emphasizes the importance of elaborating distinct functions for each travel purpose, a principle that guides this analysis. Our investigation covers a variety of trip purposes, ranging from commutes to homes, workplaces, or educational institutions to social visits, outdoor activities, business trips, shopping, cultural outings to libraries, museums, or theaters, dining out, and engaging in religious practices. Our research aims to enhance the current knowledge about active travel behaviour and provide empirical data about frequency and duration of typical pedestrian and cycling trips for different purposes, by applying the methodology on a nationally representative samples of Canadian residents. Lastly, this analysis seeks to contribute to the ongoing conversation on active transportation, highlighting its role in influencing transportation plans to a more sustainable alternative.

# Background

Accessibility is the main benefit provided by the transportation system [@pereira2017], being understood as the potential to access spatially distributed opportunities [@hansen1959accessibility; @páez2012]. When computing accessibility measure, is necessary take into account the challenges associated with this access to different locations and opportunities. Usually, the effect of travel costs is expressed by "impedance functions", also called "distance decay functions" [@hansen1959accessibility; @koenig1980indicators; @fotheringham1981spatial].

Overall, impedance functions are derived from estimates based on distributions of sample data that reflect variations in the willingness of individuals to travel different distances to reach opportunities [@hsiao1997use; @zhao2003forecasting; @iacono2010; @li2020approach]. Their main objective is to describe the decrease in the intensity of interaction as the cost of travel between locations increases. The cost of travel is usually measured in terms of the distance between the places of origin and destination, or in terms of the time spent reaching the destination from the point of origin.

In fact, distant facilities are less likely to be used compared to closer ones [@hansen1959accessibility; @koenig1980indicators; @fotheringham1981spatial; @skov2001estimation]. Thus, the "distance decay" effect suggests that adding a unit of distance to a long trip is less significant than adding a unit to a shorter trip [@carrothers1956historical], since the farther location already has a lower probability of access for the person willing to travel.

Examining the impedance functions across different modes of transport and destinations is a good way to understand the travel behavior associated with each mode, while also helping to examine allegations about travel behavior. Current interest in creating "livable" communities often relies on broad assumptions about individuals' willingness to walk or bike to different destinations. For example, it is commonly assumed that people are generally willing to walk up to a quarter mile to access most places [@untermann1984accommodating]. Similarly, the recent "15-minute city" concept proposes that the majority of daily necessities should be accessible by walking or cycling within 15 minutes [@moreno2021].

## Impedance functions in accessibility measures

Since the research of Hansen [-@hansen1959accessibility], different categories of accessibility measures have been developed, such as indicators based on actives, infrastructure, individuals and utilities [@geurs2004; @páez2012]. The family of gravity-based accessibility have been widely used in active modes [@miller2005place]. Many gravity-based accessibility measures derive from the work of Hansen [-@hansen1959accessibility], represented in (Equation \ref{eq:accessibility-equation}), in which an impedance function weights opportunities:

```{=tex}
\begin{equation}
A_{i} = \sum_{j=1}^J O_j .f(c_{ij})
\label{eq:accessibility-equation}
\end{equation}
```
The accessibility score $A_{i}$ at each origin $i$ is obtained by summing up the opportunities $O$ available at destination $j$, where $i$ and $j$ are sets of spatial units in a region. However, the number of opportunities in each destination is gradually discounted as travel costs become higher and the the rate at which this weight decreases is determined by a decay function. $f(c_{ij})$ represents the impedance during the trip from origin $i$ to destination $j$ and $c_{ij}$ reflects the generalized travel cost, potentially encompassing factors such as time, distance and effort. In this way, the impedance function $f(c_{ij})$ allows the accessibility analyst to define a measure of travel behavior with precision: the relationship between the "population" at an origin and where they normally want to or can go to reach "opportunities" at destinations. The definition of the impedance function $f(c_{ij})$ is very important from this perspective.

Another type of family of accessibility measures are *cumulative opportunity* metrics, commonly referred to as isochronous indices. The binary function Equation (\ref{eq:cumulative-equation}) forms the basis of the cumulative opportunities maeasure approach. This function determine accessibility by summing up the number of opportunities available within a specific limiar of travel time or distance from a reference point, without discounting the potential of the trip in relation to the associated cost. They use a rectangular function, categorizing the trip as "acceptable" within certain limits and "unacceptable" beyond them. One of the main complexities of these metrics is deciding what the appropriate limiar point is. This decision may be based on the prevailing mobility patterns of the population or may reflect established norms, conventions or informed projections of the researcher. Note that the cumulative opportunity measure can be understood as a special case of a gravity-based measure in which the weight of each opportunity is defined by a binary function, rather than a gradually decaying function [@pereira2023].

```{=tex}
\begin{equation}
C_{ij} =
\begin{cases}
  1 & \text{if } c_{ij} \le x \\
  0 & otherwise
\end{cases}
\label{eq:cumulative-equation}
\end{equation}
```
Among the various mathematical forms that can represent impedance functions, the negative exponential function is the dominant choice in accessibility research [@meyer1984urban; @gutierrez1996european; @kwan1998space; @apparicio2008comparing; @iacono2008access; @iacono2010; @larsen2010beyond; @millward2013active]. Its high adoption can be attributed mainly to its ability to give greater weight to nearby opportunities, and greater weight to distant opportunities - a highly relevant characteristic for active modes of transportation, such as walking and cycling. When Hansen [-@hansen1959accessibility] introduced their accessibility measure, the author applied and indicated the use of exponential distributions $(e ^ {-\beta x})$ as the impedance function. After this, several other studies [@fotheringham1989spatial; @de2009exponential; @iacono2010; @signorino2011gravity; @prins2014many] use the negative exponential function after comparison with empirical trip distribution data.

Researchers can adopt other forms of impedance functions when calculating the distance decay effect in accessibility analysis. One of these options is to adopt a probability density function (PDF) [@soukhov2024]. Using a PDF, $f()$ can be interpreted as the probability density of a trip occurring for each value of travel cost $c_{ij}$. If a graph of the PDF (y-axis) is plotted against the travel cost $c_{ij}$ (x-axis), the probability of a trip occurring between a given range of $c_{ij}$ is the area under the curve. In this case, the total area under the PDF curve always sums to 1, meaning that there is 100% probability that the trip will occur between the minimum and maximum $c_{ij}$.

Dunn et al. [-@dunn2023] presented a set of distributions that serve as PDFs. From their survey, we selected some options for $f()$ commonly used in accessibility research and their impact on the number of opportunities (the sum of opportunities) at specific travel costs $c_{ij}$, namely: uniform, negative exponential, gamma, normal, and lognormal distributions.

-   **Uniform distribution**

The uniform distribution or rectangular PDF looks very similar to the binary function, since it only returns one of two values, but ensure that area under the curve for the range of $c_{ij}$ is 1. The uniform distribution PDF is shown in (Equation \ref{eq:uniform-equation}).

```{=tex}
\begin{equation}
f(c_{ij})^{uniform} =
\begin{cases}
  \frac{1}{c_{max} - c_{min}} & \text{for } c_{min} \le c_{ij} \le c_{max} \\
  0 & \text{otherwise}
\end{cases}
\label{eq:uniform-equation}
\end{equation}
```
The parameters to be calculated are $c_{max}$ and $c_{min}$, which represent the maximum and minimum travel costs that describe the observed or assumed willingness to reach destinations. In this distribution, all values within the interval are equally likely, and all values outside the interval have probability 0, assuming that the population's potential to interact with these opportunities is zero. Usually, $c_{min}$ has value 0.

-   **Exponential distribution**

The exponential distribution PDF equation is given by Equation (\ref{eq:exponential-equation}). This model suggests that impedance decreases exponentially with increasing cost $(c_{ij})$. The parameter $\beta$ represents the decay rate, with higher values indicating a faster decrease in accessibility with increasing cost. As already mentioned, this function is widely used due to its simplicity and ability to model the rapid drop-off in accessibility over distance.

```{=tex}
\begin{equation}
f(c_{ij}) = e^{-\beta c_{ij}} \text{ with } c_{ij} \ge 0
\label{eq:exponential-equation}
\end{equation}
```
-   **Gamma distribution**

The gamma distribution PDF equation is presented by the Equation \ref{eq:gamma-equation}.

```{=tex}
\begin{equation}
f(c_{ij}) = 
   \begin{cases}
\frac{1}{\sigma^\alpha\Gamma(\alpha)} c_{ij}^{\alpha-1} e^{\frac{-c_{ij}}{\sigma}} & \text{if } 0 \leq c_{ij} <      \infty  \text{ and } \alpha, \sigma > 0 \\ 0 & \text{otherwise}
   \end{cases}
\label{eq:gamma-equation}
\end{equation}
```
Where $\Gamma(\alpha)$ is the gamma function to be estimated. In this case, the probability is typically low at low cost, higher at medium cost, and low again at high cost. The higher the $\sigma$ (scale rate) parameter, the higher the probability that the majority of trips will be in the low cost range. So at low values of the $\sigma$ (scale rate) parameter, the same probability is spread over a wider range of travel costs. For the $\alpha$ (shape) parameter, the higher the value, the higher the probability density of trips with a higher average cost [@soukhov2024].

-   **Lognormal distribution**

The normal distribution, also often called the Gaussian distribution, is suitable when the travel cost is found to be distributed normally. The normal distribution has the PDF form displayed in Equation (\ref{eq:normal-equation}).

```{=tex}
\begin{equation}
f(c_{ij}) = \frac{1}{\sqrt{2\pi} \sigma c_{ij}} e^{-\frac{(\ln c_{ij} - \mu)^2}{2\sigma^2}}
\label{eq:normal-equation}
\end{equation}
```
In this equation, $\mu$ and $\sigma$ are the mean and standard deviation of the distribution and need to be estimated together to control the shape of the normal curve. In this distribution, about 68% of the observations will fall within 1 standard deviation of the mean, about 95% will fall within 2 standard deviations, and about 99.7% will fall within 3 standard deviations of the mean. In this case, the values close to the mean will have the highest probability.

-   **Lognormal distribution**

In many cases, the logarithm of the travel cost is found to be distributed normally. The lognormal distribution has the PDF form displayed in Equation (\ref{eq:lognormal-equation}).

```{=tex}
\begin{equation}
f(c_{ij}) = \frac{1}{\sqrt{2\pi} \sigma c_{ij}} e^{-\frac{(\ln c_{ij} - \mu)^2}{2\sigma^2}}
\label{eq:lognormal-equation}
\end{equation}
```
It this equation, $\mu$ and $\sigma$ are the mean and standard deviation of the logarithm, and need to be estimated for together control the shape of the log-normal curve. Similar to the gamma function, the probability is typically low at low cost, higher at medium cost, and low again at high cost.

As the complexity of the PDF increases, so does the flexibility to explain travel behaviour. However, the estimation of the impedance function parameters needs to be calibrated if the accessibility estimates are to be representative of people's travel behaviour. This requires additional travel behaviour data to be used in the calibration process. In our case, we will use the `ActiveCA` package [@dossantos2024ActiveCA] to obtain the impedance functions, as the package contains ready-to-use data from GSS cycles.

## The GSS survey

The GSS provides a comprehensive cross-sectional snapshot of the Canadian population through telephone surveys established in 1985 [@statisticscanada2022]. The survey coverage area includes both metropolitan and non-metropolitan regions, ensuring a diverse and representative sample of the Canadian population. Specifically, the seven provinces and three territories of Canada were divided into distinct geographic strata for sampling purposes. Many Census Metropolitan Areas (CMAs), such as St. John's, Halifax, Saint John, Montreal, Quebec City, Toronto, Ottawa, Hamilton, Winnipeg, Regina, Saskatoon, Calgary, Edmonton, and Vancouver, were treated as separate strata. Additional strata were formed by grouping other CMAs within Quebec, Ontario, and British Columbia, and by categorizing non-CMA areas within each province into their own strata.

These surveys encompass an array of socio-demographic inquiries combined with questions concentrating on specific core themes, such as health, time use, and aspects like social support and aging. One of the standout features of the GSS is its recurring "time use" cycle [@statisticscanada2022], which concentrates in the daily activities of Canadians. This cycle captures the amount of time individuals allocate to various tasks and the sequence, location, and concurrent activities, offering a wide view of Canadians' daily lives. The questions within this cycle have been adapted and refined over the years to reflect the changing dynamics of daily life, ensuring that the data remains pertinent and contemporary.

# Materials and Methods

<!--# I have doubts about how to include the methodology, since the we already preprocessed everything for the ActiveCA. I fear that just mention that we are only analyzing the open-data product will reduce the potential of the paper. -->

To investigate the historical active travel behavior in Canada, we analyzed five GSS Time Use cycles: Cycles 7 (1992), 12 (1998), 19 (2005), 24 (2010), and 29 (2015). We excluded Cycle 2 (1986) from our analysis because this survey did not specify whether the respondent lived in a metropolitan area and did not present cycling as a mode of transportation option, although this cycle is notable for having been the first national random sample to examine Canadian time-use patterns. This paper is a direct application of the ready-to-use data set provided by the `ActiveCA` data package [-@dossantos2024ActiveCA], which is based on the Main and Episode files from the GSS Public Use Microdata Files. The Main file contains questionnaire responses and associated data from participants, while the Episode files provided detailed information about every activity episode reported by the respondents. It is important to mention that this study did not analyze the last Time Use survey released (Cycle 37 of 2022, released in June 2024) because, at the time of publication of the study, the Public Use Microdata Files had not been published.

This methodology involves two main steps, each designed to achieve one of our primary objectives. The first step employs descriptive analysis of active transportation episodes to identify typical travel times across destinations and years. The second step analyzes impedance functions for each combination of cycle, destination, and active travel mode, comparing their temporal evolution and identifying differences in active transportation episodes through statistical tests.

To facilitate collaboration and further analysis, the Rmarkdown code required to obtain these outputs from the raw data files is available on our GitHub repository *(include after the review)*, in line with the best practices of spatial data science [@arribas-bel2021; @páez2021]. These contributions improve our understanding of active travel behaviour in Canada and provide a basis for future research and policy-making.

## Analyzing active travel episodes

For each selected cycle of the GSS surveys, we reviewed the episode files to identify cases with activities listed as walking or cycling, selecting the locations immediately before and after the mobility episode. Doing this, we were able to identify the origin and the destination of the active travel episode. We labeled the code variables with their appropriate descriptions, identifying the transportation mode, activity/reason of the travel, as well the province and urban classification of the respondent's residency (if the respondent lives in a Census Metropolitan Area or in a Census Agglomerations).

Additionally, it was necessary to guarantee the data consistency across the surveys, since they have employed a variety of variable coding schemes. The range of activities and destinations considered in the surveys changed from 1992 to 2015. In 1992, there were only three options of origin/destination location available to the respondent: their home, other's home and work or study. In its turn, the most recent survey (2015) counts with twelve possible destination, including sport area (sports centre, field or arena), restaurant (including bar and club), health clinics (medical, dental or other health clinic), grocery stores (including other types of stores and malls) and more. In order to achieve uniformity, the activity categories from 2005, 2010, and 2015 were synchronised, and a similar process was employed for those from 1992 and 1998. For the preceding years (1992, and 1998), the trip origins and destinations were classified as "Home," "Other's home," and "Work or school." In the subsequent years (2005, 2010, and 2015), these categories were expanded to include "Business," "Restaurant" "Place of worship," "Grocery store" "Neighbourhood," "Outdoors," "Cultural venues" (such as library, museum and theatre), and "Sport area." This evolution in data collection reflects a growing understanding of the complex nature of urban mobility and the diverse purposes that motivate walking and cycling trips, providing a comprehensive foundation for analyzing distance decay and its implications for urban planning and sustainable transportation strategies.

Statistical analysis was used to characterize active travel episodes using cross-tabulations and graphs. Summary statistics and visualization techniques, including median values as a measure of typical value and boxplots, were employed to describe active travel across years, destinations, and transportation modes. To assess the statistical significance of potential temporal differences in the empirical episode data set for each destination, we applied the Kruskal-Wallis test. This test was chosen because it does not assume a normal distribution for the data, an important consideration since we made no assumptions about the distribution of the empirical data. The identification of impedance functions serves as the step that captures the distributional characteristics of the empirical values. The Kruskal-Wallis test evaluates differences in the medians of the empirical data.

## Estimating impedance function parameters

```{r echo=FALSE, cache=FALSE, include=FALSE}
less_than100 <- nrow(gss_impedances_renamed %>% filter(DURATION > 100 & YEAR > 1986))

all_episodes <- nrow(gss_impedances_renamed %>% filter(YEAR > 1986))
```

We applied the `fitdistrplus` package [@delignette2015fitdistrplus] to calculate the best PDF for every destination, mode of transportation and survey year, between the options: uniform, negative exponential, gamma, normal, and lognormal distributions. In order to calculate the impedance functions, two filters were applied in the GSS data set. The first is that we excluded all trips with travel times higher than 100 minutes (1.5 hours). An exploratory data analysis showed that, taking into account all the walking and cycling episodes (`r all_episodes` in total), less than `r round(less_than100/all_episodes, 2)`% of the episodes have a trip duration higher than this limit. It was also possible to know that trips with a duration higher than 100 minutes are mainly composed of hiking and camping episodes. The second filter was realized to select only the population living in a larger urban population centre (a Census Metropolitan Area (CMA) or Census Agglomeration (CA)). We decided to apply this restriction because the travel behaviour of residents of CMA and CA areas tends to be very different from those outside these large urban centres in terms of active travel.

# Results and discusion

## Descriptive analysis of walking and cycling trips from 1992 to 2015

```{r bulding table-01, echo=FALSE, cache=FALSE, include=FALSE}
max_duration <- 100

gss_impedances_renamed <- gss_impedances_renamed %>% 
  filter(DURATION <= max_duration & 
           DURATION > 0 & 
           YEAR > 1986 & 
           Pop_centre %in% c("CMA/CA", "CMA")) %>%
  mutate(WGHT_EPI = ifelse(is.na(WGHT_EPI), 1, WGHT_EPI)) 

gss_summary <- gss_impedances_renamed %>%
     group_by(YEAR, MODE) %>%
     summarise(
         count = n(),
         .groups = "drop") %>%
  rename(Mode = MODE) %>%
  pivot_wider(names_from = YEAR, values_from = count) %>% 
  mutate(Total = rowSums(across(where(is.numeric)), na.rm = TRUE))

gss_summary <- bind_rows(
  gss_summary,
  gss_summary %>%
    summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) %>%  
    mutate(Mode = "Total")
) 

gss_summary <- gss_summary %>% 
  mutate(
    `1992 (%)` = round(`1992` / gss_summary$`1992`[Mode == "Total"] * 100, 2),
    `1998 (%)` = round(`1998` / gss_summary$`1998`[Mode == "Total"] * 100, 2),
    `2005 (%)` = round(`2005` / gss_summary$`2005`[Mode == "Total"] * 100, 2),
    `2010 (%)` = round(`2010` / gss_summary$`2010`[Mode == "Total"] * 100, 2),
    `2015 (%)` = round(`2015` / gss_summary$`2015`[Mode == "Total"] * 100, 2),
    `Total (%)` = round(`Total` / gss_summary$`Total`[Mode == "Total"] * 100, 2)
  ) %>%
  ungroup() %>%
  select("Mode", "1992", "1992 (%)", "1998", "1998 (%)", 
         "2005", "2005 (%)", "2010", "2010 (%)", "2015", "2015 (%)",
         "Total", "Total (%)") 

gss_summary[gss_summary$Mode == 'Total', ]$"1992 (%)" <- round(gss_summary[gss_summary$Mode == 'Total', ]$"1992"/gss_summary[gss_summary$Mode == 'Total', ]$"Total" *100, 2)

gss_summary[gss_summary$Mode == 'Total', ]$"1998 (%)" <- round(gss_summary[gss_summary$Mode == 'Total', ]$"1998"/gss_summary[gss_summary$Mode == 'Total', ]$"Total" *100, 2)

gss_summary[gss_summary$Mode == 'Total', ]$"2005 (%)" <- round(gss_summary[gss_summary$Mode == 'Total', ]$"2005"/gss_summary[gss_summary$Mode == 'Total', ]$"Total" *100, 2)

gss_summary[gss_summary$Mode == 'Total', ]$"2010 (%)" <- round(gss_summary[gss_summary$Mode == 'Total', ]$"2010"/gss_summary[gss_summary$Mode == 'Total', ]$"Total" *100, 2)

gss_summary[gss_summary$Mode == 'Total', ]$"2015 (%)" <- round(gss_summary[gss_summary$Mode == 'Total', ]$"2015"/gss_summary[gss_summary$Mode == 'Total', ]$"Total" *100, 2)


gss_totals_table <- gss_summary %>%
  kable(format = "latex", booktabs = TRUE, longtable = TRUE, 
        caption = "\\label{tab:episodes-count-percentages}Number of episodes identified in each active transportation mode by year",  
        align = c('l', rep('c', ncol(gss_summary) - 1)), 
    col.names = c("Mode","","(%)","","(%)","","(%)","","(%)","","(%)","","(%)")) %>% 
  kable_styling(full_width = FALSE, font_size = 10) %>%
  add_header_above(c(" " = 1, "1992" = 2, "1998" = 2, "2005" = 2, "2010" = 2, "2015"=2, "Total" = 2))
```

After applying the filters to the GSS surveys, we obtained a total of `r gss_summary[gss_summary$Mode == 'Total',]$Total` episodes. Table \ref{tab:episodes-count-percentages} contains the number of episodes about walking and cycling trips between 1992 and 2015, obtained from the GSS cycles. The year 2005 is the year with the most episodes, `r gss_summary[gss_summary$Mode == 'Total',]$'2005'`, representing approximately `r round(gss_summary[gss_summary$Mode == 'Total',]$'2005'/gss_summary[gss_summary$Mode == 'Total',]$Total*100)`% of all active travel episodes. The year 2005 is followed by 2010, with `r gss_summary[gss_summary$Mode == 'Total',]$'2010'` episodes (representing `r round(gss_summary[gss_summary$Mode == 'Total',]$'2010'/gss_summary[gss_summary$Mode == 'Total',]$Total*100)`% of the total), then 2015 (`r gss_summary[gss_summary$Mode == 'Total',]$'2015'` episodes, `r round(gss_summary[gss_summary$Mode == 'Total',]$'2015'/gss_summary[gss_summary$Mode == 'Total',]$Total*100)`% of the total), 1998 `r gss_summary[gss_summary$Mode == 'Total',]$'1998'` episodes, (`r round(gss_summary[gss_summary$Mode == 'Total',]$'1998'/gss_summary[gss_summary$Mode == 'Total',]$Total*100)`% of the total), and 1992, with only `r gss_summary[gss_summary$Mode == 'Total',]$'1992'` episodes, representing `r round(gss_summary[gss_summary$Mode == 'Total',]$'1992'/gss_summary[gss_summary$Mode == 'Total',]$Total*100)`% of the total.

When analyzing the two active transportation modes, walking episodes account for `r round(gss_summary[gss_summary$Mode == 'Walking',]$Total/gss_summary[gss_summary$Mode == 'Total',]$Total * 100)`%, while the remaining `r 100 - round(gss_summary[gss_summary$Mode == 'Walking',]$Total/gss_summary[gss_summary$Mode == 'Total',]$Total * 100)`% are cycling episodes. However, it is worth mentioning that, while in 2015 cycling episodes represented only `r round(gss_summary[gss_summary$Mode == 'Cycling',]$'2015'/gss_summary[gss_summary$Mode == 'Total',]$'2015' * 100)`% of the active travel episodes for that year, in 1992 the cycling episodes represented `r round(gss_summary[gss_summary$Mode == 'Cycling',]$'1992'/gss_summary[gss_summary$Mode == 'Total',]$'1992' * 100)`% - the highest share of this mode across all years. In the next survey (1998), it drops to around `r round(gss_summary[gss_summary$Mode == 'Cycling',]$'1998'/gss_summary[gss_summary$Mode == 'Total',]$'1998' * 100)`%, stabilizing at around 6% thereafter.

```{=html}
<!-- 
Unfortunately is too much work to obtain all the values automatically.
start -->
```

```{r table-01, echo=FALSE, cache=FALSE}
gss_totals_table
```

Tables \ref{tab:table-02} presents statistic on travel time by active transportation mode. The maximum time spent on walking trips varied between 90 and 100 minutes across the years. It is important to remember that trips with duration greater than 100 minutes were excluded from the analysis. The mean walking time also varies, starting at 21 minutes in 1992, dropping to 12 minutes between 1992 to 2010, and increasing again to 16 minutes in 2015. However, it is known that the mean is a statistic that is highly influenced by extreme values. For this reason, we analyze the median travel time, as it is more representative of the typical travel time. The median time spent walking is 15 minutes in 1992, then drops to 5 minutes in 1998 and remains constant at 10 minutes from 2005 to 2015.

```{r table-02, echo=FALSE, cache=FALSE}

# Calculate min, mean, and max statistic (duration)
stats_data <- gss_impedances_renamed %>%
  group_by(YEAR, MODE) %>%
  summarise(
    min = min(DURATION),
    mean = mean(DURATION),
    median = median(DURATION),
    max = max(DURATION),
    std = sd(DURATION),
    .groups = "drop"
  ) %>%
  pivot_longer(cols = c(min, mean, median, max, std), names_to = "Statistic", values_to = "Value") %>%
  pivot_wider(names_from = YEAR, values_from = Value)

# Combine counts and stats into one data frame
stats_data <- stats_data %>%
  mutate(MODE = factor(MODE, levels = c("Walking", "Cycling"))) %>%
  arrange(MODE, Statistic) %>%
  mutate(across(where(is.numeric), ~ round(.x, 0)))

# Rename the 'MODE' column to 'Mode' before generating the table
stats_data <- stats_data %>%
  rename(Mode = MODE) %>%
  dplyr::select(Mode, Statistic, everything()) %>% 
   mutate(Statistic = case_when(
    Statistic == "max" ~ "Maximum",
    Statistic == "min" ~ "Minimum",
    Statistic == "mean" ~ "Mean",
    Statistic == "median" ~ "Median",
    Statistic == "std" ~ "Standard deviation",
    TRUE ~ Statistic  # Keep all other values as they are
  ))
  

# Creating a latex table
styled_table_02 <- stats_data %>%
  kable(format = "latex", booktabs = TRUE, longtable = TRUE, 
        caption = "\\label{tab:table-02}Descriptive statistics for episodes with active transport records",  
        align = c('l', 'l', rep('c', ncol(stats_data) - 2))) %>%
  kable_styling(full_width = FALSE, font_size = 10) %>%
  column_spec(1, bold = TRUE) %>%
  add_header_above(c(" " = 2, "Year" = ncol(stats_data) - 2)) %>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major")

# Print the table
styled_table_02
```

The analysis of travel time statistics alone does not fully explain the reasons behind these fluctuations in travel time over the years. We can affirm, however, that there was a reduction in the time spent walking during the analyzed period, with a one-third reduction in the median walking travel time since 1992.

For cycling trips, the maximum travel time varies from 90 to 100 minutes, similar to walking, except in 1998 when the maximum travel time recorded was 80 minutes. The average cycling travel time is more constant, ranging from 19 minutes in 2005 to 25 minutes in 1992 and 1998. Again, when we analyze the median travel time, we see that the typical cycling travel time dropped from 20 minutes in 1992 to 15 minutes in 2005, 2010, and 2015, possibly reflecting advancements in bicycle technology or changes in cyclists' behaviors.

As highlighted in Figure \ref{fig:figure-boxplot}, over the 30 years studied, the typical duration of walking trips was consistently lower than that of cycling trips. As already mentioned, both medians decayed when compared to 1992, and various factors might have precipitated this trend, such as urban sprawl, increased reliance on motorized transport, or societal preferences for faster modes of transportation.

```{r destination_boxplots, echo=FALSE, cache=FALSE, include=FALSE}
destination_boxplots <- gss_impedances_renamed %>% 
  ggplot(aes(x = as.factor(YEAR), y = DURATION, fill = MODE)) +
  geom_boxplot(position = position_dodge(width = 1),
                size = 0.1,
                outlier.shape = NA,
                outlier.size = 0) +  
theme_bw() +   
facet_wrap(~dest_label) + 
  scale_x_discrete(
    breaks = c(1992, 1998, 2005, 2010, 2015)) +
  labs(
    fill = "Mode",                      
    x = "Year",                          
    y = "Travel time (in minutes)") +
    theme(legend.position="bottom", 
          axis.title.x = element_text(size = 10), 
          axis.title.y = element_text(size = 10),
          legend.title = element_text(size = 10),
          strip.text = element_text(size = 10))


ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/destination_boxplots.jpg"), 
       plot = destination_boxplots,
       width = 12, 
       height = 8, 
       units = "in", 
       dpi = 300)
```

```{r figure-boxplot, echo=FALSE, out.width="100%", fig.cap="Percentage of walking trips categorized by origin and destination"}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/destination_boxplots.jpg"))
```

Figure \ref{fig:figure-destmodeyearperc} shows the percentage of each destination by year and by mode of transport. For all the years analyzed, 'Home' is the most common travel destination, regardless of whether the mode of transport considered is walking or cycling, with levels above 42%. After that, 'Work or school' appears as the second most common destination, especially for journeys by bicycle, with a peak of almost 34% of trips by bicycle in 1998, a high drop to 22% in 2005, rising again to levels close to 30% in 2015. Along with the two destinations already mentioned, 'Other's home' is the only other destination present in the GSS surveys since 1992. This last destination seems to be a destination with a higher share when it comes to walking trips, but for both modes of transportation it seems that respondents are going less and less to other people's homes - a fact that can be explained by new communication technologies, in which a person doesn't need to visit another person's home to keep in touch with them.

```{r destinations-percentual, echo=FALSE, cache=FALSE, include=FALSE}
# Define the order of destinations 
destination_order <- c("Home", "Work or school", "Other's home", "Grocery store", 
                       "Restaurant", "Health clinic", "Outdoors", "Neighbourhood",
                       "Cultural venues", "Place of worship", 
                       "Sport area", "Business")

#my_colors <- kelly(length(destination_order))
my_colors <- c("#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f",
"#ff7f00", "#cab2d6","#6a3d9a","#ffff99","#b15928")

names(my_colors) <- destination_order

destination_percentual <- gss_impedances_renamed %>%
  group_by(MODE, dest_label, YEAR) %>%
  tally() %>%
  group_by(MODE, YEAR) %>%
  mutate(percentage = n / sum(n) * 100) %>%
  ungroup() %>%
  group_by(MODE, YEAR) %>%
  mutate(rank = rank(-percentage, ties.method = "first")) %>%
  mutate(label = ifelse(rank <= 5, paste0(round(percentage, 1), "%"), NA)) %>%
  ggplot(aes(x = MODE, fill = dest_label, y = percentage)) +
  geom_bar(stat = "identity", position = "fill") +
  labs(y = "Proportion (%)",
       x = "Mode",
       fill = "Destination") +
  theme_minimal() + 
  facet_wrap(~ as.factor(YEAR)) +
  geom_text(aes(label = label), 
            position = position_fill(vjust = 0.5), size = 3) +
  scale_fill_manual(values = my_colors)

ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/destination_percentual.jpg"), 
       plot = destination_percentual,
       width = 12, 
       height = 8, 
       units = "in", 
       dpi = 300)
```

```{r figure-destmodeyearperc, echo=FALSE, out.width="100%", fig.cap="Percentage of walking and cycling trips categorized by destination and year"}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/destination_percentual.jpg"))
```

After 2005, the expansion of the destination highlights some new popular locations. For example, 'Grocery store' appears as the third most chosen destination, varying from 10% in 2005 to 6.5% in 2015 for cycling trips and from 13.3% to 12.6% for walking trips. When considering walking trips, 'Restaurants' appears as another well chosen destination and, in the case of cycling trips, 'Outdoors' appears as a well chosen destination.

```{=html}
<!-- 
Decided to not include the following tables because I transformed them into figures 
start -->
```

```{r table-03X, echo=FALSE, cache=FALSE, warning=FALSE, results="asis", include = FALSE}
# Filter for selected years and calculate statistics of trip duration
episodes_stats_before <- gss_impedances_renamed %>%
  filter(YEAR < 2005) %>%
  group_by(YEAR, dest_label, MODE) %>%
  summarise(
    count = n(),
    min = min(DURATION),
    median = median(DURATION),
    max = max(DURATION),
    .groups = "drop"
  )

# Calculate percentages of trips by mode/year 
total_counts <- episodes_stats_before %>% 
  group_by(YEAR, MODE) %>% 
  summarise(total_count = sum(count), 
            .groups = "drop")

episodes_stats_before <- left_join(episodes_stats_before, total_counts, by = c("YEAR", "MODE"))

episodes_stats_before$Percentage <- round((episodes_stats_before$count / episodes_stats_before$total_count) * 100, 1)

# Pivot data for the table layout
wide_data <- episodes_stats_before %>%
  pivot_wider(
    id_cols = c(dest_label, MODE),
    names_from = YEAR,
    values_from = c(min, median, max, Percentage)
  )  %>% 
  arrange(MODE, dest_label, desc(Percentage_1998))

wide_data <- wide_data %>%
  group_by(MODE) %>%
  mutate(MODE = if_else(row_number() == 2, as.character(MODE), "")) %>%
  ungroup() %>%
 dplyr::select(
    dest_label, MODE, min_1992, median_1992, max_1992, Percentage_1992,
    min_1998, median_1998, max_1998, Percentage_1998
  )

# Latex table
styled_table_03 <- wide_data %>%
  kable(
    format = "latex", 
    booktabs = TRUE, 
    longtable = TRUE, 
    align = c(rep("c", ncol(wide_data))),
    caption = "\\label{tab:table-03}Comparison of travel statistics by mode and destination: 1986, 1992, 1998",
    col.names = c("Destination", "Mode*","Min*","Med*","Max*", "(%)*",  "Min","Med","Max", "(%)")
  ) %>%
  kable_styling(full_width = FALSE, 
                #latex_options=c("striped", "scale_down"), 
                latex_options=c("scale_down"),
                 font_size = 6) %>%
  # column_spec(1, width = "1cm") %>%  # Set width of 'Dest' column to 1.5cm
  # column_spec(2:14, width = "0.5cm") %>%  # Set width of remaining columns to 0.7cm
  add_header_above(c(" " = 2, "1992" = 4, "1998" = 4)) %>%
  row_spec(0, bold = TRUE, align = "c") %>%
  column_spec(6, border_right = TRUE) %>%
  footnote(general = c("* The symbols used in this table represent the following: `Min` denotes the minimum time to reach the destination; `Max` denotes the maximum time to reach the destination; `(%)` indicates a percentage of the total time to reach the destination; `Med` refers to the median time to reach the destination"), threeparttable = T)

styled_table_03 
```

```{r table-04X,echo=FALSE, cache=FALSE, warning=FALSE, include = FALSE}
# Selecting surveys after 2000 and calculating trip duration statistics 
episodes_stats_after <- gss_impedances_renamed %>%
  filter(YEAR > 2000) %>%
  group_by(YEAR, dest_label, MODE) %>%
  summarise(
    count = n(),
    min = min(DURATION),
    median = median(DURATION),
    max = max(DURATION),
    .groups = "drop"
  )

# Calculate percentages of trips by mode/year
total_counts <- episodes_stats_after %>% group_by(YEAR, MODE) %>% summarise(total_count = sum(count), .groups = "drop")
episodes_stats_after <- left_join(episodes_stats_after, total_counts, by = c("YEAR", "MODE"))
episodes_stats_after$Percentage <- round((episodes_stats_after$count / episodes_stats_after$total_count) * 100, 1)

# Pivot data for the table layout
wide_data <- episodes_stats_after %>%
  pivot_wider(
    id_cols = c(dest_label, MODE),
    names_from = YEAR,
    values_from = c(min, median, max, Percentage)
  ) %>%
 dplyr::select(
    dest_label, MODE,
    min_2005, median_2005, max_2005, Percentage_2005,
    min_2010, median_2010, max_2010, Percentage_2010,
    min_2015, median_2015, max_2015, Percentage_2015
  ) %>% 
  arrange(MODE, dest_label, desc(Percentage_2015)) %>%
   group_by(MODE) %>%
   mutate(MODE = if_else(row_number() == 2, as.character(MODE), "")) %>%
   ungroup()

# Latex table
styled_table_04 <- wide_data %>%
  kable(
    format = "latex", 
    booktabs = TRUE, 
    longtable = TRUE, 
    align = c(rep("c", ncol(wide_data))),
    caption = "\\label{tab:table-04}Comparison of travel statistics by mode and destination: 2005, 2010, 2015",
    col.names = c("Destination", "Mode*","Min*","Med*","Max*", "(%)*", "Min","Med","Max", "(%)", "Min","Med","Max", "(%)")
  ) %>%
  kable_styling(full_width = FALSE, 
                #latex_options=c("striped", "scale_down"), 
                latex_options=c("scale_down"),
                font_size = 6) %>%
  column_spec(1, width = "2cm") %>%  # Set width of 'Dest' column to 1.5cm
  column_spec(2:14, width = "0.4cm") %>%  # Set width of remaining columns to 0.7cm
  add_header_above(c(" " = 2, "2005" = 4, "2010" = 4, "2015" = 4)) %>%
  row_spec(0, bold = TRUE, align = "c") %>%
  column_spec(6, border_right = TRUE) %>%
  column_spec(10, border_right = TRUE) %>% 
  footnote(general = c("* The symbols used in this table represent the following: `Min` denotes the minimum time to reach the destination; `Max` denotes the maximum time to reach the destination; `(%)` indicates a percentage of the total time to reach the destination; `Med` refers to the median time to reach the destination"), threeparttable = T)

styled_table_04
```

```{=html}
<!-- 
Decided to not include the following tables because I transformed them into figures 
start -->
```
Figure \ref{fig:figure-boxplot} present the box plot graphs showing the travel time distribution for active transportation modes over the years, categorized by destination. Some destinations are presented in only one survey, such as 'Sport area', 'Neighbourhood,' and 'Business'. These new destination exhibit typical walking travel times 10 minutes. For cycling trips, 'Business' recorded no trips, while 'Sport area' and 'Neighbourhood' registered typical travel times of 30 and 15 minutes, respectively.

For destinations included in more than one survey, we can compare the temporal evolution of travel times. Starting with the walking trips, we can note that there is a tendency of increasing travel times for 'Restaurants' and 'Outdoors' (both increasing from 5 in 2005 to 10 minutes in 2015) and 'Place of worship' (rising from 10 in 2005 to 15 minutes in 2015). In contrast, some destinations presented a decline in travel times, where the case of 'Cultural venues,' which had a median travel time of 2005 and drop to 5 minutes in 2015, and 'Home' which start the time series with a minutes in 1992 and dropped to 10 minutes by 2015. Other destinations maintained an almost constant travel time. In general, while 'Place of worship' displayed the maximum median travel time of 15 minutes, the general median walking time cuttoff appears to be 10 minutes, with most of trips occurring below this limit.

For cycling trips, an increasing trend in travel times is evident for destinations such the destinations 'Grocery store' (rising from 10 to 15 minutes between 2005 and 2015), 'Outdoors' (increasing from 15 in 2005 to 20 minutes in 2015), and 'Home' (retuning to the 1992 typical travel time of 20 minutes after dropping to 10 minutes in 2010). However, travel times decreased for destinations like 'Other's home' and 'Place of worship', where the typical cycling travel time declined from 20 minutes in their first recorded surveys to 15 minutes by 2015. Other destinations remained with a constant travel time.

Figures \ref{fig:walking-heatmap} and \ref{fig:cycling-heatmap} show walking and cycling trips from 1992 to 2015 through heat maps. These maps use color gradients to represent the percentage of trips between origins and destinations, with darker colors indicating higher percentages and lighter colors representing less frequent routes. In 1992, walking trips with 'Home' as both the origin and destination made up the majority, accounting for almost 31% of all walking trips. These trips often involved leisure activities, like short walks or dog walking. Following this, trips from 'Home' to 'Work or school' comprised 18% of walking trips. Overall, 'Home' is the principal hub, either as an origin or destination, with only 5% of trips not involving 'Home.' By 1998, more than half of walking trips were between 'Home' and 'Other's home,' with 'Home' to 'Other's home' and 'Other's home' to 'Home' each representing 26% of trips. During this year, 'Home' to 'Home' accounted for only 10% of trips. In 2005, trips with origins or destinations involving 'Home' and 'Work or school' remained as the most common, but the introduction of new destinations led to a more dispersed trip distribution. Together, these two combinations accounted for 25% of all trips. In 2010, trips between 'Home' and 'Work or school' continued as the most common type, representing 18% of trips, tied with trips from 'Grocery store' to 'Home' (9%). Finishing the walking trip descriptive analysis, in 2015, the highest proportion of trips were from 'Home' to 'Work or school' (12%) and vice versa (11%). Trips from 'Home' to 'Home' accounted for 8% of trips, and 'Grocery store' became a notable destination for trips originating from 'Home' (8%).

```{r make-figs-heatmaps, include=FALSE}
# Walking heat map
walking_hm_fig <- gss_impedances_renamed %>%
  filter(MODE == 'Walking') %>%
  group_by(orig_label, dest_label, YEAR) %>%
  summarize(n = n(),
  .groups = "drop") %>%
  group_by(YEAR) %>%
  mutate(percentage = n / sum(n) * 100) %>%
  ungroup() %>%
  ggplot(aes(x = dest_label,
    y = orig_label)) +
    geom_tile(aes(fill = percentage)) +
    labs(x = "Destination",
    y = "Origin",
    fill = "Percentage (%)") + 
    theme_bw() + 
    scale_fill_gradientn(colors = RColorBrewer::brewer.pal(9, "YlOrRd")) +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + 
    facet_wrap(~YEAR)

# Save the combined plot to a file
ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/walking_hm_fig.jpg"), 
       plot = walking_hm_fig,
       width = 8, 
       height = 5, 
       units = "in", 
       dpi = 300)

# Cycling heat map
cycling_hm_fig <- gss_impedances_renamed %>%
  filter(MODE == 'Cycling') %>%
  group_by(orig_label, dest_label, YEAR) %>%
  summarize(n = n(),
  .groups = "drop") %>%
  group_by(YEAR) %>%
  mutate(percentage = n / sum(n) * 100) %>%
  ungroup() %>%
  ggplot(aes(x = dest_label,
    y = orig_label)) +
    geom_tile(aes(fill = percentage)) +
    labs(x = "Destination",
    y = "Origin",
    fill = "Percentage (%)") + 
    theme_bw() + 
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + 
    scale_fill_gradientn(colors = RColorBrewer::brewer.pal(9, "YlOrRd")) +
    facet_wrap(~YEAR)

# Save the combined plot to a file
ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/cycling_hm_fig.jpg"), 
       plot = cycling_hm_fig,
       width = 8, 
       height = 5, 
       units = "in", 
       dpi = 300)
```

```{r walking-heatmap, echo=FALSE, out.width="100%", fig.cap="Percentage of walking trips categorized by origin and destination"}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/walking_hm_fig.jpg"))
```

```{r cycling-heatmap, echo=FALSE, out.width="100%", fig.cap="Percentage of walking trips categorized by origin and destination"}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/cycling_hm_fig.jpg"))
```

For cycling trips (Figure \ref{fig:cycling-heatmap}), in 1992, the most common trip was from 'Home' to 'Work or school' (26%), followed by trips from 'Other's home' to 'Home' (22%). In all following years, the most frequent trip were between 'Home' and 'Work or school' in both direction. This combination accounted for 65% of the trips in 1998, 40% in 2005, 52% in 2010, and 58% in 2015. Additionally and unlike walking trips, 'Home' to 'Home' trips were not a common cycling trip in any of the surveys. This suggests that leisure trips, such as activities around the home, are predominantly done by foot rather than by bicycle.

We analyzed whether the temporal differences in travel times for the destinations had statistical significance. Only destinations that appear in more than one year can have their temporal evolution analyzed. Therefore, from the twelve possible destinations, in the cycling mode only seven locations can be temporally analyzed: 'Cultural venues,' 'Grocery store,' 'Home,' 'Other's home,' 'Outdoors,' 'Restaurant,' and 'Work or school.' In the case of walking trips, it is possible to include 'Place of worship' to the previous destination list.

After performing the Kruskal-Wallis test (to assess whether there was a statistically significant difference between the distributions of empirical travel time values, considering the time differences for each destination) and the pairwise Wilcoxon test, we were able to identify the destinations where a statistically significant difference was detected. Table \ref{tab:result-stats} shows only the destinations where a statistically significant difference was found, considering the two modes of active transport analyzed.

For cycling trips, the destinations "Home," "Grocery store," "Restaurant," and "Work or school" had at least one year with a statistically significant difference. For example, for the "Home" destination, there was a statistically significant difference between 1992 and 2005 (p-value = 0.0046), 1992 and 2010 (p-value = 0.0003), 1998 and 2005 (p-value = 0.0390), 1998 and 2010 (p-value = 0.0412), 1998 and 2015 (p-value = 0.0196), 2005 and 2010 (p-value = 0.00017), and 2010 and 2015 (p-value = 0.01008). This result indicates that the previously discussed decrease in the typical cycling travel time for home destinations is statistically significant.

For walking trips, among the destinations with a potential time difference, only "Cultural venues" did not show a statistically significant difference during the period analyzed. As a result, among the destinations appearing in more than one GSS survey, only "Cultural venues" showed no statistical evidence of temporal evolution for any of the modes of transport. Four destinations ("Home," "Grocery store," "Restaurant," and "Work or school") exhibited statistical differences for both modes of transport.

```{r kruskal-walking, include = FALSE, warning= FALSE}
result_kw <- data.frame()
anos_possiveis <- c("1992", "1998", "2005", "2010", "2015")
result_pw <- data.frame(matrix(ncol = length(anos_possiveis) + 2, nrow = 0))
colnames(result_pw) <- c(anos_possiveis, "Mode", "Destination")

# for(mode in unique(theoretical_values$MODE)){
  
#  for(destino in unique(theoretical_values[theoretical_values$MODE == mode, ]$dest_label)){
    
#    subset <- theoretical_values[theoretical_values$MODE == mode & theoretical_values$dest_label == destino, ]
    
for(mode in unique(gss_impedances_renamed$MODE)){
  
  for(destino in unique(gss_impedances_renamed[gss_impedances_renamed$MODE == mode, ]$dest_label)){
    
    subset <- gss_impedances_renamed[gss_impedances_renamed$MODE == mode & gss_impedances_renamed$dest_label == destino, ]
    
    if(length(unique(subset$YEAR)) > 1){
      
    kw <- kruskal.test(f ~ YEAR, data = subset)
    
    pv_analise <- ifelse(kw$p.value <= 0.05, 'Significant', 'Not significant')
    
    kw_df <- data.frame("Mode" = mode, "Destination" = destino, "KWpvalue" = kw$p.value, "pvalue" = pv_analise)
    
    result_kw <- rbind(result_kw, kw_df)  
    
    if(kw$p.value <= 0.05){
      
      pw <- pairwise.wilcox.test(subset$f, subset$YEAR, p.adjust.method = "bonferroni")
      
      pf_df <- as.data.frame(pw$p.value)

      for (ano in anos_possiveis) {
    if (!(ano %in% colnames(pf_df))) {
      pf_df[[ano]] <- NA  
    }
  }
  
  pf_df <- pf_df[, anos_possiveis, drop = FALSE]
  
  pf_df$Mode <- mode
  pf_df$Destination <- destino
  
  
  result_pw <- rbind(result_pw, pf_df)
    }
      
    }
  }
}

result_pw$Year <- substr(rownames(result_pw), 1, 4)
rownames(result_pw) <- NULL

result_pw <- result_pw %>%
  filter(rowSums(select(., `1992`:`2015`) <= 0.05, na.rm = TRUE) > 0) %>%
  mutate(across(where(is.numeric), ~ round(.x, 5)))

result_pw <- result_pw[, colSums(!is.na(result_pw)) > 0]

result_pw <- result_pw[,c("Mode","Destination","Year","1992","1998","2005","2010")]

result_pw <- result_pw %>%
  mutate(across(where(is.numeric), ~ ifelse(. > 0.05, NA, .)))

table_stats <- result_pw %>% 
  kable(format = "latex",
        booktabs = TRUE,
        caption = paste0("\\label{tab:result-stats}P-values of the pairwise Wilcoxon test .")) %>% 
    kable_styling(full_width = FALSE, 
                latex_options=c("scale_down"),
                font_size = 10) %>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major")
```

```{r pvalues-table,echo=FALSE, cache=FALSE, warning=FALSE}
table_stats
```

## Calibrated impedance function

This section presents the identified impedance functions for walking and cycling trips to various destinations across Canadian Metropolitan and Census Agglomeration Areas from 1992 to 2015. In general, the impedance functions aim to capture transportation behavior, illustrating that the likelihood of traveling between two points decreases as travel duration increases. Each impedance function follows one of the mathematical equations previously mentioned, enabling the plotting of PDF curves. These curves also highlight critical points at which a person's tendency to walk or cycle significantly decreases.

As explained in the methodology section, we used the `fitdistrplus` package [@delignette2015fitdistrplus] to calibrate the functions. We selected the best impedance function for each transportation mode, destination, and year based on the lowest Akaike Information Criterion (AIC) value [@akaike1974]. The AIC metric not only assesses the goodness of fit but also penalizes model complexity to prevent overfitting. AIC provides a balance between a model's accuracy and simplicity, with lower values indicating a more economical model. The distribution with the lowest AIC was considered the most suitable for representing the distance decay curve for each specific destination in each year. We chose AIC as the selection criterion because, while the `fitdistrplus` package accommodates weighted episodes during estimation, it does not extend this functionality to diagnostic plots, which are typically unweighted and traditionally used to select the best-fitting function.

```{r selected_functions,echo=FALSE, cache=FALSE, warning=FALSE, include=FALSE}
selected_functions <- gss_impedances_renamed %>% 
  group_by(MODE, YEAR, dest_label) %>% 
  summarise(Function = first(f_name), 
            est_1 = first(est_1),
            est_2 = first(est_2),
            AIC = first(aic),
            f_name = first(f_name),
            count = first(count),
            .groups = "drop") %>% 
  mutate(Function = case_when(
    Function == "lnorm" ~ "Lognormal",
    Function == "gamma" ~ "Gamma",
    Function == "unif" ~ "Uniform",
    TRUE ~ Function), 
  across(c(est_1,est_2), ~ round(., digits = 2)), 
  across(c(AIC), ~ round(., digits = 0))) %>% 
  rename(Mode = MODE, Year = YEAR, Destination = dest_label)

walking_functions_table <- selected_functions %>%
  arrange(Year, Destination) %>% 
  filter(Mode == 'Walking') %>% 
  select(Year, Destination, Function,est_1,est_2, AIC, count) %>%
  kable(format = "latex",
        booktabs = TRUE,
        caption = paste0("\\label{tab:walking-functions-tab}Impedance functions and AIC for walking trips."), 
        col.names = c("Year", "Destination", "Impedance function","Parameter 1*","Parameter 2*", "AIC", "Count")) %>%
    kable_styling(full_width = FALSE, 
                latex_options=c("scale_down"),
                font_size = 10) %>% 
  row_spec(0, bold = TRUE, align = "c") %>% 
  collapse_rows(columns = 1, valign = "top", latex_hline = "major") %>%
  footnote(general = c("For 'lnorm' distributions, 'Parameter 1' and 'Parameter 2' refer to the mean and standard deviation of the distribution on the logarithmic scaler, respectively. For the 'Gamma' distribution, 'Parameter 1' and 'Parameter 2' refer to the rate and shape of the distribution, respectively. For the 'Uniform' distribution,  'Parameter 1' refers to the minimum lower bound and 'Parameter 2'  refers to the upper bound (maximum) of the distribution.  'AIC' means Akaike information criterion."), threeparttable = T)

biking_functions_table <- selected_functions %>%
  arrange(Year, Destination) %>% 
  filter(Mode == 'Cycling') %>% 
  select(Year, Destination, Function, est_1, est_2, AIC, count) %>%
  kable(format = "latex",
        booktabs = TRUE,
        caption = paste0("\\label{tab:cycling-functions-tab}Impedance functions and AIC for cycling trips."), 
        col.names = c("Year", "Destination", "Impedance function","Parameter 1*","Parameter 2*", "AIC", "Count")) %>% 
    kable_styling(full_width = FALSE, 
                latex_options=c("scale_down"),
                font_size = 10) %>% 
  row_spec(0, bold = TRUE, align = "c") %>% 
  collapse_rows(columns = 1, valign = "top", latex_hline = "major") %>%
  footnote(general = c("For 'lnorm' distributions, 'Parameter 1' and 'Parameter 2' refer to the mean and standard deviation of the distribution on the logarithmic scaler, respectively. For the 'Gamma' distribution, 'Parameter 1' and 'Parameter 2' refer to the rate and shape of the distribution, respectively. For the 'Uniform' distribution,  'Parameter 1' refers to the minimum lower bound and 'Parameter 2'  refers to the upper bound (maximum) of the distribution.  'AIC' means Akaike information criterion."), threeparttable = T)
```

In total, we fitted `r nrow(selected_functions)` impedance functions. Among the candidate distributions, only the lognormal, gamma, and uniform distributions were selected, with the uniform distribution being chosen exclusively for certain cycling destinations. The absence of exponential functions, given the variety of destinations, year and mode of transport, indicates that the impedance functions applied in active accessibility studies may not be adequately measuring travel behavior, especially for cases when the travel time is close to 0 minute. Table \ref{tab:walking-functions-tab} displays the selected functions for walking trips, while Table \ref{tab:cycling-functions-tab} presents the functions for cycling trips. Appendix A includes the AIC, BIC, and log-likelihood values for all candidate distributions.

<!--# Criar um appendix que demonstre os valores de AIC para as funcoes nao selecionadas. Ou nao.  -->

```{r walking_functions_table,echo=FALSE, cache=FALSE, warning=FALSE}

walking_functions_table
```

```{r biking_functions_table,echo=FALSE, cache=FALSE, warning=FALSE}

biking_functions_table
```

Figure \ref{fig:outdoors-impedance-fig} presents the calibrated functions for the destination 'Outdoors,' along with a histogram of the empirical distribution of trips, split by year and transportation mode. Comparing functions from different categories can be difficult when analyzed for the first time, but by starting with the functions from the walking transportation mode, the calibrated functions from this example show a similar pattern. At a duration of around zero minutes, the probability of making the trip is low (with a density of zero for the years 2010 and 2015). After a few minutes, there is a peak in the maximum probability of traveling to reach 'Outdoors,' followed by a drop in willingness to zero for very high values of time, indicating a low probability of making the trip.

For the years 2005 and 2010, the selected impedance functions are of the gamma type, with shapes of $\alpha = 1.24$ and $\alpha = 1.27$, respectively, and the same rate of $\sigma = 0.13$. The rate parameter ($\sigma$) mainly controls the speed of the curved drop, which is the same for both years. The shape parameter ($\mu$) controls how the density peak shifts in relation to the $x$-axis (the travel time). A larger shape value means that the probability peak occurs at larger values of time. Since the shape values for 2005 and 2010 are very close, the peak of the PDF curve in both cases occurs at 2 minutes. Although the difference in shape ($\mu$) between the two years is small and does not change the time at which the peak occurs, it is enough to cause a difference in the peak values themselves. In 2005, the walking trips had a higher density around 2 minutes (0.079) compared to 2010 (0.077).

For 2015, the PDF that best represents the population's transport behavior is a lognormal distribution, with a mean of $\mu = 3.08$ and a standard deviation of $\sigma = 0.80$. In this year, the density peak (0.05) occurs when the journey has the duration of 7 minutes. Here, we can see that a lower density peak also corresponds to a more dispersed curve, with higher densities at larger values of time. In fact, while in 2005 and 2010 walking trips had densities close to zero for values over 50 minutes, in 2015 there is still a small density (0.002) at the 50-minute mark.

For trips made by bicycle, in 2015 and 2010 the impedance functions are of the gamma type, with a shape of $\alpha = 2.99$ and $\alpha = 2.05$, respectively, and rates $\sigma = 0.17$ and $\sigma = 0.59$. Such configurations in the gamma function result in different peak values, where in 2005 the peak (0.046) of density occurred in 12 minutes, in 2010 the peak (0.102) occurs in 6 minutes, half the previous time. In 2005, the curve has a smaller peak and is more dispersed, while in 2010 the curve has a higher peak and is less dispersed, reinforced by its higher rate ($\sigma$).

In 2005, the PDF that best represented the curve was a uniform function with upper bound equals to 35 minutes and peak of (0.028). The presence of uniform functions means that it wasn't possible to parameterize more complex functions (like the other functions) and is explained by the low number of episodes in this category of destination, mode of transport and year (in this case, there were only 3 episodes identified). Overall, all the uniform functions have a maximum of 6 episodes and all of them are for the transportation mode cycling - which can be explained since this mode of transport doesn't have many episodes compared to the walking episodes (only 7% of active travel episodes). The figure also shows how cycling trips tend to have greater dispersion and higher typical values (dashed vertical lines) when compared to walking trips.

```{r mean_functions, include = FALSE}
mean_functions <- selected_functions %>% 
  group_by(Function) %>%
  summarise(mean = mean(count))

mean_gamma <- round(mean_functions[mean_functions$Function == 'Gamma', ]$mean)
mean_uniform <- round(mean_functions[mean_functions$Function == 'Uniform', ]$mean)
mean_lognormal <- round(mean_functions[mean_functions$Function == 'Lognormal', ]$mean)
```

The complexity of the impedance function will depend of the amount of episodes available to perform the calibration. For instance, to fit a gamma type function was necessary an average of `r mean_gamma` episodes, and to fit a lognormal type function, it was necessary around `r mean_lognormal` episodes. In contrast, to fit an uniform function it was required only `r mean_uniform` in average.

```{r theoretical_impedance_values, include = FALSE}
theoretical_impedance <- function(df_functions, travel_cost) {
  
  # Initialize the main data frame to store results
  result <- data.frame()
  
  # Create the 't' sequence
  t_seq <- seq(1, travel_cost, 1)
  
  for (mode in unique(df_functions$Mode)){
    
    for (year in unique(df_functions[df_functions$Mode == mode, ]$Year)){ 
      
      for (destino in unique(df_functions[df_functions$Year == year & df_functions$Mode == mode, ]$Destination)){
        
      name_function <- df_functions[df_functions$Year == year & 
                                      df_functions$Mode == mode & 
                                      df_functions$Destination == destino, ]$f_name
      
      print(paste0("YEAR: ", year, " MODE: ", mode," Destination: ", destino))
      
      subset <- df_functions %>% 
        filter(Year == year & Mode == mode & Destination == destino)
      
      # Temporary data frame for this iteration
      temp_df <- data.frame(t = t_seq)
      
      # Add the appropriate distribution
      if (name_function == "lnorm") {
        temp_df$f <- dlnorm(temp_df$t,
                            meanlog = subset$est_1[1],
                            sdlog = subset$est_2[1])
        
      } else if (name_function == "gamma") {  
        temp_df$f <- dgamma(temp_df$t,
                            shape = subset$est_1[1],
                            rate = subset$est_2[1])
        
      } else if (name_function == "norm") {  
        temp_df$f <- dnorm(temp_df$t,
                           mean = subset$est_1[1],
                           sd = subset$est_2[1])
        
      } else if (name_function == "exp") {  
        temp_df$f <- dexp(temp_df$t,
                          rate = subset$est_1[1])
        
      } else if (name_function == "unif") {  
        temp_df$f <- dunif(temp_df$t,
                           min = subset$est_1[1],
                           max = subset$est_2[1])
      }
      
      # Add mode, year and destination columns
      temp_df$MODE <- mode
      temp_df$YEAR <- year
      temp_df$dest_label <- destino
        
      # Append to the result data frame
      result <- rbind(result, temp_df)
    }
  }
}
  return(result)
}

theoretical_values <- theoretical_impedance(selected_functions, travel_cost = max_duration)
```

```{r include = FALSE}

for(destino in unique(gss_impedances_renamed$dest_label)){
  
  medianas <- gss_impedances_renamed %>%
    filter(dest_label == destino) %>%
    group_by(MODE) %>%
    summarise(mediana_duracao = median(DURATION, na.rm = TRUE), .groups = 'drop')
  
  maximos <- theoretical_values %>%
    filter(dest_label == destino) %>%
    group_by(MODE, YEAR) %>%
    filter(f == max(f)) %>%
    slice(which.max(t)) %>%
    ungroup()
  
combined_plot <- gss_impedances_renamed %>% 
  filter(dest_label == destino) %>%
  mutate(dest_label = factor(dest_label, levels = destination_order)) %>%
  ggplot(aes(x= DURATION)) +
  geom_histogram(aes(y = ..density.., colour = MODE, fill = MODE), bins = 20, alpha=0.1, position="identity") + 
  geom_line(data = theoretical_values[theoretical_values$dest_label == destino, ], aes(x = t, y = f, colour = MODE), size = 0.8) +   
  geom_vline(data = medianas, aes(xintercept = mediana_duracao, color = MODE), linetype = "dashed") + 
  geom_point(data = maximos, aes(x = t, y = f, colour = MODE), size = 3) + 
  geom_label(data = maximos, aes(x = t, y = f, label = round(t, 2), colour = MODE), 
            vjust = 0, size = 3) +
  theme_minimal() +
  facet_wrap(~YEAR) + 
  labs(x = "Trip duration (in minutes)", y = "Density", colour = "Transportation Mode", fill = "Transportation Mode") +
  theme(legend.position="right", 
    strip.text = element_text(face = "bold", hjust = 0))

  plots <- length(unique(gss_impedances_renamed[gss_impedances_renamed$dest_label == destino, ]$YEAR))
 
  # Case of only one year 
    if(plots == 1){
      ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/impf_",destino,".jpg"), 
       plot = combined_plot,
       width = 7, 
       height = 4, 
       units = "in", 
       dpi = 300)
    
    # Destination present in 3 surveys  
    } else if(plots == 3){
      ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/impf_",destino,".jpg"), 
       plot = combined_plot,
       width = 14, 
       height = 4, 
       units = "in", 
       dpi = 300)
      
  # Destination present in 5 surveys  
    }else {
      ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/impf_",destino,".jpg"), 
       plot = combined_plot,
       width = 14, 
       height = 9, 
       units = "in", 
       dpi = 300)
    }
}
```

```{r outdoors-impedance-fig, echo=FALSE, out.width="100%", fig.cap=paste0("Empirical data and impedance functions fitted for walking trips with `work or school` as destination."), fig.align="center"}
# selecting mode and destination to display impedance functions
mode <- "Walking" 
destino <- "Outdoors"

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/impf_",destino,".jpg"))
```

The temporal difference between the decay functions is also evident in Figure \ref{fig:walking-evolution-fig}, which shows the calibrated functions for each year of analysis across all destination and transport mode categories for walking trips. For some locations, the impedance functions are of the same type and have similar parameters across all the years analyzed. For example, the "Cultural venues", the only destination present in more than one survey that did not displayed a statistically significant difference for the walking mode, consistently uses a gamma function to represent the population's transport behavior for all the years analyzed. On the other hand, the "Place of worship" destination exhibits temporal differences, with distinctly different peaks and density dispersions, reflecting the variations in the empirical data shown in Figure \ref{fig:figure-boxplot} and discussed above.

```{r figure-walking-evolution, include = FALSE}
year_order <- c(1992,1998,2005,2010,2015)

#my_colors <- kelly(length(destination_order))
my_colors_years <- c("#cbd9bf","#bae4bc","#7bccc4","#43a2ca","#0868ac")

names(my_colors_years) <- year_order


walking_temporal_evolution <- theoretical_values %>%
  filter(MODE == 'Walking') %>%
  ggplot(aes(x=t, y=f, color = as.factor(YEAR))) +
  geom_line(size = 1) + 
  theme_minimal() +
  facet_wrap(~ dest_label) + 
  scale_color_manual(values = my_colors_years) +
  labs(x = "Walking trip duration", y = "Density", color = "Year") + 
  theme(
    strip.text = element_text(face = "bold", hjust = 0))


Cycling_temporal_evolution <- theoretical_values %>%
  filter(MODE == 'Cycling') %>%
  ggplot(aes(x=t, y=f, color = as.factor(YEAR))) +
  geom_line(size = 1) + 
  theme_minimal() +
  facet_wrap(~ dest_label) + 
  scale_color_manual(values = my_colors_years) +
  labs(x = "Cycling trip duration", y = "Density", color = "Year") + 
  theme(
    strip.text = element_text(face = "bold", hjust = 0))

ggsave(paste0(here::here(),"/Journal-manuscript/figures/walking_temporal_evolution.jpg"), walking_temporal_evolution, 
       width = 10, 
       height = 7, 
       units = "in", 
       dpi = 300)


ggsave(paste0(here::here(),"/Journal-manuscript/figures/cycling_temporal_evolution.jpg"), Cycling_temporal_evolution, 
       width = 10, 
       height = 7, 
       units = "in", 
       dpi = 300)
```

```{r walking-evolution-fig, echo=FALSE, out.width="100%", fig.cap=paste0("Temporal evolution of walking impedance functions."), fig.align="center"}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/walking_temporal_evolution.jpg"))
```

Finally, Figures \ref{fig:walking-function-by-year-fig} and \ref{fig:cycling-function-by-year-fig} present the impedance functions for different destination categories, grouped by year, for the walking and cycling modes of transport, respectively.

<!-- criar um paragrafo explicando a diferenca entre as duas figuras --> 

```{r figure-walk-func-by-year, include = FALSE}
walking_func_by_year <- theoretical_values %>%
  filter(MODE == 'Walking') %>%
  mutate(dest_label = factor(dest_label, levels = destination_order)) %>%
  ggplot(aes(x=t, y=f, color = dest_label)) +
  theme_minimal() +
  geom_line(size = 1) + 
  facet_wrap(~YEAR   ) + 
  scale_color_manual(values = my_colors) +
  labs(x = "Walking trip duration", y = "Density", color = "Destination") + 
  theme(
    strip.text = element_text(face = "bold", hjust = 0))

ggsave(paste0(here::here(),"/Journal-manuscript/figures/walking_functions_by_year.jpg"), walking_func_by_year, 
       width = 10, 
       height = 5, 
       units = "in", 
       dpi = 300)
```

```{r walking-function-by-year-fig, echo=FALSE, out.width="100%", fig.cap=paste0("Walking functions grouped by year."), fig.align="center"}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/walking_functions_by_year.jpg"))
```

```{r bike-figure-func-by-year, include = FALSE}
functions_by_year <- theoretical_values %>%
  filter(MODE == 'Cycling') %>%
  mutate(dest_label = factor(dest_label, levels = destination_order)) %>%
  ggplot(aes(x=t, y=f, color = dest_label)) +
  theme_minimal() +
  geom_line(size = 1) + 
  facet_wrap(~YEAR   ) + 
  scale_color_manual(values = my_colors) +
  labs(x = "Cycling trip duration", y = "Density", color = "Destination") + 
  theme(
    strip.text = element_text(face = "bold", hjust = 0))

ggsave(paste0(here::here(),"/Journal-manuscript/figures/cycling_functions_by_year.jpg"), functions_by_year, 
       width = 10, 
       height = 5, 
       units = "in", 
       dpi = 300)
```

```{r cycling-function-by-year-fig, echo=FALSE, out.width="100%", fig.cap=paste0("Cycling functions grouped by year."), fig.align="center"}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/cycling_functions_by_year.jpg"))
```

# Summary and conclusion

The main objectives of this study were to provide an overview of active transportation in Canadian metropolitan cities, focusing on primary origins, destinations, and travel times, and to identify appropriate impedance functions for active transportation modes across various destinations and time periods. In this study we perform a direct application of `ActiveCA` R package [@dossantos2024ActiveCA], analyzing over 12,000 episodes from the Time Use cycles of the General Social Survey (GSS) from 1992 to 2015 that covered a wide range of destinations and considering walking and cycling as transportation modes.

Although the study does not explain the reasons for fluctuations in travel times over the years, the findings confirmed, with statistical significance, that typical active travel times decreased for walking and cycling modes over the 30 years analyzed. For walking trips, typical travel times declined from 15 minutes in 1992 to 10 minutes in 2015. For cycling trips, the typical travel time decreased from 20 minutes to 15 minutes over the same period. The results also show that, in general, typical travel times for walking were consistently lower than for cycling.

However, some destinations exhibited a trend of increasing travel times. For walking trips, travel times to ‘Restaurants’ and ‘Outdoors’ rose from 5 minutes in 2005 to 10 minutes in 2015, while travel to ‘Places of worship’ increased from 10 minutes in 2005 to 15 minutes in 2015, marking the highest typical travel time for walking trips. For cycling trips, travel times increased for destinations such as ‘Grocery store’ (from 10 to 15 minutes between 2005 and 2015), ‘Outdoors’ (from 15 to 20 minutes during the same period), and ‘Home’ (returning to 20 minutes in 2015 after a drop to 10 minutes in 2010).

Conversely, for both transportation modes, the destination ‘Other’s home’ showed a reduction in travel time and a decline in the share of trips, reflecting changes in travel behavior since the technological advances enabled people to maintain contact with friends and relatives without visiting in person. For walking trips, findings indicate that ‘Home’ remains the main hub, whether as an origin or destination. For cycling trips, the combination of ‘Home’ and ‘Work or school’ accounted for the largest share of trips.

The study highlights the need to apply specific impedance functions for different destinations when measuring the cost decay effect in accessibility analyses. Based on this, we fitted 64 impedance functions for active transportation over more than 30 years, considering different types of destinations and transportation modes. The results indicate that none of the parameterized functions were exponential, suggesting that the impedance functions commonly used in active accessibility studies may not accurately capture travel behavior, especially for very short trips (up to 3 minutes), by giving to shorter trips higher probability of being made. Destinations with a high number of episodes were primarily fitted with gamma functions, followed by lognormal functions, while destinations with fewer episodes (fewer than six) were fitted with a uniform distribution.

Given similarities in urbanization processes between Canada, the United States, Australia, and West Europe, these findings may also be applicable to metropolitan areas in those regions. Finally, this study contributes to the ongoing discussion on active transportation, emphasizing its importance in promoting sustainable transportation planning.

# References {#references .unnumbered}
