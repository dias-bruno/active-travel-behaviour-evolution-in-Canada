---
title: A historical analysis of the evolution of active travel behaviour in Canada
author:
  - name: Alice Anonymous
    email: alice@example.com
    affiliation: Some Institute of Technology
    correspondingauthor: true
  - name: Bob Security
    email: bob@example.com
    affiliation: Some Institute of Technology
  - name: Cat Memes
    email: cat@example.com
    affiliation: Some Institute of Technology
address:
  - code: Some Institute of Technology
    organization: Big Wig University
    addressline: 1 main street
    city: Gotham
    state: State
    postcode: 123456
    country: United States
abstract: |
    Active transportation (AT), defined as self-powered modes such as walking and cycling, can help individuals meet health recommendations of 150 minutes of moderate-to-vigorous physical activity per week. Despite the potential of Canada’s Time Use Survey (TUS) from the General Social Survey (GSS) to inform AT research, no comprehensive historical analysis of AT using all TUS cycles has yet been conducted. This study addresses that gap with two objectives: to examine temporal trends in AT by destination, travel time, and demographic profiles; and to calibrate impedance functions for AT modes across survey cycles and destinations. After analyzing and processing over 13,500 AT records representing 28 million weighted episodes, we performed descriptive analyses and modeled a wide range of impedance functions. Results show that "Home," "Work or study," and "Grocery store" were the most frequent destinations. Walking dominated AT (over 90% of episodes), with median durations rising from 10 to 15 minutes in 2022; for cycling, durations rose from 15 to 30 minutes. Since 2010, the share of individuals with AT episodes declined, especially among Women+, reversing a previous gender pattern. The group cohort between 15 to 24 years remained as the most active, while adults older than 75 years showed steady increases. All fitted impedance functions deviated from exponential form, indicating that standard assumptions about patterns of distance decay functions may misrepresent AT behaviour, particularly for short trips. These findings improve  our understanding of active travel trends and provide empirical support for AT accessibility measures and transportation policy.
keywords: 
  - Active mobility
  - Walking
  - Cycling
  - Impedance function
  - Temporal evolution 
journal: "Journal of Transport Geography"
date: "`r Sys.Date()`"
linenumbers: false
numbersections: true
bibliography: mybibfile2
biblio-style: elsarticle-harv # author year style for natbib - use 'elsarticle-num' or 'elsarticle-num-names' for numbered scheme
classoption: preprint, 3p, authoryear # remove authoryear is not using `elsarticle-harv`
# csl: https://www.zotero.org/styles/elsevier-harvard
output: 
  rticles::elsevier_article:
    keep_tex: true
    citation_package: natbib
header-includes:
- \usepackage{pdflscape}
editor_options: 
  markdown: 
    wrap: 72
---

```{r install-activeCA, include = FALSE}
# install.packages("pak")
# pak::pak("dias-bruno/ActiveCA")
opts <- options(knitr.kable.NA = "")

knitr::knit_hooks$set(inline = function(x) {
   if (is.numeric(x)) {
     format(x, big.mark = ",", scientific = FALSE)
   } else {
     x
   }
 })

rm(list=ls())
```

```{r load-packages, include=FALSE, cache=FALSE}
# Load packages
library(ActiveCA)
library(here)
library(dplyr)
library(tidyr)
library(ggplot2)
library(kableExtra)
library(reshape2)
library(rlang)
library(scales)
library(gridExtra)
library(ggpubr)
library(grid)
library(stats)
library(Hmisc)
library(stringr)
library(patchwork)
library(foreign)
```

```{r load-data, include = FALSE}
# Load data
data(gss_impedances)
data(gss_episodes)
data(gss_main_1992)
data(gss_main_1998)
data(gss_main_2005)
data(gss_main_2010)
data(gss_main_2015)
data(gss_main_2022)
```

```{r renaming-destinations, echo=FALSE, cache=FALSE, include=FALSE}
# Filtering episodes and impedances functions 
gss_episodes <- gss_episodes %>%
  filter(YEAR > 1986)
  
gss_impedances <- gss_impedances %>%
  filter(YEAR > 1986)

# Renaming 'dest_label' and 'orig_label' values to reduce table space
gss_impedances_renamed <- gss_impedances %>%
  mutate(dest_label = case_when(
    dest_label == "Grocery store, other stores or mall" ~ "Grocery store",
    dest_label == "Restaurant, bar or club" ~ "Restaurant",
    dest_label == "Sports centre, field or arena" ~ "Sport area",
    dest_label == "Medical, dental or other health clinic" ~ "Health clinic",
    dest_label == "In the neighbourhood" ~ "Neighbourhood",
    dest_label == "Library, museum or theatre" ~ "Cultural venues",
    dest_label == "Travel - Bycicle" ~ "Travel - Bicycle",
    TRUE ~ dest_label  # Keep all other values as they are
  ), 
  orig_label = case_when(
    orig_label == "Grocery store, other stores or mall" ~ "Grocery store",
    orig_label == "Restaurant, bar or club" ~ "Restaurant",
    orig_label == "Sports centre, field or arena" ~ "Sport area",
    orig_label == "Medical, dental or other health clinic" ~ "Health clinic",
    orig_label == "In the neighbourhood" ~ "Neighbourhood",
    dest_label == "Library, museum or theatre" ~ "Cultural venues",
    dest_label == "Travel - Bycicle" ~ "Travel - Bicycle",
    TRUE ~ orig_label))

max_duration <- 100

gss_impedances_renamed <- gss_impedances_renamed %>% 
  filter(DURATION <= max_duration & 
           DURATION > 0 & 
           YEAR > 1986 & 
           Pop_centre %in% c("CMA/CA", "CMA")) %>%
  mutate(WGHT_EPI = ifelse(is.na(WGHT_EPI), 1, WGHT_EPI)) 

# Renaming 'dest_label' and 'orig_label' values to reduce table space
gss_episodes_renamed <- gss_episodes %>%
  mutate(dest_label = case_when(
    dest_label == "Grocery store, other stores or mall" ~ "Grocery store",
    dest_label == "Restaurant, bar or club" ~ "Restaurant",
    dest_label == "Sports centre, field or arena" ~ "Sport area",
    dest_label == "Medical, dental or other health clinic" ~ "Health clinic",
    dest_label == "In the neighbourhood" ~ "Neighbourhood",
    dest_label == "Library, museum or theatre" ~ "Cultural venues",
    dest_label == "Travel - Bycicle" ~ "Travel - Bicycle",
    TRUE ~ dest_label  # Keep all other values as they are
  ), 
  orig_label = case_when(
    orig_label == "Grocery store, other stores or mall" ~ "Grocery store",
    orig_label == "Restaurant, bar or club" ~ "Restaurant",
    orig_label == "Sports centre, field or arena" ~ "Sport area",
    orig_label == "Medical, dental or other health clinic" ~ "Health clinic",
    orig_label == "In the neighbourhood" ~ "Neighbourhood",
    dest_label == "Library, museum or theatre" ~ "Cultural venues",
    dest_label == "Travel - Bycicle" ~ "Travel - Bicycle",
    TRUE ~ orig_label))
```

```{r main-episodes-junction, echo=FALSE, cache=FALSE, include=FALSE}
values_ordered <- c("15 to 24 years","25 to 34 years","35 to 44 years",
                    "45 to 54 years", "55 to 64 years","65 to 74 years",
                    "75 years and over")

# 1992
gss_main_1992_file <- gss_main_1992 %>%
  filter(DVCMA == 'CMA') %>% # Selecting only people living in CMA/CA
  dplyr::select(SEQNUM, FWGHT, DVSEX, DVAGEGR) %>%
  rename(PUMFID = SEQNUM, 
         WGHT_PER = FWGHT, 
         GENDER2 = DVSEX, 
         AGE = DVAGEGR) %>%
  mutate(dest_label = list(unique(
    gss_episodes_renamed[gss_episodes_renamed$YEAR == "1992",]$dest_label))) %>%
  unnest(dest_label) %>%
  mutate(YEAR = 1992, 
         AGE = case_when(
           AGE == "15 to 17 years" ~ "15 to 24 years",
           AGE == "18 to 19 years" ~ "15 to 24 years",
           AGE == "20 to 24 years" ~ "15 to 24 years",
           AGE == "25 to 29 years" ~ "25 to 34 years",
           AGE == "30 to 34 years" ~ "25 to 34 years",
           AGE == "35 to 39 year" ~ "35 to 44 years",
           AGE == "40 to 44 years" ~ "35 to 44 years",
           AGE == "45 to 49 years" ~ "45 to 54 years",
           AGE == "50 to 54 years" ~ "45 to 54 years",
           AGE == "55 to 59 year" ~ "55 to 64 years",
           AGE == "60 to 64 years" ~ "55 to 64 years",
           AGE == "65 to 69 years" ~ "65 to 74 years",
           AGE == "70 to 74 years" ~ "65 to 74 years",
           AGE == "75 to 79 year" ~ "75 years and over",
           AGE == "80 years and over" ~ "75 years and over"), 
           AGE = factor(AGE, levels = values_ordered, ordered = TRUE),
         GENDER2 = case_when(
           GENDER2 == "Male" ~ "Men+",
           GENDER2 == "Female" ~ "Women+"),
         GENDER2 = factor(GENDER2, levels = c("Men+", "Women+"), ordered = FALSE))

# 1998
gss_main_1998_file <- gss_main_1998 %>%
  filter(CMAPRV == 'CMA') %>% # Selecting only people living in CMA/CA
  dplyr::select(RECID, WGHTFIN, SEX, AGEGR10) %>%
  rename(PUMFID = RECID, 
         WGHT_PER = WGHTFIN, 
         GENDER2 = SEX, 
         AGE = AGEGR10) %>%
  mutate(dest_label = list(unique(
    gss_episodes_renamed[gss_episodes_renamed$YEAR == "1998",]$dest_label))) %>%
  unnest(dest_label) %>%
  mutate(YEAR = 1998, 
         AGE = case_when(
           AGE == "15 to 24 years" ~ "15 to 24 years",
           AGE == "25 to 34 years" ~ "25 to 34 years",
           AGE == "35 to 44 years" ~ "35 to 44 years",
           AGE == "45 to 54 years" ~ "45 to 54 years",
           AGE == "55 to 64 years" ~ "55 to 64 years",
           AGE == "65 to 74 years" ~ "65 to 74 years",
           AGE == "75 to 84 years" ~ "75 years and over",
           AGE == "85 years and over" ~ "75 years and over"), 
           AGE = factor(AGE, levels = values_ordered, ordered = TRUE),
         GENDER2 = case_when(
           GENDER2 == "Male" ~ "Men+",
           GENDER2 == "Female" ~ "Women+"),
         GENDER2 = factor(GENDER2, levels = c("Men+", "Women+"), ordered = FALSE))

# 2005
gss_main_2005_file <- gss_main_2005 %>% 
  filter(LUC_RST == "CMA/CA") %>% # Selecting only people living in CMA/CA
  dplyr::select(RECID, WGHT_PER, SEX, AGEGR10) %>%
  rename(PUMFID = RECID, 
         WGHT_PER = WGHT_PER, 
         AGE = AGEGR10,
         GENDER2 = SEX) %>%
  mutate(dest_label = list(unique(
    gss_episodes_renamed[gss_episodes_renamed$YEAR == "2005",]$dest_label))) %>%
  unnest(dest_label) %>%
  mutate(YEAR = 2005,
         GENDER2 = case_when(
           GENDER2 == "Male" ~ "Men+",
           GENDER2 == "Female" ~ "Women+"),
         GENDER2 = factor(GENDER2, levels = c("Men+", "Women+"), ordered = FALSE), 
           AGE = factor(AGE, levels = values_ordered, ordered = TRUE))

# 2010
gss_main_2010_file <- gss_main_2010 %>% 
  filter(LUC_RST == "CMA/CA") %>% # Selecting only people living in CMA/CA
  dplyr::select(RECID, WGHT_PER, SEX, AGEGR10) %>%
  rename(PUMFID = RECID, 
         WGHT_PER = WGHT_PER, 
         AGE = AGEGR10,
         GENDER2 = SEX) %>%
  mutate(dest_label = list(unique(
    gss_episodes_renamed[gss_episodes_renamed$YEAR == "2010",]$dest_label))) %>%
  unnest(dest_label) %>%
  mutate(YEAR = 2010,
         GENDER2 = case_when(
           GENDER2 == "Male" ~ "Men+",
           GENDER2 == "Female" ~ "Women+"),
         GENDER2 = factor(GENDER2, levels = c("Men+", "Women+"), ordered = FALSE), 
           AGE = factor(AGE, levels = values_ordered, ordered = TRUE))

# 2015
gss_main_2015_file <- gss_main_2015 %>% 
  filter(LUC_RST == "CMA/CA") %>% # Selecting only people living in CMA/CA
  dplyr::select(PUMFID, WGHT_PER, SEX, AGEGR10) %>%
  rename(AGE = AGEGR10, 
         GENDER2 = SEX) %>% 
  mutate(dest_label = list(unique(
    gss_episodes_renamed[gss_episodes_renamed$YEAR == "2015",]$dest_label))) %>%
  unnest(dest_label) %>%
  mutate(YEAR = 2015,
         GENDER2 = case_when(
           GENDER2 == "Male" ~ "Men+",
           GENDER2 == "Female" ~ "Women+"),
         GENDER2 = factor(GENDER2, levels = c("Men+", "Women+"), ordered = FALSE), 
           AGE = factor(AGE, levels = values_ordered, ordered = TRUE))

# 2022
gss_main_2022_file <- gss_main_2022 %>% 
  filter(LUC_RST == "CMA/CA") %>% # Selecting only people living in CMA/CA
  dplyr::select(PUMFID, WGHT_PER, GENDER2, AGEGR10) %>%
  rename(AGE = AGEGR10) %>% 
  mutate(dest_label = list(unique(
    gss_episodes_renamed[gss_episodes_renamed$YEAR == "2022",]$dest_label))) %>%
  unnest(dest_label) %>%
  mutate(YEAR = 2022)

# Creating a new file with all main files 
main_file <- rbind(gss_main_1992_file, gss_main_1998_file, gss_main_2005_file, 
                   gss_main_2010_file, gss_main_2015_file, gss_main_2022_file)

# Counting walking episodes 
act_walk <- gss_episodes_renamed %>% 
  filter(YEAR > 1986 & MODE == 'Walking') %>%
  group_by(PUMFID, YEAR, MODE, dest_label) %>% 
  summarise(Count = n(), Total_eps = sum(WGHT_EPI))

# Counting cycling episodes 
act_bike <- gss_episodes_renamed %>% 
  filter(YEAR > 1986 & MODE == 'Cycling') %>%
  group_by(PUMFID, YEAR, MODE, dest_label) %>% 
  summarise(Count = n(), Total_eps = sum(WGHT_EPI))

# Joining walking and cycling episodes
act_ep_counts <- rbind(act_bike, act_walk)

# Bring the counts of activity episodes to the person's file
main_act_eps <-  main_file %>%
  mutate(MODE = list(c("Walking", "Cycling"))) %>%
  unnest(MODE) %>%
  left_join(act_ep_counts, by = c("PUMFID", "YEAR", "MODE","dest_label")) %>%
  mutate(Count = replace_na(Count, 0), Total_eps = replace_na(Total_eps, 0))
```

# Introduction

The Canadian Society for Exercise Physiology (CSEP) recommends that
adults aged 18 to 64 accumulate at least 150 minutes of moderate-to
vigorous-intensity aerobic physical activity per week, in bouts of 10
minutes or more [@csep2012]. Moderate-intensity activities are those
that typically cause adults to sweat slightly and breathe harder, such
as brisk walking and bicycling. In contrast, vigorous-intensity
activities cause individuals to sweat more heavily and become out of
breath, including activities like running, basketball, soccer, and
cross-country skiing. The health benefits of achieving the recommended
150 minutes per week (approximately 21 minutes per day) include a
reduced risk of premature death [@hakim1998effects], heart disease
[@lacroix1996; @hakim1999], stroke [@hu2000], high blood pressure
[@dunn1999], certain cancers, type 2 diabetes [@hu1999], osteoporosis,
overweight, and obesity [@fogelholm2000]. Regular physical activity also
contributes to improved fitness, strength, and mental health, including
better morale and self-esteem [@csep2012].

Active transportation (AT) is an important source of moderate-to
vigorous-intensity physical activity and can help individuals meet
recommended activity levels [@bryan2009; @adams2010], as demonstrated by
the study. AT refers to non-motorized and self-powered forms of travel,
including walking, cycling, and the use of aids such as wheelchairs,
scooters, e-bikes, rollerblades, snowshoes, and cross-country skis
[@csep2012]. Walking, in particular, is of interest for promoting
physical activity among inactive populations because it is low-cost,
easily integrated into daily routines, requires no special equipment or
training, and carries a relatively low risk of injury compared to more
intense physical activities [@hootman2001; @bryan2009]. In turn, cycling
provides greater health benefits compared to walking, due to the greater
intensity and duration associated with this mode [@martin2014;
@barajas2021; @borhani2024; @celismorales2017].

Additionally, both walking and cycling play a important role in
enhancing and promoting urban sustainability [@hino2014built;
@lamiquiz2015effects], making them central to urban mobility research
and policy-making [@vandenbulcke2009mapping; @wu2019measuring]. Walking
and cycling accessibility, the ease of reaching destinations and
opportunities [@hansen1959; @paez2012] by walking and cycling, are
closely related and together contribute to the concept of "active
accessibility" or "non-motorized accessibility." When incorporated into
urban and transportation planning, they help reduce dependence on
private vehicles and promote healthier, more sustainable travel
behaviour among residents.

In 2021, Canada released the "National Active Transportation Strategy"
[@canada2021] to support the expansion and enhancement of active
transportation infrastructure in Canada. The federal government
committed \$400 million over five years to build and improve networks of
pathways, bike lanes, trails, and pedestrian bridges. Beyond its
well-established health benefits, the strategy outlines several
additional advantages of expanding AT, including: economic benefits,
such as savings on household transportation costs (e.g., fewer
vehicle-related expenses, trips, and parking needs), increased tourism
and the growth of outdoor and eco-tourism, and increased foot traffic
and spending at businesses accessible via AT; environmental benefits,
such as improved air quality and environmental resilience due to a
higher modal share of AT, reduced land consumption for roads and
parking, and decreased water pollution from runoff due to paved
surfaces; in addition to social benefits, such as increased public space
for social interaction, and improved access to amenities, health care,
education, and social services.

In Canada, the Time Use Survey (TUS) cycles of the General Social Survey
(GSS), administered by Statistics Canada, offer valuable data for
analyzing Canadians’ travel behaviour [@statisticscanada2022]. This
diary-based survey records individuals’ activities over 24 hours to
capture societal changes related to living conditions and well-being.
TUS cycles have been conducted every five to seven years since 1986.
These type of time-use diary surveys make it possible to study the four
fundamental elements of movement in time and space [@minnen2015]: the
origin and destination of trips (geographic location), the length
between these two points (travel time), the frequency of travel between
them, and the purpose of the trip. The TUS enables researchers to
capture all these elements while also recording the modes of
transportation used, making it a valuable dataset for analyzing active
travel behaviour. Additionally, time-use diary surveys provide empirical
data for developing functions that describe travel behaviour. These
functions can take many forms, but all serve as tools to understand
travel patterns, as they measure the willingness to travel a certain
distance to reach a desired destination where a service or opportunity
is located [@papa2012gravity; @yang2012walking; @millward2013active;
@vale2017influence]. Such functions can be applied in various types of
transportation analysis, with accessibility studies being their most
promising application. For instance, they help us understand how far
people typically walk or cycle when travelling from an origin to a
destination — an essential information for urban planners when
allocating services and opportunities. However, to accurately represent
people’s willingness to travel, these functions must be calibrated using
real travel behaviour data. The lack of calibrated impedance functions,
especially for destinations beyond workplaces, remains a challenge for
incorporating robust accessibility indicators into urban and
transportation planning [@pereira2023].

Despite this potential, to our knowledge, no prior studies have
conducted a analysis of active travel behaviour in Canada using the full
set of TUS GSS cycles. This study is driven by the following research
questions: How can active trips in Canada be characterized in terms of
their main origins, destinations, typical durations, and  how these patterns have evolved over time? How is the population engaged in AT distributed across gender and age cohorts? Finally, how can these travel behaviours be represented using impedance
functions? To answer these questions, this study aims to provide evidence of actual active travel behaviour in Canadian metropolitan areas, first by analyzing the Canadian TUS GSS cycles from 1992 to 2022 to offer an overview of AT in terms of main origins, destinations, travel times, and the demographic profile of individuals
engaging in AT, and second, by calibrating impedance functions to represent
walking and cycling travel behaviour. To achieve this objective, we utilize data provided by the `ActiveCA` R package [@dossantos2025], an open data product in the form
of an R data package with information about active travel in Canada.
This data product is based on Public Use Microdata Files of TUS GSS
cycles. To build this package, the authors extracted all walking and
cycling episodes and their corresponding episode weights for GSS cycles,
Cycles 2 (1986), Cycles 7 (1992), 12 (1998), 19 (2005), 24 (2010), 29
(2015), and 34 (2022), spanning a period of almost fourty years. Origins
and destinations were labelled, enabling the investigation of active
travel for broad destination categories and purposes.

Our research advances the current understanding of active travel
behaviour by analyzing the evolution of travel times and trip frequency
for walking and cycling, trends in the prevalence of AT within the
Canadian population, and the development of calibrated impedance
functions tailored to different destinations, periods, and AT modes.
This study encompasses a wide variety of trip purposes, including
commutes to homes, workplaces, or educational institutions; social
visits; outdoor activities; business trips; shopping; cultural outings
to libraries, museums, or theaters; dining out; and participation in
religious practices. Additionally, we also analyze multimodal travel,
evaluating connections between walking and cycling with motorized
vehicles (including cars as drivers or passengers, taxis, vans, and
motorcycles) and public transit (such as buses, trains, subways, and
streetcars).

We ensured the transparency and reproducibility of our study by sourcing
all data from publicly available repositories. To facilitate
collaboration and further analysis, we developed this paper using
literate programming, with the data analysis code accessible through our
GitHub page *(link to be provided after review)*, in alignment with best
practices in spatial data science [@arribas-bel2021]. These
contributions enhance the understanding of active transportation,
emphasize its role in shaping more sustainable mobility strategies, and
provide a foundation for further research and policymaking.

# Theoretical background

## Evolution of active travel in Canada

When analyzing patterns and trends in walking and cycling behaviour
among Canadian adults on a national scale, two important studies are
particularly prominent. The first, conducted by Bryan et al.
[-@bryan2009], examined walking behaviours among Canadian adults aged 18
to 55 using nationally representative cross-sectional data from the
National Population Health Survey and the Canadian Community Health
Survey spanning from 1994/95 to 2007. The authors calculated the
weighted and age-standardized prevalence of walking for exercise,
walking duration, regular walking (defined as walking at least four
times per week), and whether 100% of leisure-time physical activity
energy expenditure (LTPAEE) was derived from walking. Overall, 70% of
Canadian adults reported walking for exercise at least once during the
previous three months; however, only 30% reported walking regularly - a
figure that remained relatively stable since 2001. Regular walking was
more commonly reported among women, older adults, individuals with lower
body mass index (BMI), and those in lower-income households. Similarly,
women, older adults, and lower-income Canadians were more likely to
derive 100% of their total LTPAEE from walking compared to men, younger
adults, and those in higher-income groups. The study concluded that
while walking is a widely practiced form of physical activity across
demographic groups, the prevalence of regular walking varies
considerably by age, sex, BMI, and income.

The second and more recent study, conducted by Borhani et al.
[-@borhani2024], explored active transportation (AT) patterns in Canada
using data from four national health surveys: the National Population
Health Survey (1994-1998), the Canadian Community Health Survey
(2000-2020), the Canadian Health Measures Survey (2007-2019), and the
Health Behaviour in School-aged Children Study (2010-2018). Their
analysis assessed the prevalence of AT participation and time spent on
active trips, focusing on walking and cycling, with results stratified
by age group and sex. The authors noted that inconsistencies in AT
survey questions over time and across surveys posed challenges to
interpreting long-term trends. Even so, they found that females
consistently reported higher levels of walking, while males were more
likely to cycle. Regardless of mode, males reported spending more total
time in AT. Participation in AT decreased with age, with the highest
prevalence observed among youth and the longest durations among young
adults.

<!-- pensar em um paragrafo pra conectar os dois textos -->

## Time Use Surveys in Transportation

Transportation researchers generally agree that previous behaviour strongly influences current behaviour [@gershuny2000; @minnen2015]. Therefore, identifying activity patterns that remain stable over time provides valuable insights for forecasting travel behaviour. Time-diary surveys are particularly useful due to their activity-based design, which captures activities within a complete daily cycle. Although their primary focus is not transport and mobility aspects, TUS can provide data to create models for travel and transport behaviour patterns. Some studies suggest that recording travel within the broader daily context of activities reduces memory-related errors, as it helps respondents recall short and infrequent trips [@pendyala2003; @clarke1981], although this view is contested by other researchers [@gerike2015].

According to Harms et al. [-@harms2018], more than 65 countries worldwide have collectively conducted over one hundred TUS cycles. In these surveys, respondents complete a diary based on the previous day's activities, and the records are structured as an episode with its main and detailed activity, start and end times, and a location. Transportation modes are often registered as an option of location, allowing researcher to use TUS data as a proxy for travel surveys.

Adams [-@adams2010] used the 2005 UK TUS to examine the prevalence of active travel  and its socio-demographic correlates among dults. They identified as AT all walking, jogging, or cycling episodes for purposes other than recreation. Their results showed that 28% of respondents reported at least one AT episode, and 19% met UK health guidelines for sufficient physical activity only through AT. The typical daily duration of AT was 40 minutes and AT participation was higher among younger people and those without access to a car or van, while being sufficiently active through AT was further associated with being unemployed, being part of lower socioeconomic classes, or having left full-time education later in life.

Lachapelle et al. [-@lachapelle2026] analyzed two cycles of the Canadian TUS (2010 and 2015) to investigate grocery shopping activities, trip characteristics, and the potential loss of detail in the 2015 cycle, which grouped all shopping into a single activity category. They found that grocery shopping sequences were shorter than other shopping activities. No significant differences in duration were observed by gender or income for grocery trips, although differences emerged for other shopping activities. The authors concluded that combining grocery and non-grocery shopping in future surveys, as occurred for 2015, may obscure meaningful behavioural distinctions.

A key limitation of TUS data for transportation research is the adoption of fixed time intervals to report the duration of activities [@gerike2015; @adams2010]. This design may exclude short trips lasting less than half the reporting interval, leading to an underestimation of active travel, since short trips are predominantly made by walking. In addition, TUS fixed time intervals tend to inflate reported travel times when compared to National Travel Survey (NTS), as consistently indicated by literature [e.g., @vilhelmson1997; @harvey2003; @hubert2003; @hubertet2008; @richardson2007; @yennamani2008]. 

Gerike et al. [-@gerike2015] found an overestimation of short trips in their comparison of TUS and NTS data in Germany, as in many cases the duration was reported as 10 minutes. They stressed that TUS data do not always accurately represent the actual duration of trips and should therefore be examined with caution. The authors recommend that transportation researchers use activity diaries with continuous time recording rather than fixed interval formats. However, all studies documenting such limitations refer to TUS with intervals of at least 10 minutes—unlike the Canadian case, which adopts a more refined resolution of 5-minute intervals for the last two cycles. According to Rietveld (2002), rounding to 5-minute intervals for start and end times also occurs in NTS data, even though respondents are asked to report exact times. However, Minnen [-@minnen2015] notes that continuous activity diaries, while methodologically preferable, are also more expensive, time-consuming, and tend to have lower response rates. 

Comparative studies between TUS and NTS reveals others systematic differences. Hubert et al. [-@hubert2008], comparing data from Belgium, France, and Great Britain, found that while both survey types tell broadly parallel stories, TUS data report lower immobility rates and longer average travel times. Nonetheless, they emphasize that TUS datasets enable crucial cross-temporal and cross-national comparisons due to their harmonized design and widespread implementation.

Adams [-@adams2010] also highlighted that some TUS do not capture trip-chaining - when  there is a link of multiple trip purposes within a single travel sequence [@primerano2008]. For example, a trip to buy a gift, visit a friend, and return home may be recorded as a single-purpose trip, masking the complexity of actual travel patterns. 


### Time Use Surveys in Canada

In Canada, the GSS TUS cycles have provided comprehensive cross-sectional snapshots of the Canadian population since 1986 [@statisticscanada2022]. Each survey cycle spans a full 12-month period, typically from July to July of the following year. The target population includes all Canadians aged 15 and older, excluding residents of the Yukon, Northwest Territories, and Nunavut, full-time residents of institutions, and individuals living on Indigenous reserves. The TUS covers both rural and urban areas, including metropolitan and non-metropolitan regions, ensuring a diverse and representative sample of the Canadian population. For sampling purposes, the ten provinces were divided into distinct geographic strata. Several Census Metropolitan Areas (CMAs) and some Census Agglomerations (CAs) were treated as separate strata, while additional strata were created by grouping other CMAs within Quebec, Ontario, and British Columbia, and by categorizing non-CMA areas within each province.

Since 2015, the TUS has adopted fixed 5-minute time intervals for recording activities, replacing the continuous time recording used in previous cycles. This design change probably results in the merging of episodes shorter than 2.5 minutes into longer ones, which may introduce some of the rounding and underreporting issues discussed earlier. Another significant methodological change occurred in 2022, when the telephone-based sampling frame used in previous cycles was replaced with a dwelling-based frame. In addition, most respondents to the 2022 TUS completed the survey online. According to Statistics Canada [-@statisticscanada2022], this shift was intended to reflect evolving technology use and increasing time demands among Canadians, providing respondents with greater flexibility and convenience in completing the survey.

However, major methodological changes can affect data comparability over time. It is therefore difficult to determine with certainty whether observed differences across survey cycles reflect genuine changes in population behaviour or result from modifications in data collection methods. While Statistics Canada maintains rigorous standards to ensure the accuracy and quality of published estimates, there is reason to believe that the use of an electronic questionnaire influenced some results. The potential impact of the new collection mode was assessed by Statistics Canada for a subset of key questions, although sample size limitations prevented this analysis from being extended to all variables. Importantly, none of the variables used in this study are identified in the 2022 TUS Public Use Microdata File User Guide [@statisticscanada2022] as unsuitable for trend analysis due to differences in data collection mode.

Another difference is that the range of activities and destinations considered in the
surveys changed from 1992 to 2022. In 1992, there were only a few options of origin/destination location available to the respondent: their home, other's home, Work, elsewhere; as well travel options to describe cases in which a person was currently travelling from one place to another: Car (as driver or passenger), public transit (bus or subway), walk, bicycle, and other type of transportation option. In its turn, the most recent survey (2022) counts with twelve possible destination, adding to the previous list sport
area (sports centre, field or arena), restaurant (including bar and
club), health clinics (medical, dental or other health clinic), grocery
stores (including other types of stores and malls), place of worship, art venues (library, museum or theatre), outdoors, in the neighbourhood, business, and school (in fact, work or study); and ten travel options, adding to the previous list more options of public transit (street-car and light-rail), airplane, bicycle, motocyle, scooter or moped, and taxi or limousine service. 

## Representation of travel behaviour with impedance functions

Current interest in creating "livable" communities often relies on broad assumptions about individuals' willingness to walk or bike to different destinations [@iacono2008access]. For example, it is commonly assumed that people are generally willing to walk up to a quarter mile to access most places [@untermann1984; @larsen2010]. Similarly, the recent "15-minute city" concept proposes that the majority of daily necessities should be accessible by walking or cycling within 15 minutes [@moreno2021]. When calibrated with real data, impedance functions provide empirical evidence to test the validity of such assumptions and support urban planners in their decision-making.

Perhaps the most important application of impedance functions is their use in calculating accessibility measures - the potential to access spatially distributed opportunities [@hansen1959; @paez2012]. For these calculations, it is necessary to account for the challenges associated with accessing different locations and opportunities. The core idea is that greater distances between origins and destinations lead to lower movement intensity, following a distance-decay effect. The effect of travel costs is typically expressed through impedance functions, which, when calibrated, are derived from sample data distributions that reflect variations in individuals' willingness to travel different distances to reach opportunities [@li2020approach]. These functions are therefore central not only to accessibility analysis but also to travel demand forecasting [@primerano2008; @sveda2023].

Different categories of accessibility measures have been developed, such
as indicators based on actives, infrastructure, individuals and
utilities [@geurs2004; @paez2012]. The family of gravity-based
accessibility have been widely used in active modes [@miller2005]. Many
gravity-based accessibility measures derive from the work of Hansen
[-@hansen1959], represented in (Equation
\ref{eq:accessibility-equation}), in which an impedance function weights
opportunities:

\begin{equation}
A_{i} = \sum_{j=1}^J O_j .f(c_{ij})
\label{eq:accessibility-equation}
\end{equation}

The accessibility score $A_{i}$ at each origin $i$ is obtained by
summing up the opportunities $O$ available at destination $j$, where $i$
and $j$ are sets of spatial units in a region. However, the number of
opportunities in each destination is gradually discounted as travel
costs become higher and the rate at which this weight decreases is
determined by a decay function. $f(c_{ij})$ represents the impedance
during the trip from origin $i$ to destination $j$ and $c_{ij}$ reflects
the generalized travel cost, potentially encompassing factors such as
time, distance and effort. In this way, the impedance function
$f(c_{ij})$ allows the accessibility analyst to define a measure of
travel behaviour with precision: the relationship between the
"population" at an origin and where they normally want to or can go to
reach "opportunities" at destinations. The definition of the impedance
function $f(c_{ij})$ is very important from this perspective
[@soukhov2024].

Since the beginning applications of the gravity-accessibility models, a
range of impedance functions have been applied to describe the
distribution of walking and cycling trips, whether for general or
specific purposes [@iacono2008access; @iacono2010; @larsen2010;
@yang2012walking; @millward2013active; @vale2017influence;
@li2020approach]. Selecting an appropriate impedance function can be
challenging and results in a diverse range of cost decay functions that
are employed as impedance functions in accessibility measures, including
threshold functions and smooth cost decay functions (e.g., log-normal,
normal, gamma, and exponential function) [@de2009exponential;
@reggiani2011accessibility; @osth2016new], with the negative exponential function being the dominant choice [@hansen1959; @apparicio2008comparing;
@iacono2008access; @larsen2010; @millward2013active]. Its high adoption
can be attributed mainly to its ability to give greater weight to nearby
opportunities while discounting distant ones - a highly
relevant characteristic for active modes of transportation, such as
walking and cycling. When Hansen [-@hansen1959] introduced their
accessibility measure, the author applied and indicated the use of
exponential distributions $(e ^ {-\beta x})$ as the impedance function.
After this, several other studies use the negative exponential function after comparison with empirical trip distribution data [@fotheringham1989spatial;
@de2009exponential; @iacono2010; @signorino2011gravity; @prins2014many].

However, impedance functions with the same parameters are still often applied to different modes and destinations to describe the decay effect. In other cases, when functions are specified separately for different transportation modes and destinations, researchers have fixed a single function form, which limits the validity of the resulting decay curve or produces a function type that does not necessarily best describe willingness to travel. Consequently, the use of unsuitable or generalized functions can lead to significant mispredictions of accessibility. After examining which factors should be used to distinguish impedance functions, Verma and Ukkusuri [-@sveda2023] recommended that urban and transport planners differentiate impedance functions at least by travel mode, and, where data and policy allow greater detail, develop separate functions for workplace and non-work destinations. In our study, we aim to provide helpful resources for transportation planners by calibrating specific impedance functions, without restricting their form to a specific type, for several destinations included in the Canadian TUS, and distinguishing them by survey year and by walking and cycling transportation modes.

# Materials and Methods

To provide evidence of actual behavior in relation to active transportation and investigate its evolution over the years in Canadian metropolitan areas, we
analyzed six cycles of GSS TUS: Cycles 7 (1992), 12 (1998), 19 (2005),
24 (2010), 29 (2015) and 37 (2022). We excluded Cycle 2 (1986) from our
analysis because this survey did not specify whether the respondent
lived in a metropolitan area and did not present cycling as a option of
transportation mode, although this cycle is notable for having been the
first national random sample to examine Canadian time-use patterns. This
paper is a direct application of the ready-to-use data set provided by
the `ActiveCA` data package [@dossantos2025], which is based on the Main
and Episode files from the GSS Public Use Microdata Files. The Main file
contains questionnaire responses and associated data from participants,
while the Episode files provided detailed information about every
activity episode reported by the respondents.

The methodology involves two main steps. The first step employs
descriptive analysis of AT episodes to identify typical travel times
across destinations and years, comparing their temporal evolution and
identifying differences in AT episodes through statistical tests, and
assess the active population in terms of sex and age group. The second
step calculates and analyzes impedance functions for each combination of
cycle, destination, and AT mode.

To facilitate collaboration and further analysis, we updated the
`ActiveCA` R Package to include the methodology to obtain impedance
functions from the raw data files (GSS TUS). Additionally, we
created this paper using literate programming in which the R markdown
code to fully reproduce this article is available on our GitHub
repository *(include after the review)*, in line with the best practices
of spatial data science [@arribas-bel2021; @paez2021].

## Analyzing active travel episodes

A TA episode refers to a walking or cycling activity that a person did
the day before the TUS interview. For each selected cycle of the GSS
surveys, we reviewed the episode files to identify cases with activities
listed as walking or cycling, selecting the locations immediately before
and after the mobility episode. With this process, we were able to
identify the origin and the destination of the active travel episode. We
labeled the code variables with their appropriate descriptions,
identifying the transportation mode, activity/reason of the travel, as
well the province and urban classification of the respondent's residency
(if the respondent lives in a CMA or in a CA).

Additionally, it was necessary to ensure data consistency across the surveys, since they employed a variety of variable coding schemes. To achieve uniformity, location categories were synchronized into the following destination options: "Home," "Other’s home," "Work or school", "Business," and "Elsewhere." We combined work and school as a unique destination because work destination is available from 1998 to 2010, and study, present only in 2005 and 2010, were merged into a single category in 2015 and 2022. 
Then, we standardized the categories that have been present since 2005: "Grocery store" (including grocery stores, other stores, or malls), "Outdoors," "Cultural venues" (library, museum, or theatre), "Restaurant" (restaurant, bar, or club), and "Place of worship". Categories available since 2015 include "Business," "Neighbourhood," "Sport area" (sports centre, field, or arena), and "Health clinic" (medical, dental, or other health clinic). 

For travel-related options, we created two destination categories: "Travel - Motorized," which combines car, truck, or van (whether as a driver or passenger), taxi or limousine service, and motorcycle, scooter, or moped; and "Travel - Public Transit," which includes bus, streetcar, subway, and light-rail. We excluded airplane travel and other unspecified travel modes from our analysis. Episodes were identified as cycling when the location was coded as "Travel - Bicycle" and as walking when coded as "Travel - Walk."

Statistical analysis was used to characterize active travel episodes
using cross-tabulations and graphs. Summary statistics and visualization
techniques, including median values as a measure of typical value and
box plots, were employed to describe active travel across years,
destinations, and transportation modes. To assess the statistical
significance of potential temporal differences in the empirical episode
data set for each destination, we applied the Kruskal-Wallis test - a
test that evaluates differences in the medians of the empirical data.
This test was chosen because it does not assume a normal distribution
for the data, an important consideration since we made no assumptions
about the distribution of the empirical data.

## Analyzing the population with active travel records

After assessing the active travel episodes, we analyzed the population
with records of active travel for each year of the analysis, stratifying
the analysis by gender and age group. To stratify by gender, we adopted
the definition used in the most recent TUS (2022), which was the first
in the series to consider gender - recognizing a broader spectrum of
gender identities - instead of biological sex, which had previously been
limited to female and male categories. In the 2022 survey, due to the
small size of the non-binary population, data aggregation was necessary
to protect the confidentiality of respondents [@statisticscanada2025].
As a result, information from the TUS 2022 is disseminated using a
two-category gender variable. In this framework, individuals identifying
as non-binary are distributed across the two other gender categories and
are denoted by the "+" symbol. The category "Men+" includes men (and/or
boys) as well as some non-binary persons, and the category women+
includes women (and/or girls) as well as some non-binary persons.

We recognize that biological sex does not always align with gender
identity. However, to enable comparison across survey years, we assumed
that individuals recorded as "female" in earlier surveys correspond to
women+, and those recorded as "male" correspond to men+. We acknowledge
that this approach does not fully capture gender diversity, particularly
for trans and non-binary individuals, due to limitations in how gender
was recorded in earlier surveys.

We also stratified the analysis by age group. To ensure the consistency
across all survey years, we defined the following cohorts: "15 to 24
years", "25 to 34 years", "35 to 44 years", "45 to 54 years", "55 to 64
years", "65 to 74 years", and "75 years and over".

After defining the gender and age group categories, we identified the
population with and without at least one active travel episode,
considering both modes (walking and cycling). To complete the population
analysis, we measured and examined the temporal evolution of the number
of active trips per person for each survey year, considering both the
active population and the general population. We also analyzed the
number of walking episodes per person who reported walking activity, and
the number of cycling episodes per cyclist, to identify possible trends
within each AT mode. Finally, we compared the average duration of active
travel episodes to observe changes over time.

## Estimating impedance function parameters

```{r echo=FALSE, cache=FALSE, include=FALSE}
less_than100 <- gss_episodes %>% 
  filter(DURATION > 100 & YEAR > 1986) %>%
  summarise(total_eps = n(),
            total_WGHT_EPI = sum(WGHT_EPI, na.rm = TRUE))


all_episodes <- gss_episodes %>% 
  filter(YEAR > 1986) %>%
  summarise(total_eps = n(),
            total_WGHT_EPI = sum(WGHT_EPI, na.rm = TRUE))
  
```

After analyzing the AT episodes in terms of the population with AT
records, we calculated the best impedance functions to represent the transport
behaviour of Canadians for each survey year and destination. In this study, we adopted Probability Density Functions (PDFs), following the approach of Soukhov and Paez
[-@soukhov2024] and Verma and Ukkusuri [-@sveda2023]. With a PDF, $f()$ can be interpreted as the probability
density of a trip occurring for each value of travel cost $c_{ij}$. If a
graph of the PDF (y-axis) is plotted against the travel cost $c_{ij}$
(x-axis), the probability of a trip occurring between a given range of
$c_{ij}$ is the area under the curve. In this case, the total area under
the PDF curve always sums to 1, meaning that there is 100% probability
that the trip will occur between the minimum and maximum $c_{ij}$.

Dunn et al. [-@dunn2023] presented a set of distributions that serve as
PDFs. From their survey, we selected some options for $f()$ commonly
used in accessibility research and their impact on the number of
opportunities (the sum of opportunities) at specific travel costs
$c_{ij}$, namely: uniform, negative exponential, gamma, normal, and
lognormal distributions.

-   **Uniform distribution**: The uniform distribution or rectangular
    PDF looks very similar to the binary function, since it only returns
    one of two values, but ensure that area under the curve for the
    range of $c_{ij}$ is 1. The uniform distribution PDF is shown in
    (Equation \ref{eq:uniform-equation}). The parameters to be
    calculated are $c_{max}$ and $c_{min}$, which represent the maximum
    and minimum travel costs that describe the observed or assumed
    willingness to reach destinations. In this distribution, all values
    within the interval are equally likely, and all values outside the
    interval have probability 0, assuming that the population's
    potential to interact with these opportunities is zero. Usually,
    $c_{min}$ has value 0.

\begin{equation}
f(c_{ij})^{uniform} =
\begin{cases}
  \frac{1}{c_{max} - c_{min}} & \text{for } c_{min} \le c_{ij} \le c_{max} \\
  0 & \text{otherwise}
\end{cases}
\label{eq:uniform-equation}
\end{equation}

-   **Exponential distribution**: The exponential distribution PDF
    equation is given by Equation \ref{eq:exponential-equation}. This
    model suggests that impedance decreases exponentially with
    increasing cost $(c_{ij})$. The parameter $\beta$ represents the
    decay rate, with higher values indicating a faster decrease in
    accessibility with increasing cost. As already mentioned, this
    function is widely used due to its simplicity and ability to model
    the rapid drop-off in accessibility over distance.

\begin{equation}
f(c_{ij}) = e^{-\beta c_{ij}} \text{ with } c_{ij} \ge 0
\label{eq:exponential-equation}
\end{equation}

-   **Gamma distribution**: The gamma distribution PDF equation is
    presented by the Equation \ref{eq:gamma-equation}. Where
    $\Gamma(\alpha)$ is the gamma function to be estimated. In this
    case, the probability is typically low at low cost, higher at medium
    cost, and low again at high cost. The higher the $\sigma$ (scale
    rate) parameter, the higher the probability that the majority of
    trips will be in the low cost range. So at low values of the
    $\sigma$ (scale rate) parameter, the same probability is spread over
    a wider range of travel costs. For the $\alpha$ (shape) parameter,
    the higher the value, the higher the probability density of trips
    with a higher average cost [@soukhov2024].

\begin{equation}
f(c_{ij}) = 
   \begin{cases}
\frac{1}{\sigma^\alpha\Gamma(\alpha)} c_{ij}^{\alpha-1} e^{\frac{-c_{ij}}{\sigma}} & \text{if } 0 \leq c_{ij} <      \infty  \text{ and } \alpha, \sigma > 0 \\ 0 & \text{otherwise}
   \end{cases}
\label{eq:gamma-equation}
\end{equation}

-   **Lognormal distribution**: The normal distribution, also often
    called the Gaussian distribution, is suitable when the travel cost
    is found to be distributed normally. The normal distribution has the
    PDF form displayed in Equation \ref{eq:normal-equation}. In this
    equation, $\mu$ and $\sigma$ are the mean and standard deviation of
    the distribution and need to be estimated together to control the
    shape of the normal curve. In this distribution, about 68% of the
    observations will fall within 1 standard deviation of the mean,
    about 95% will fall within 2 standard deviations, and about 99.7%
    will fall within 3 standard deviations of the mean. In this case,
    the values close to the mean will have the highest probability.

\begin{equation}
f(c_{ij}) = \frac{1}{\sqrt{2\pi} \sigma c_{ij}} e^{-\frac{(\ln c_{ij} - \mu)^2}{2\sigma^2}}
\label{eq:normal-equation}
\end{equation}

-   **Lognormal distribution**: In many cases, the logarithm of the
    travel cost is found to be distributed normally. The lognormal
    distribution has the PDF form displayed in Equation
    \ref{eq:lognormal-equation}. It this equation, $\mu$ and $\sigma$
    are the mean and standard deviation of the logarithm, and need to be
    estimated for together control the shape of the log-normal curve.
    Similar to the gamma function, the probability is typically low at
    low cost, higher at medium cost, and low again at high cost.

\begin{equation}
f(c_{ij}) = \frac{1}{\sqrt{2\pi} \sigma c_{ij}} e^{-\frac{(\ln c_{ij} - \mu)^2}{2\sigma^2}}
\label{eq:lognormal-equation}
\end{equation}

To identify our PDFs, we applied the `fitdistrplus` package
[@delignette2015fitdistrplus] to calculate the best PDF for every
destination, mode of transportation and survey year, modelling the trip
durations and testing the equations mentioned above. We selected the
best impedance function based on the lowest Akaike Information Criterion
(AIC) value [@akaike1974]. The AIC metric not only assesses the goodness
of fit but also penalizes model complexity to prevent overfitting. AIC
provides a balance between a model's accuracy and simplicity, with lower
values indicating a more economical model. The distribution with the
lowest AIC was considered the most suitable for representing the
distance decay curve for each specific destination in each year. We
chose AIC as the selection criterion because, while the `fitdistrplus`
package accommodates weighted episodes during estimation, it does not
extend this functionality to diagnostic plots, which are typically
unweighted and traditionally used to select the best-fitting function.

In order to calculate the impedance functions, two filters were applied
in the TUS data set. The first is that we excluded all trips with travel
times higher than 100 minutes (1.5 hours). An exploratory data analysis
showed that, taking into account all the walking and cycling records
(`r all_episodes$total_eps` in total), less than
`r round(less_than100$total_eps/all_episodes$total_eps * 100, 2)`% of
them have a trip duration higher than this limit. When considering the
weights of this episodes, travel times higher than 100 minutes
represented
`r round(less_than100$total_WGHT_EPI /all_episodes$total_WGHT_EPI * 100, 2)`%
of the episodes. Due to the description of the activities, it was also
possible to know that trips with a duration higher than 100 minutes are
mainly composed of hiking and camping episodes. The second filter was
realized to select only the population living in a larger urban
population centre. We decided to apply this restriction because the
travel behaviour of residents of CMA and CA areas tends to be very
different from those outside these large urban centres in terms of
active travel.

# Results and discussion

## Descriptive analysis

### Active transportation episodes

```{r bulding table-01, echo=FALSE, cache=FALSE, include=FALSE}
gss_summary <- gss_impedances_renamed %>%
     group_by(YEAR, MODE) %>%
     dplyr::summarise(
         count = sum(WGHT_EPI),
         .groups = "drop") %>%
  rename(Mode = MODE) %>%
  pivot_wider(names_from = YEAR, values_from = count) %>% 
  mutate(Total = rowSums(across(where(is.numeric)), na.rm = TRUE))

gss_summary <- bind_rows(
  gss_summary,
  gss_summary %>%
    dplyr::summarise(across(where(is.numeric), \(x) sum(x, na.rm = TRUE))) %>%  
    mutate(Mode = "Total")
) 

gss_summary <- gss_summary %>% 
  mutate(
    `1992 (%)` = round(`1992` / gss_summary$`1992`[Mode == "Total"] * 100, 2),
    `1998 (%)` = round(`1998` / gss_summary$`1998`[Mode == "Total"] * 100, 2),
    `2005 (%)` = round(`2005` / gss_summary$`2005`[Mode == "Total"] * 100, 2),
    `2010 (%)` = round(`2010` / gss_summary$`2010`[Mode == "Total"] * 100, 2),
    `2015 (%)` = round(`2015` / gss_summary$`2015`[Mode == "Total"] * 100, 2),
    `2022 (%)` = round(`2022` / gss_summary$`2022`[Mode == "Total"] * 100, 2),
    `Total (%)` = round(`Total` / gss_summary$`Total`[Mode == "Total"] * 100, 2)
  ) %>%
  ungroup() %>%
  select("Mode", "1992", "1992 (%)", "1998", "1998 (%)", 
         "2005", "2005 (%)", "2010", "2010 (%)", "2015", "2015 (%)",
         "2022", "2022 (%)",
         "Total", "Total (%)") 

gss_summary[gss_summary$Mode == 'Total', ]$"1992 (%)" <- round(gss_summary[gss_summary$Mode == 'Total', ]$"1992"/gss_summary[gss_summary$Mode == 'Total', ]$"Total" *100, 2)

gss_summary[gss_summary$Mode == 'Total', ]$"1998 (%)" <- round(gss_summary[gss_summary$Mode == 'Total', ]$"1998"/gss_summary[gss_summary$Mode == 'Total', ]$"Total" *100, 2)

gss_summary[gss_summary$Mode == 'Total', ]$"2005 (%)" <- round(gss_summary[gss_summary$Mode == 'Total', ]$"2005"/gss_summary[gss_summary$Mode == 'Total', ]$"Total" *100, 2)

gss_summary[gss_summary$Mode == 'Total', ]$"2010 (%)" <- round(gss_summary[gss_summary$Mode == 'Total', ]$"2010"/gss_summary[gss_summary$Mode == 'Total', ]$"Total" *100, 2)

gss_summary[gss_summary$Mode == 'Total', ]$"2015 (%)" <- round(gss_summary[gss_summary$Mode == 'Total', ]$"2015"/gss_summary[gss_summary$Mode == 'Total', ]$"Total" *100, 2)

gss_summary[gss_summary$Mode == 'Total', ]$"2022 (%)" <- round(gss_summary[gss_summary$Mode == 'Total', ]$"2022"/gss_summary[gss_summary$Mode == 'Total', ]$"Total" *100, 2)


gss_summary_pivot_long <- gss_summary %>%
  pivot_longer(cols = -Mode,
               names_to = "Year",
               values_to = "Value") %>%
  mutate(Measure = ifelse(grepl("\\(\\%\\)", Year), "Percent", "Count"),
         Year = gsub(" \\(\\%\\)", "", Year)) %>%
  pivot_wider(names_from = c("Mode", "Measure"),
              values_from = Value) %>%
  arrange(Year)

# gss_totals_table <- gss_summary %>%
#   kable(format = "latex", booktabs = TRUE, longtable = TRUE, 
#         caption = "\\label{tab:episodes-count-percentages}Weighted number of episodes identified in each active transportation mode by year.", align = NULL, 
#     col.names = c("Mode","","(%)","","(%)","","(%)","","(%)","","(%)","","(%)","","(%)")) %>% 
#   kable_styling(full_width = FALSE, font_size = 5) %>%
#   add_header_above(c(" " = 1, "1992" = 2, "1998" = 2, "2005" = 2, "2010" = 2, "2015"=2, "2022"=2, "Total" = 2))

gss_totals_table <- gss_summary_pivot_long %>% 
  mutate(across(c(Cycling_Count, Walking_Count, Total_Count), 
                ~ number(., accuracy = 1, big.mark = ","))) %>% 
  kable(format = "latex", 
        booktabs = TRUE, 
        longtable = FALSE,
        caption = "\\label{tab:episodes-count-percentages}Weighted number of episodes identified in each active transportation mode by year.", align = NULL,
    col.names = c("Year","","(%)","","(%)","","(%)")) %>%
    kable_styling(full_width = FALSE, font_size = 10) %>%
    column_spec(5, border_right = TRUE) %>% 
    add_header_above(c(" " = 1, "Cycling" = 2, "Walking" = 2, "Active Trips" = 2))
```

After applying the filters to the GSS surveys, we obtained a total of
21,456 cases of active travel episodes. However, GSS surveys apply a
probability sampling methodology, in which each episode or person
selected in the sample represents several other episodes or persons not
in the sample. The number of episodes and persons represented by a
episode or person is determined by the weight or weighting factor.
Because of this, every estimates of the number of episodes or persons
need to be calculated applying the corresponding weighting factors.

Considering the weights, the 21,456 episodes represent a total of
`r format(gss_summary[gss_summary$Mode == 'Total',]$Total, big.mark = ",", scientific = FALSE)`
episodes. Table \ref{tab:episodes-count-percentages} contains the
weighted number of episodes about walking and cycling trips between 1992
and 2022. The year 2010 is the year with the most episodes, with
`r gss_summary[gss_summary$Mode == 'Total',]$'2010'` episodes
(representing `r gss_summary[gss_summary$Mode == 'Total',]$'2010 (%)'`%
of the total). The year 1992 has the lowest number of episodes, with
only `r gss_summary[gss_summary$Mode == 'Total',]$'1992'` episodes,
representing `r gss_summary[gss_summary$Mode == 'Total',]$'1992 (%)'`%
of the total. The most recent survey, 2022, counted with
`r gss_summary[gss_summary$Mode == 'Total',]$'2022'` episodes
(`r gss_summary[gss_summary$Mode == 'Total',]$'2022 (%)'`% of the
total).

When analyzing the two AT modes, walking episodes account for
`r gss_summary[gss_summary$Mode == 'Walking',]$'Total (%)'`%, while the
remaining `r gss_summary[gss_summary$Mode == 'Cycling',]$'Total (%)'`%
are cycling episodes. The most recent survey (2022) showed that cycling
trips accounted for almost 8% of AT representation, the highest
participation in all survey-years, reinforcing a trend of increasing
cycling participation that started in 1998.

```{=html}
<!-- 
Unfortunately is too much work to obtain all the values automatically.
start -->
```

```{r table-01, echo=FALSE, cache=FALSE}
gss_totals_table
```

Figure \ref{fig:figure-destmodeyearperc} shows the percentage of each
destination by year and by mode of transport. Across all years analyzed,
'Home' is the most common travel destination, regardless of whether of
the active mode, with levels consistently above 33%. 'Work or school'
appears as the second most common destination in more recent years,
particularly for cycling trips, which peaked at almost 31% in 2015. Up
to 2010, the TUS included fewer destination options, especially in 1992
and 1998. For this reason, the destination category 'Elsewhere' - which
encompasses all destinations not explicitly listed by respondents - had
a very high representation for both transportation modes, ranking as the
second most common destination in the first two surveys (1992 and 1998).
However, as later TUS cycles introduced more detailed destination
categories, 'Elsewhere' gradually lost its representativeness over time
and is no longer among the five most common destinations in 2022. Along
with the two destinations already mentioned, 'Other's home' is the only
other destination present in the TUS surveys since 1992. This last
destination seems to be a destination with a higher share when it comes
to walking trips, but for both modes of transportation it seems that
respondents are going less and less to other people's homes - a fact
that can be explained by new communication technologies, in which a
person does not need to visit another person's home to keep in touch
with them.

```{r destinations-percentual, echo=FALSE, cache=FALSE, include=FALSE}
# Order of destinations 
destination_order <- c("Home", "Work or school", "Other's home", "Grocery store", 
                       
                       "Restaurant", "Health clinic", "Outdoors", "Neighbourhood",
                       
                       "Cultural venues", "Place of worship", 
                       
                       "Sport area", "Business", "Elsewhere",
                       
                       "Travel - Motorized", "Travel - Transit")

#my_colors <- kelly(length(destination_order))
my_colors <- c("#a6cee3","#1f78b4","#b2df8a","#33a02c",
               
               "#fb9a99","#e31a1c","#ADEEE3","#ff7f00", 
               
               "#fdbf6f","#6a3d9a",
               
               "#ffff99","#b15928", "#cab2d6",
               
               "#c9c5b1", "#e5bb14")

names(my_colors) <- destination_order

destinations_percentual_table <- gss_impedances_renamed %>%
  mutate(dest_label = factor(dest_label, levels = destination_order)) %>%
  group_by(MODE, dest_label, YEAR) %>%
  dplyr::summarise(n = sum(WGHT_EPI), .groups = "drop") %>%
  group_by(MODE, YEAR) %>%
  mutate(percentage = n / sum(n) * 100) %>%
  ungroup()

destination_percentual <- destinations_percentual_table %>%
  group_by(MODE, YEAR) %>%
  mutate(rank = rank(-percentage, ties.method = "first")) %>%
  mutate(label = ifelse(rank <= 5, paste0(round(percentage, 1), "%"), NA)) %>%
  ggplot(aes(x = MODE, fill = dest_label, y = percentage)) +
  geom_bar(stat = "identity", position = "fill") +
  labs(y = "Proportion (%)",
       x = "Mode",
       fill = "Destination") +
  theme_minimal() +
  facet_wrap(~ as.factor(YEAR)) +
  geom_text(aes(label = label),
            position = position_fill(vjust = 0.5), size = 4) +
  scale_fill_manual(values = my_colors)

ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/destination_percentual.jpg"),
       plot = destination_percentual,
       width = 12,
       height = 8,
       units = "in",
       dpi = 300)
```

```{r figure-destmodeyearperc, echo=FALSE, out.width="100%", fig.cap="Percentage of walking and cycling trips categorized by destination and year."}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/destination_percentual.jpg"))
```

After 2005, the expansion of the destination highlights some new popular
locations. For example, 'Grocery store' appears as the third most chosen
destination, varying from around 9% in 2005 to almost 15% in 2022 for
cycling trips and from 10% to 11.5% for walking trips. When considering
walking trips, 'Restaurants' appears as another well chosen destination
and, in the case of cycling trips, 'Outdoors' appears as a well chosen
destination.

```{=html}
<!-- 
Decided to not include the following tables because I transformed them into figures 
start -->
```

```{r table-03X, echo=FALSE, cache=FALSE, warning=FALSE, results="asis", include = FALSE}
# Filter for selected years and calculate statistics of trip duration
episodes_stats_before <- gss_impedances_renamed %>%
  filter(YEAR < 2005) %>%
  group_by(YEAR, dest_label, MODE) %>%
  dplyr::summarise(
    count = sum(WGHT_EPI),
    min = min(DURATION),
    median =  Hmisc::wtd.quantile(DURATION, weights = WGHT_EPI, probs = 0.5),
    max = max(DURATION),
    .groups = "drop"
  )

# Calculate percentages of trips by mode/year 
total_counts <- episodes_stats_before %>% 
  group_by(YEAR, MODE) %>% 
  summarise(total_count = sum(count), 
            .groups = "drop")

episodes_stats_before <- left_join(episodes_stats_before, total_counts, by = c("YEAR", "MODE"))

episodes_stats_before$Percentage <- round((episodes_stats_before$count / episodes_stats_before$total_count) * 100, 1)

# Pivot data for the table layout
wide_data <- episodes_stats_before %>%
  pivot_wider(
    id_cols = c(dest_label, MODE),
    names_from = YEAR,
    values_from = c(min, median, max, Percentage)
  )  %>% 
  arrange(MODE, dest_label, desc(Percentage_1998))

wide_data <- wide_data %>%
 dplyr::select(
    MODE, dest_label,
    min_1992, median_1992, max_1992, Percentage_1992,
    min_1998, median_1998, max_1998, Percentage_1998
  ) %>% 
  arrange(MODE, dest_label)

# Latex table
styled_table_03 <- wide_data %>%
  kable(
    format = "latex", 
    booktabs = TRUE, 
    longtable = TRUE, 
    align = c(rep("c", ncol(wide_data))),
    caption = "\\label{tab:table-03}Comparison of travel statistics by mode and destination: 1992, 1998",
     col.names = c("Destination", "Mode*","Min*","Med*","Max*", "(%)*", "Min","Med","Max", "(%)")
  ) %>%
  kable_styling(full_width = FALSE, 
                #latex_options=c("striped", "scale_down"), 
                latex_options=c("scale_down"),
                 font_size = 6) %>%
  # column_spec(1, width = "1cm") %>%  # Set width of 'Dest' column to 1.5cm
  # column_spec(2:14, width = "0.5cm") %>%  # Set width of remaining columns to 0.7cm
  add_header_above(c(" " = 2, "1992" = 4, "1998" = 4)) %>%
  row_spec(0, bold = TRUE, align = "c") %>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major") %>% 
  footnote(general = c("* The symbols used in this table represent the following: 'Min' denotes the minimum time to reach the destination; 'Max' denotes the maximum time to reach the destination; '(%)' indicates a percentage of the total time to reach the destination; 'Med' refers to the median time to reach the destination"), threeparttable = T)

styled_table_03 
```

```{r table-04X,echo=FALSE, cache=FALSE, warning=FALSE, include = FALSE}
# Selecting surveys after 2000 and calculating trip duration statistics 
episodes_stats_after <- gss_impedances_renamed %>%
  filter(YEAR > 2000) %>%
  group_by(YEAR, dest_label, MODE) %>%
  dplyr::summarise(
    count = sum(WGHT_EPI),
    min = min(DURATION),
    median =  Hmisc::wtd.quantile(DURATION, weights = WGHT_EPI, probs = 0.5),
    max = max(DURATION),
    .groups = "drop"
  )

# Calculate percentages of trips by mode/year
total_counts <- episodes_stats_after %>% group_by(YEAR, MODE) %>% summarise(total_count = sum(count), .groups = "drop")
episodes_stats_after <- left_join(episodes_stats_after, total_counts, by = c("YEAR", "MODE"))
episodes_stats_after$Percentage <- round((episodes_stats_after$count / episodes_stats_after$total_count) * 100, 1)

# Pivot data for the table layout
wide_data <- episodes_stats_after %>%
  pivot_wider(
    id_cols = c(dest_label, MODE),
    names_from = YEAR,
    values_from = c(min, median, max, Percentage)
  ) %>%
 dplyr::select(
    MODE, dest_label,
    min_2005, median_2005, max_2005, Percentage_2005,
    min_2010, median_2010, max_2010, Percentage_2010,
    min_2015, median_2015, max_2015, Percentage_2015
  ) %>% 
  arrange(MODE, dest_label)


# Latex table
styled_table_04 <- wide_data %>%
  kable(
    format = "latex", 
    booktabs = TRUE, 
    longtable = TRUE, 
    align = c(rep("c", ncol(wide_data))),
    caption = "\\label{tab:table-04}Comparison of travel statistics by mode and destination: 2005, 2010, 2015",
   col.names = c("Destination", "Mode","Min*","Med*","Max*", "(%)*", "Min","Med","Max", "(%)", "Min","Med","Max", "(%)")
  ) %>%
  kable_styling(full_width = FALSE, 
                #latex_options=c("striped", "scale_down"), 
                latex_options=c("scale_down"),
                font_size = 6) %>%
  #column_spec(1, width = "2cm") %>%  # Set width of 'Dest' column to 1.5cm
  #column_spec(2:14, width = "0.4cm") %>%  # Set width of remaining columns to 0.7cm
  add_header_above(c(" " = 2, "2005" = 4, "2010" = 4, "2015" = 4)) %>%
  row_spec(0, bold = TRUE, align = "c") %>%
  column_spec(6, border_right = TRUE) %>%
  column_spec(10, border_right = TRUE) %>% 
  collapse_rows(columns = 1, valign = "top", latex_hline = "major") %>% 
  footnote(general = c("* The symbols used in this table represent the following: 'Min' denotes the minimum time to reach the destination; 'Max' denotes the maximum time to reach the destination; '(%)' indicates a percentage of the total time to reach the destination; 'Med' refers to the median time to reach the destination"), threeparttable = T)

styled_table_04
```

```{r include = FALSE}
styled_table_03

styled_table_04
```

```{=html}
<!-- 
Decided to not include the following tables because I transformed them into figures 
start -->
```

<!-- duration  -->

The maximum time spent on walking trips varied between 90 and 100
minutes across the years (Table \ref{tab:decrip-analysis}). It is
important to note that trips lasting more than 100 minutes were excluded
from the analysis. The mean walking time also varied, starting at 15
minutes in 1992, dropping to 11 minutes in 1998, and then increasing
steadily in subsequent surveys, reaching 18 minutes in 2022. However,
since the mean is highly influenced by extreme values, we also examine
the median travel time, which better represents a typical walking trip.
The median time spent walking remained constant at 10 minutes across the
early TUS cycles but increased to 15 minutes in 2022.

```{r table-02, echo=FALSE, cache=FALSE}
# Calculate min, mean, and max statistic (duration)
stats_data <- gss_impedances_renamed %>%
  group_by(YEAR, MODE) %>%
  dplyr::summarise(
    min = min(DURATION),
    mean = sum(DURATION * WGHT_EPI)/sum(WGHT_EPI),
    median =  Hmisc::wtd.quantile(DURATION, weights = WGHT_EPI, probs = 0.5),
    max = max(DURATION),
    std = sd(DURATION),
    .groups = "drop"
  ) %>%
  pivot_longer(cols = c(min, mean, median, max, std), names_to = "Statistic", values_to = "Value") %>%
  pivot_wider(names_from = YEAR, values_from = Value)

# Combine counts and stats into one data frame
stats_data <- stats_data %>%
  mutate(MODE = factor(MODE, levels = c("Walking", "Cycling"))) %>%
  arrange(MODE, Statistic) %>%
  mutate(across(where(is.numeric), ~ round(.x, 0)))

# Rename the 'MODE' column to 'Mode' before generating the table
stats_data <- stats_data %>%
  rename(Mode = MODE) %>%
  dplyr::select(Mode, Statistic, everything()) %>% 
   mutate(Statistic = case_when(
    Statistic == "max" ~ "Maximum",
    Statistic == "min" ~ "Minimum",
    Statistic == "mean" ~ "Mean",
    Statistic == "median" ~ "Median",
    Statistic == "std" ~ "Standard deviation",
    TRUE ~ Statistic  # Keep all other values as they are
  ))
  

# Creating a latex table
styled_table_02 <- stats_data %>%
  kable(format = "latex", booktabs = TRUE, longtable = FALSE, 
        caption = "\\label{tab:decrip-analysis}Descriptive statistics for episodes with active transport records.",  
        align = c('l', 'l', rep('c', ncol(stats_data) - 2))) %>%
  kable_styling(full_width = FALSE, font_size = 10) %>%
  column_spec(1, bold = TRUE) %>%
  add_header_above(c(" " = 2, "Year" = ncol(stats_data) - 2)) %>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major")

# Print the table
styled_table_02
```

For cycling trips, the median travel time fluctuated across the survey
periods, remaining at 15 minutes from 1992 to 2005 and peaking at 30
minutes in 2022. As was also the case with the walking travel times,
these results show a trend of increasing for cycling trip duration
throughout the years. The analysis of travel time statistics alone does
not fully explain the reasons behind these fluctuations in travel time
over the years. However, it is likely that these variations reflect
changes in bicycle technology or cyclist behaviour.

Figure \ref{fig:figure-boxplot} presents box plots showing the
distribution of travel times for active transport modes over the years,
categorized by destination. The typical duration of walking trips was
consistently shorter than that of cycling trips. While we can compare
the temporal evolution of travel times, some destinations appear only in
the two most recent surveys, such as "Neighborhood," "Health clinic,"
"Sports area," and "Business." The first three showed a constant median
walking travel time of 10 minutes in both surveys, while the median
travel time to "Business" increased from 10 to 15 minutes. For cycling
trips, "Business" recorded no trips, while "Neighborhood" had a typical
travel time of 30 minutes in 2015 but no records for 2022. "Health
clinic" showed a constant cycling travel time of 15 minutes, and "Sports
area" doubled its typical duration, from 15 to 30 minutes.

```{r include = FALSE}
# I created this version to visualize only the medians across destinations, years and mode to facilitate the explanation of the boxplots
destination_medians <- gss_impedances_renamed %>%
  uncount(weights = round(WGHT_EPI)) %>%
  group_by(YEAR, dest_label, MODE) %>%
  summarise(median_duration = median(DURATION), .groups = "drop") %>%
  ggplot(aes(x = as.factor(YEAR), y = median_duration, color = MODE, group = interaction(dest_label, MODE))) +
  geom_line() +  
  geom_point() + 
  geom_text(aes(label = round(median_duration, 1)), 
            vjust = -0.5,  
            size = 3,      
            color = "black") + 
  theme_bw() +   
  facet_wrap(~dest_label) + 
  scale_x_discrete(
    breaks = c(1992, 1998, 2005, 2010, 2015, 2022)) +
  labs(
    color = "Mode",                      
    x = "Year",                          
    y = "Travel time (in minutes)") +
  theme(legend.position = "bottom", 
        axis.title.x = element_text(size = 10), 
        axis.title.y = element_text(size = 10),
        legend.title = element_text(size = 10),
        strip.text = element_text(size = 10))

ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/destination_medians_weighted.jpg"), 
       plot = destination_medians,
       width = 12, 
       height = 8, 
       units = "in", 
       dpi = 300)
```

```{r destination_boxplots, echo=FALSE, cache=FALSE, include=FALSE}
# destination_boxplots <- gss_impedances_renamed %>%
#   uncount(weights = round(WGHT_EPI)) %>%
#   ggplot(aes(x = as.factor(YEAR), y = (DURATION), fill = MODE)) +
#   geom_boxplot(position = position_dodge(width = 1),
#                 size = 0.1,
#                 outlier.shape = NA,
#                 outlier.size = 0) +
# theme_bw() +
# facet_wrap(~dest_label) +
#   scale_x_discrete(
#     breaks = c(1992, 1998, 2005, 2010, 2015, 2022)) +
#   labs(
#     fill = "Mode",
#     x = "Year",
#     y = "Travel time (in minutes)") +
#     theme(legend.position="bottom",
#           axis.title.x = element_text(size = 10),
#           axis.title.y = element_text(size = 10),
#           legend.title = element_text(size = 10),
#           strip.text = element_text(size = 10))
# 
# ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/destination_boxplots.jpg"),
#        plot = destination_boxplots,
#        width = 12,
#        height = 8,
#        units = "in",
#        dpi = 300)
```

```{r figure-boxplot, echo=FALSE, out.width="100%", fig.cap="Percentage of walking trips categorized by origin and destination."}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/destination_boxplots.jpg"))
```

For the other destinations, starting with walking trips, we note a trend
of increasing travel times for almost all destinations, with an increase
observed at least in the most recent survey (2022). "Restaurants" and
"Outdoors" both increased their typical travel time from 5 minutes in
2005 to 10 minutes in 2022; "Other's home" rose to 10 minutes in 2022
after remaining at 5 minutes since 1992; "Place of worship" increased
from 10 minutes in 2005 to 20 minutes in 2022; and "Cultural venues"
rose from 10 minutes in 2005 to 20 minutes in 2022. The three most
popular types of destinations - "Home," "Work or school," and "Grocery
store" - had an increase to 15 minutes after decades of stabilization at
10 minutes. For both multimodal transportation options, the median
duration remained constant at 10 minutes, regardless of whether the
motorized mode involved private vehicles or public transit.

In general, while "Place of worship" and "Cultural venues" displayed the
highest median travel times of 20 minutes, the overall median walking
time cutoff across all surveys appears to be 10 minutes, with most trips
occurring below this threshold - except for 2022, when this limit was
increased by 15 minutes. No destination shows a decrease in typical
(median) travel time.

For cycling trips, only "Cultural venues" did not show an increase in
typical travel time when comparing 2022 to the previous years. In this
case, the travel time dropped from 25 minutes in 2010 to 15 minutes in
2015, although it remained higher than the 2005 value (10 minutes), and
no trips were recorded in the most recent survey (2022). "Other's home"
is the other destination with no cycling records for the 2022 survey. An
increasing trend in travel times is evident for destinations such as
"Grocery store" (rising from a median of 10 to 60 minutes between 2005
and 2022) and "Restaurant" (rising to a median of 30 minutes in 2022).
However, unlike walking, cycling trips connecting to motorized
transportation increased from 5 minutes in 1992 to 10 minutes in 2010,
and then to 30 minutes in 2022. In contrast, cycling trips connecting to
public transit decreased from 20 minutes in 2015 to 12.5 minutes in
2022.

Other destinations seem to follow a similar pattern of increasing travel
time, where higher values were recorded in earlier survey cycles,
dropped over time, and then rose again in the most recent surveys. This
is the case for "Home," which reached its highest typical travel time of
25 minutes after dropping to 10 minutes in 2010. It is also worth
mentioning "Work or school," which had a typical cycling travel time of
15 minutes in 1992, peaked at 30 minutes in 1998, dropped back to 15
minutes in 2005 and 2010, and then increased to 25 minutes in 2022.

Figures \ref{fig:walking-heatmap} and \ref{fig:cycling-heatmap} show
walking and cycling trips from 2005 to 2022 using heat maps. These maps
use color gradients to represent the percentage of trips between origins
and destinations, with darker colors indicating higher percentages and
lighter colors representing less frequent routes. Since the two initial
surveys had only a few location options, trips that started or ended at
'Elsewhere' accounted for more than 50% of cycling trips in 1992 and
1998, and over 70% and 92% of walking trips in those same years. This
representation gradually decreased to less than 7% in 2022, as more
recent surveys included a wider range of origins and destinations.

After 2005, trips that started or ended at home represented more than
66% of walking trips, with a particular highlight in 2022, when 'Home'
served as a hub for almost 83% of them. For cycling, 'Home' was a hub
for over 90% of trips since 2005, indicating that most cycling episodes
refer to people leaving or returning home. 'Work or school' was the
second most important hub, especially for cycling trips, which ranged
from 62% in 2015 to 48% in 2022. For walking, this hub was the origin or
destination of almost 40% of trips in 2022, showing an increase since
2010, when it stood at 32%.

We expected a higher representation of AT episodes starting or ending at
public transit hubs. For walking trips, this accounted for around 4% in
2022 - slightly lower than for motorized vehicles, which reached 5.7%.
For cycling, there is a trend of people using bicycles to connect to
transit, increasing from 0.2% in 2005 to 1.2% in 2022 - a small but
sixfold increase.

When comparing different combinations of origins and destinations, the
most common trips were those between 'Home' and 'Work or Study', which
increased from 12% in 2010 to 25% in 2022 for walking trips and
fluctuated between 33% and 42% for cycling trips. The second most
frequent type was between 'Home' and grocery stores, which rose from
about 11% in 2010 to 17% in 2022 for both modes. Interestingly, trips
starting and ending at home have remained stable at around 6% since 2005
for walking, but decreased steadily for cycling to around 1% in 2022.
This suggests that leisure trips, such as activities around the home,
are predominantly done on foot rather than by bicycle.

<!-- Info from the table same_OD -->

```{r make-figs-heatmaps, include=FALSE}
# Walking heat map
walking_hm_table <- gss_impedances_renamed %>%
  filter(MODE == 'Walking') %>%
  group_by(orig_label, dest_label, YEAR) %>%
  dplyr::summarise(n = sum(WGHT_EPI), .groups = "drop") %>%
  group_by(YEAR) %>%
  mutate(percentage = n / sum(n) * 100) %>%
  ungroup()


walking_hm_fig <- walking_hm_table %>%
  ggplot(aes(x = dest_label,
    y = orig_label)) +
    geom_tile(aes(fill = percentage)) +
    labs(x = "Destination",
    y = "Origin",
    fill = "Percentage (%)") + 
    geom_text(aes(label = ifelse(percentage >= 1, round(percentage), "")), 
              color = "black", size = 2.5) + 
    theme_bw() + 
    scale_fill_gradient(low = "#FFFFCC", high = "#FF7A48", name = "Percentage (%)") +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + 
    facet_wrap(~YEAR)

# Saving figure
ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/walking_hm_fig_v2.jpg"), 
       plot = walking_hm_fig,
       width = 21, 
       height = 15, 
       units = "cm", 
       dpi = 300)

# Cycling heat map
cycling_hm_table <- gss_impedances_renamed %>%
  filter(MODE == 'Cycling') %>%
  group_by(orig_label, dest_label, YEAR) %>%
  dplyr::summarise(n = sum(WGHT_EPI),
  .groups = "drop") %>%
  group_by(YEAR) %>%
  mutate(percentage = n / sum(n) * 100) %>%
  ungroup()

cycling_hm_fig <- cycling_hm_table %>%
  ggplot(aes(x = dest_label,
    y = orig_label)) +
    geom_tile(aes(fill = percentage)) +
    labs(x = "Destination",
    y = "Origin",
    fill = "Percentage (%)") + 
    geom_text(aes(label = ifelse(percentage >= 1, round(percentage), "")), 
              color = "black", size = 2.5) + 
    theme_bw() + 
    scale_fill_gradient(low = "#FFFFCC", high = "#FF7A48", name = "Percentage (%)") +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + 
    facet_wrap(~YEAR)

# Saving figure
ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/cycling_hm_fig_v2.jpg"), 
       plot = cycling_hm_fig,
       width = 21, 
       height = 15, 
       units = "cm", 
       dpi = 300)
```

```{r walking-heatmap, echo=FALSE, out.width="100%", fig.cap="Percentage of walking trips categorized by origin and destination (only combinations exceeding 1% of total trips are labeled)."}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/walking_hm_fig_v2.jpg"))
```

```{r cycling-heatmap, echo=FALSE, out.width="100%", fig.cap="Percentage of walking trips categorized by origin and destination (only combinations exceeding 1% of total trips are labeled)."}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/cycling_hm_fig_v2.jpg"))
```

```{r origin-dest-analysis, include=FALSE}
# Table to help us to identify OD combinations 

same_OD <- gss_impedances_renamed %>%
  group_by(orig_label, dest_label, MODE, YEAR) %>%
  summarise(WGHT_sum = sum(WGHT_EPI, na.rm = TRUE), .groups = "drop") %>%
  group_by(MODE, YEAR) %>%
  mutate(total_trip = sum(WGHT_sum, na.rm = TRUE)) %>%
  ungroup() %>%
  tidyr::pivot_longer(cols = c(orig_label, dest_label), 
                      names_to = "type",values_to = "Location") %>%
  filter(!is.na(Location)) %>%
  group_by(Location, MODE, YEAR) %>%
  summarise(Origen = sum(ifelse(type == "orig_label", WGHT_sum, 0), na.rm = TRUE),
    Destination = sum(ifelse(type == "dest_label", WGHT_sum, 0), na.rm = TRUE),
    total_trip = mean(total_trip, na.rm = TRUE),
    .groups = "drop") %>%
  mutate(Percentual = round((Origen + Destination) / total_trip * 100, 1)) %>%
  arrange(MODE, YEAR, Location) %>% 
  mutate(Location = as.factor(Location))
```

We analyzed whether the temporal differences in travel times for the
destinations were statistically significant. Only destinations that
appear in more than one survey year can have their temporal evolution
analyzed. Therefore, out of the twelve possible destinations, some
cycling locations could not be temporally analyzed: "Business,"
"Neighborhood," and "Place of worship." In the case of walking trips,
all destinations could be analyzed over time.

After performing the Kruskal-Wallis test (to assess whether there was a
statistically significant difference between the distributions of
empirical travel time values, considering the time differences for each
destination and the weight of each episode) and the pairwise Wilcoxon
test, we were able to identify the destinations where a statistically
significant difference was detected. For both AT modes, the possible
destinations had at least two year with statistically significant
difference in travel times (p-value \< 0.05, Table A.1). Considering the
cycling mode and, for instance, the "Home" destination, there was a
statistically significant difference for every possible combination of
two survey cycles. This result indicates that the previously discussed
increase in typical cycling travel time for home destinations when
compared 2022 to 1992 is statistically significant.

### Population with records of active trip

<!-- prevalence  -->

```{r pop-table-with-prevalence, include = FALSE, cache = FALSE}
# Checking if the person has or active episode 
person_activity <- main_act_eps %>%
  group_by(PUMFID, YEAR, GENDER2, AGE) %>%
  summarise(
    WGHT_PER = first(WGHT_PER),
    has_walk = any(MODE == "Walking" & Count > 0),
    has_cycle = any(MODE == "Cycling" & Count > 0),
    .groups = "drop"
  ) %>%
  mutate(
    has_active = has_walk | has_cycle
  )

# Function to compare shares
get_share_table <- function(df, group_var) {
  df %>%
    group_by(YEAR, {{ group_var }}) %>%
    summarise(
      pop = sum(WGHT_PER),
      walk = sum(WGHT_PER[has_walk]),
      cycle = sum(WGHT_PER[has_cycle]),
      active = sum(WGHT_PER[has_active]),
      .groups = "drop"
    ) %>%
    mutate(
      group = paste0(!!enquo(group_var)),
      perc_walk = 100 * walk / pop,
      perc_cycle = 100 * cycle / pop,
      perc_active = 100 * active / pop
    ) %>%
    select(YEAR, group, perc_walk, perc_cycle, perc_active)
}

# Percentage of active episodes - total population
total_stats <- person_activity %>%
  group_by(YEAR) %>%
  summarise(
    pop = sum(WGHT_PER),
    walk = sum(WGHT_PER[has_walk]),
    cycle = sum(WGHT_PER[has_cycle]),
    active = sum(WGHT_PER[has_active]),
    .groups = "drop"
  ) %>%
  mutate(
    group = "Total",
    perc_walk = 100 * walk / pop,
    perc_cycle = 100 * cycle / pop,
    perc_active = 100 * active / pop
  ) %>%
  select(YEAR, group, perc_walk, perc_cycle, perc_active)

# Percentage of active episodes - gender 
gender_stats <- get_share_table(person_activity, GENDER2)

# Percentage of active episodes - age 
age_compacted <- c("15 - 24", "25 - 34", "35 - 44", "45 - 54", "55 - 64", "65 - 74", "75+") 

age_stats <- get_share_table(person_activity, AGE) %>%
  mutate(group = case_when(
      group == "15 to 24 years" ~ "15 - 24",
      group == "25 to 34 years" ~ "25 - 34",
      group == "35 to 44 years" ~ "35 - 44",
      group == "45 to 54 years" ~ "45 - 54",
      group == "55 to 64 years" ~ "55 - 64",
      group == "65 to 74 years" ~ "65 - 74",
      group == "75 years and over" ~ "75+",
      TRUE ~ group))

# Join all tables in one table 
pop_stats <- bind_rows(total_stats, gender_stats, age_stats)

pop_stats <- pop_stats %>%
  pivot_wider(
    names_from = YEAR,
    values_from = c(perc_walk, perc_cycle, perc_active),
    names_glue = "{.value}_{YEAR}"
  )

pop_stats <- pop_stats %>%
  mutate(across(where(is.numeric) & !all_of("group"), ~ round(.x, 2)))

total_pop_year <- person_activity %>%
  group_by(YEAR) %>%
  summarise(total_pop = sum(WGHT_PER), .groups = "drop") %>%
  mutate(YEAR = as.character(YEAR))

pop_stats_table <- as.data.frame(pop_stats)  %>% 
    kable(format = "latex", booktabs = TRUE, longtable = TRUE, 
          caption = "\\label{tab:pop-stats-table}Prevalence of active trip by transportation mode, year of analysis, gender and age group.",  
           col.names = c(" ","1992","1998", "2005", "2010", "2015", "2022",
                         "1992","1998", "2005", "2010", "2015", "2022", 
                         "1992","1998", "2005", "2010", "2015", "2022"), 
          align = NULL) %>% 
    kable_styling(full_width = FALSE, font_size = 10) %>%
      add_header_above(c(" " = 1, 
                         "Walking" = 6,
                         "Cycling" = 6, 
                         "Both modes" = 6)) %>% 
   column_spec(1, bold = TRUE) %>% 
   column_spec(7, border_right = TRUE) %>% 
   column_spec(13, border_right = TRUE) %>% 
  row_spec(3, hline_after = TRUE) %>% 
  row_spec(5, hline_after = TRUE) %>% 
  landscape()

# pop_stats_table <- pop_stats %>%
#   kable(format = "latex", booktabs = TRUE, longtable = TRUE) %>%
#   kable_styling()
```

The share of the population with active trip records decreased
significantly since 1992, when it reached almost 25%, to less than 10.5%
in 2022 (Table \ref{tab:pop-stats-table}). This decline in the
representation of people with AT episodes is evident in both modes, but
it is more highlighted for walking trips, which fell from around 23% in
1992 to about 9.5% in 2022. In the last survey year, just *2,873,878*
people out of a total population of *27,584,823* reported having at
least one AT episode.

```{r pop-stats-table, echo=FALSE, cache=FALSE}
pop_stats_table
```

Our results show a decline in the active population since 1992 for both
genders and for both modes of transportation (Table
\ref{tab:pop-stats-table} and Figure \ref{fig:gender-perc-figure}).
However, the decrease was more pronounced among women+ than men+,
leading to a shift in the historical pattern in which women+ had
traditionally been the more active gender in Canada [@bryan2009;
@borhani2024]. In 1992, 24.19% of women+ had at least one AT episode,
but this dropped to a low of 10.16% in 2022. Among men+, the share fell
from 24.19% in 1992 to 10.68% in 2022, making men+ the gender with the
higher share of the active population in the most recent survey year.
This result aligns with a trend identified by Borhani et al.
[-@borhani2024]. In their study, the authors found that a higher
proportion of females than males reported engaging in any form of AT,
whether walking or cycling, in the last 7 days or 3 months. However,
they also observed that this gender gap appears to have narrowed over
time.

When analyzing by transportation mode, in all survey years a higher
proportion of men+ reported at least one cycling episode on the previous
day compared to women+ (ranging from 1.33% to 2.58% for men+ and 0.47%
to 0.94% for women+). This pattern of greater men+ participation in
cycling is consistent with previous research [@heesch2012; @bryan2009;
@borhani2024]. Conversely, women+ have historically reported more
walking trips than men+, but this pattern appears to be changing, also
in line with prior findings [@goel2023; @pollard2017; @bryan2009;
@borhani2024], suggesting the possibility of a reversal in the next
survey cycle.

```{r gender-graphs, include = FALSE}
# Transforming the previous table in a long table to create graphs
gender_stats <- pop_stats %>%
  filter(group %in% c("Men+","Women+")) %>% 
  rename(Gender = group)

long_gender <- gender_stats %>%
  pivot_longer(
    cols = starts_with("perc_"),
    names_to = c("Mode", "Year"),
    names_pattern = "perc_(.*)_(\\d+)",
    values_to = "Value"  
  ) %>%
  mutate(Year = as.numeric(Year),
          Mode = case_when(
          Mode == "walk" ~ "Walking",
          Mode == "cycle" ~ "Cycling",
          Mode == "active" ~ "Active",
          TRUE ~ Mode
    )
  ) %>%
  select(Year, Gender, Mode, Value)

# Gender Graph
active_pop_gender_graph <- ggplot(long_gender, aes(x = Year, y = Value, linetype = Gender)) +
  geom_line(linewidth = 0.5) +
  geom_point(size = 0.75) +
  theme_minimal() +
    labs(y = "Percentage (%)", x = "") +  
  scale_x_continuous(
    breaks = c(1992, 1998, 2005, 2010, 2015, 2022), guide = guide_axis(angle = 45)) + 
  facet_wrap(~Mode)

# Saving figure
ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/active_pop_gender_graph.jpg"), 
       plot = active_pop_gender_graph,
       width = 20, 
       height = 6, 
       units = "cm", 
       dpi = 300)
```

```{r gender-perc-figure, echo=FALSE, out.width="100%", fig.cap="Prevelance in activity transportation by gender."}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/active_pop_gender_graph.jpg"))
```

The decreasing of AT participation when compared to ealier surveys is
perceptible for all group ages (Figure \ref{fig:age-perc-figure}). The
youngest group (those between 15 and 24 years) stand out as the most
active group, ranging from 20% to 37%, and marking 23% in the most
recent survey. This is the only group that did not show a decrease in
the prevalence of active participation in 2022 when compared to 2015 -
although still below the levels recorded in 2010 (30%). The survey of
2022 is one more evidence of caracterists of the Generation z (born
between 1997 and 2012) [@dimock2019] are noticeably less dependent on
cars and instead use environmentally friendly modes of travel, such as
public transport, cycling and walking, more often than not [@haseeb2024;
@grimsrud2014; @kuhnimhof2011]. Historically, and in consistency with
the literature [@bryan2009; @borhani2024], prevalence decreases as age
increases. However, in the most recent survey (2022), the oldest group
(75 years and older) presented the fourth-highest prevalence (7.08%),
surpassing younger groups.

The analysis by mode shows a similar trend (Figure
\ref{fig:age-perc-figure}). However, for cycling, the second youngest
group (aged 25 to 34 years) had the highest prevalence in the 2022
survey (1.60%), surpassing the youngest group (1.58%). For all other age
groups, cycling prevalence decreases as age increases, approaching 0.10%
for the oldest group (75 years and older).

```{r active_pop_age_proportion, include = FALSE}
# Transforming the previous table in a long table to create graphs (age version)
age_stats <- pop_stats %>%
  filter(!group %in% c("Total","Men+","Women+")) %>% 
  rename(Age = group)

long_age <- age_stats %>%
  pivot_longer(
    cols = starts_with("perc_"),
    names_to = c("Mode", "Year"),
    names_pattern = "perc_(.*)_(\\d+)",
    values_to = "Value"  
  ) %>%
  mutate(
    Year = as.numeric(Year),
    Mode = case_when(
      Mode == "walk" ~ "Walking",
      Mode == "cycle" ~ "Cycling",
      Mode == "active" ~ "Active",
      TRUE ~ Mode
    )
  ) %>%
  select(Year, Age, Mode, Value)

age_palette <-  c("#D53E4F", "#FC8D59", "#ffd92f","#E5E5AB", "#E6F598", "#99D594", "#3288BD")

#Age Graph
active_pop_age_graph <- ggplot(long_age, 
                                    aes(x = Year, y = Value, color = Age)) +
  geom_line(linewidth = 0.6) +
  geom_point(size = 0.75) +
  theme_minimal() +
  labs(y = "Percentage (%)") +  
  scale_x_continuous(breaks = c(1992, 1998, 2005, 2010, 2015, 2022), guide = guide_axis(angle = 45)) +
  scale_color_manual(values = age_palette) + 
  facet_wrap(~ as.factor(Mode)) +
  labs(color = "Age") + 
  facet_wrap(~Mode)

# Saving figure
ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/active_pop_age_graph.jpg"), 
       plot = active_pop_age_graph,
       width = 20, 
       height = 6, 
       units = "cm", 
       dpi = 300)
```

```{r age-perc-figure, echo=FALSE, out.width="100%", fig.cap="Prevelance in activity transportation by age group."}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/active_pop_age_graph.jpg"))
```

<!-- episodes  -->

```{r episodes-per-group-table, include = FALSE}
# episode_summary <- main_act_eps %>%
#   mutate(
#     walk_eps = if_else(MODE == "Walking", Total_eps, 0),
#     cycle_eps = if_else(MODE == "Cycling", Total_eps, 0)
#   ) %>%
#   group_by(PUMFID, YEAR, GENDER2, AGE) %>%
#   summarise(
#     WGHT_PER = first(WGHT_PER),
#     walk_eps = sum(walk_eps),
#     cycle_eps = sum(cycle_eps),
#     .groups = "drop"
#   ) %>%
#   mutate(active_eps = walk_eps + cycle_eps)
# 
# # Function to compute average episodes per person
# get_eps_per_person_eps_table <- function(df, group_var) {
#   df %>%
#     group_by(YEAR, {{ group_var }}) %>%
#     summarise(
#       pop = sum(WGHT_PER),
#       total_walk = sum(walk_eps),
#       total_cycle = sum(cycle_eps),
#       total_active = sum(active_eps),
#       .groups = "drop"
#     ) %>%
#     mutate(
#       group = paste0(!!enquo(group_var)),
#       eps_per_person_walk = total_walk / pop,
#       eps_per_person_cycle = total_cycle / pop,
#       eps_per_person_active = total_active / pop
#     ) %>%
#     select(YEAR, group, eps_per_person_walk, eps_per_person_cycle, eps_per_person_active)
# }
# 
# total_eps_stats <- episode_summary %>%
#   group_by(YEAR) %>%
#   summarise(
#     pop = sum(WGHT_PER),
#     total_walk = sum(walk_eps),
#     total_cycle = sum(cycle_eps),
#     total_active = sum(active_eps),
#     .groups = "drop"
#   ) %>%
#   mutate(
#     group = "Total",
#     eps_per_person_walk = total_walk / pop,
#     eps_per_person_cycle = total_cycle / pop,
#     eps_per_person_active = total_active / pop
#   ) %>%
#   select(YEAR, group, eps_per_person_walk, eps_per_person_cycle, eps_per_person_active)
# 
# gender_eps_stats <- get_eps_per_person_eps_table(episode_summary, GENDER2)
# 
# age_eps_stats <- get_eps_per_person_eps_table(episode_summary, AGE)
# 
# episodes_stats <- bind_rows(total_eps_stats, gender_eps_stats, age_eps_stats) %>% 
#   mutate(eps_per_person_walk = round(eps_per_person_walk, 2), 
#          eps_per_person_cycle = round(eps_per_person_cycle, 2),
#          eps_per_person_active = round(eps_per_person_active, 2))
# 
# episodes_stats <- episodes_stats %>%
#   pivot_wider(
#     names_from = YEAR,
#     values_from = c(eps_per_person_walk, eps_per_person_cycle, eps_per_person_active),
#     names_glue = "{.value}_{YEAR}") 

# eps_person_stats_table <- episodes_stats  %>% 
#    kable(format = "latex", booktabs = TRUE, longtable = TRUE, 
#          caption = "\\label{tab:eps-total-pop}Episodes of active trip per person by transportation mode, year of analysis, gender and age group.",  
#          col.names = c(" ","1992","1998", "2005", "2010", "2015", "2022",
#                        "1992","1998", "2005", "2010", "2015", "2022", 
#                        "1992","1998", "2005", "2010", "2015", "2022"), 
#          align = c('l', rep('c', ncol(pop_stats) - 1))) %>% 
#    kable_styling(full_width = FALSE, font_size = 6) %>%
#    add_header_above(c(" " = 1, 
#                       "Walking" = 6,
#                       "Cycling" = 6, 
#                       "Walking and Cycling" = 6)) %>% 
#   column_spec(1, bold = TRUE) %>% 
#   column_spec(7, border_right = TRUE) %>% 
#   column_spec(13, border_right = TRUE)
```

The number of people with active trip episodes is primarily influenced
by walking, since over 92% of all recorded active trips involve
individuals with walking episodes. When analyzing the average number of
episodes per person with AT records, the mean is approximately 2.3
active episodes per person, ranging from a maximum of 2.37 episodes in
1992 to a minimum of 2.19 episodes in 2022. Figure
\ref{fig:gender-eps-figure} presents, for each survey year, the total
number of active episodes divided by the population with active records,
as well as the number of walking episodes per person who walked and the
number of cycling episodes per person who cycled, all disaggregated by
gender. Historically, men+ recorded more active episodes than women+,
but this pattern appears to be shifting. While men+ decreased from 2.51
episodes in 1992 to 2.22 in 2022, women+ also experienced a decline,
though smaller, from 2.24 to 2.17 episodes. This shift is mainly caused
by a reduction in walking episodes among men+, combined with an increase
in both walking and cycling episodes among women+ in 2022.

```{r active-pop-gender-eps, include = FALSE}
# Code to create graphs about the active population|
# I adapted the previous episodes per person code with the difference that I applied a filter to select only the active population (Count > 0)

person_profile <- main_act_eps %>%
  filter(Count > 0) %>%
  group_by(PUMFID, YEAR) %>%
  summarise(
    is_walker = any(MODE == "Walking"),
    is_cyclist = any(MODE == "Cycling"),
    .groups = "drop"
  ) %>%
  mutate(is_active = is_walker | is_cyclist)

episode_summary_active_only <- main_act_eps %>%
  filter(Count > 0) %>%
  mutate(
    walk_eps = if_else(MODE == "Walking", Total_eps, 0),
    cycle_eps = if_else(MODE == "Cycling", Total_eps, 0)
  ) %>%
  group_by(PUMFID, YEAR, GENDER2, AGE) %>%
  summarise(
    WGHT_PER = first(WGHT_PER),
    walk_eps = sum(walk_eps),
    cycle_eps = sum(cycle_eps),
    .groups = "drop"
  ) %>%
  mutate(active_eps = walk_eps + cycle_eps) %>%
  left_join(person_profile, by = c("PUMFID", "YEAR"))

get_eps_per_active_person_table <- function(df, group_var) {
  df %>%
    group_by(YEAR, {{ group_var }}) %>%
    summarise(
      pop_walkers = sum(WGHT_PER[is_walker]),
      pop_cyclists = sum(WGHT_PER[is_cyclist]),
      active_pop = sum(WGHT_PER[is_active]),
      total_walk = sum(walk_eps),
      total_cycle = sum(cycle_eps),
      total_active = sum(active_eps),
      .groups = "drop"
    ) %>%
    mutate(
      group = paste0(!!enquo(group_var)),
      eps_per_person_walk = total_walk / pop_walkers,
      eps_per_person_cycle = total_cycle / pop_cyclists,
      eps_per_person_active = total_active / active_pop
    ) %>%
    select(YEAR, group, eps_per_person_walk, eps_per_person_cycle, eps_per_person_active)
}

total_eps_stats_active_only <- episode_summary_active_only %>%
  group_by(YEAR) %>%
  summarise(
    active_pop = sum(WGHT_PER),
    total_walk = sum(walk_eps),
    total_cycle = sum(cycle_eps),
    total_active = sum(active_eps),
    .groups = "drop"
  ) %>%
  mutate(
    group = "Total",
    eps_per_person_walk = total_walk / active_pop,
    eps_per_person_cycle = total_cycle / active_pop,
    eps_per_person_active = total_active / active_pop
  ) %>%
  select(YEAR, group, eps_per_person_walk, eps_per_person_cycle, eps_per_person_active)

gender_eps_stats_active_only <- get_eps_per_active_person_table(episode_summary_active_only, GENDER2)
age_eps_stats_active_only <- get_eps_per_active_person_table(episode_summary_active_only, AGE)

episodes_stats_active_only <- bind_rows(
  total_eps_stats_active_only,
  gender_eps_stats_active_only,
  age_eps_stats_active_only
)

episodes_stats_active_only <- episodes_stats_active_only %>%
  pivot_wider(
    names_from = YEAR,
    values_from = c(eps_per_person_walk, eps_per_person_cycle, eps_per_person_active),
    names_glue = "{.value}_{YEAR}"
  ) 

episodes_stats_active_only <- episodes_stats_active_only %>%
  mutate(across(where(is.numeric) & !all_of("group"), ~ round(.x, 2)))

eps_gender_stats <- episodes_stats_active_only %>%
  filter(group %in% c("Total", "Men+","Women+")) %>% 
  rename(Gender = group)

long_eps_gender <- eps_gender_stats %>%
  pivot_longer(
    cols = starts_with("eps_"),
    names_to = c("Mode", "Year"),
    names_pattern = "eps_per_person_(.*)_(\\d+)",
    values_to = "Value"  
  ) %>%
  mutate(
    Year = as.numeric(Year),
    Mode = case_when(
      Mode == "walk" ~ "Walking",
      Mode == "cycle" ~ "Cycling",
      Mode == "active" ~ "Active",
      TRUE ~ Mode
    )
  ) %>%
  select(Year, Gender, Mode, Value)

long_eps_gender <- long_eps_gender %>%
  filter(!(Gender == "Total" & Mode != "Active")) %>% 
  filter(!(Gender == "Total"))

# Gender Graph
eps_gender_graph <- ggplot(long_eps_gender,
                           aes(x = Year, y = Value, linetype = Gender)) +
  geom_line(linewidth = 0.5) +
  geom_point(size = 0.75) +
  theme_minimal() +
    labs(y = "Episodes") +  
  scale_x_continuous(
    breaks = c(1992, 1998, 2005, 2010, 2015, 2022), guide = guide_axis(angle = 45)) +
  facet_wrap(~Mode, 
             labeller = labeller(Mode = c("Active" = "Active episodes per active person",
                                          "Walking" = "Walk per walker",
                                          "Cycling" = "Cycle per cyclist")))

# Saving figure
ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/eps_gender_graph.jpg"), 
       plot = eps_gender_graph,
       width = 20, 
       height = 6, 
       units = "cm", 
       dpi = 300)
```

```{r gender-eps-figure, echo=FALSE, out.width="100%", fig.cap="Episodes per active person by gender."}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/eps_gender_graph.jpg"))
```

Similar to gender patterns, all age groups performed worse in 2022
compared to 1992. However, Figure \ref{fig:age-eps-figure} shows that
only the two youngest groups (those under 34 years old) did not increase
their number of episodes per person in 2022 when compared to 2015. Our
results indicate that the most active age group in 2022 was those aged
55 to 64 years, with 2.51 episodes per active person. Active individuals
in the oldest age group (75 and over) have shown a consistent upward
trend in the number of active episodes since 2005. In that year, this
group ranked last in the number of active episodes per active person
(2.08), but by 2022, it had risen to second place, with 2.26 episodes
per active person (a 9% increase). When the age group analysis is
disaggregated by transportation mode, walking episodes per walker follow
a pattern similar to that of total active episodes per active person
(Figure \ref{fig:age-eps-figure}). However, for cycling, the youngest
group has shown an increasing trend in cycling episodes per cyclist,
rising from 1.98 in 1998 to 3.00 in 2022 — a 51% increase.

```{r age-eps, include = FALSE}
age_stats_eps <- episodes_stats_active_only %>%
  filter(!group %in% c("Total","Men+","Women+")) %>% 
  rename(Age = group)

long_age_eps <- age_stats_eps %>%
  pivot_longer(
    cols = starts_with("eps_"),
    names_to = c("Mode", "Year"),
    names_pattern = "eps_per_person_(.*)_(\\d+)",
    values_to = "Value"  
  ) %>%
  mutate(
    Year = as.numeric(Year),
    Mode = case_when(
      Mode == "walk" ~ "Walking",
      Mode == "cycle" ~ "Cycling",
      Mode == "active" ~ "Active",
      TRUE ~ Mode
    )
  ) %>%
  select(Year, Age, Mode, Value)

# Age Graph
eps_age_graph <- ggplot(long_age_eps,
                           aes(x = Year, y = Value, color = Age)) +
  geom_line(linewidth = 0.6) +
  geom_point(size = 0.75) +
  theme_minimal() + 
    scale_color_manual(values = age_palette) + 
    labs(y = "Episodes") +  
  scale_x_continuous(
    breaks = c(1992, 1998, 2005, 2010, 2015, 2022), guide = guide_axis(angle = 45)) +   
  facet_wrap(~Mode, 
             labeller = labeller(Mode = c("Active" = "Active episodes per active person",
                                          "Walking" = "Walk per walker",
                                          "Cycling" = "Cycle per cyclist")))

# Saving figure
ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/eps_age_graph.jpg"), 
       plot = eps_age_graph,
       width = 20, 
       height = 6, 
       units = "cm", 
       dpi = 300)
```

```{r age-eps-figure, echo=FALSE, out.width="100%", fig.cap= "Episodes per active person by age group."}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/eps_age_graph.jpg"))
```

Regarding the duration of AT episodes, we observe an overall increase in
the typical duration of episodes for both genders and both
transportation modes across the years (Figure
\ref{fig:gender-dur-figure}). The median duration of walking trips
remained stable at 10 minutes for both men+ and women+ from 1992 to
2015, increasing to 15 minutes in 2022. For cycling trips, however, men+
reported a median cycling duration of 30 minutes in 2022, up from 15
minutes in 2005, marking the highest median duration recorded in the
entire historical series. In contrast, women+ saw a decrease in their
median duration, from 20 minutes in 2015 to 15 minutes in 2022.

```{r gender-duration, include = FALSE, cache = FALSE}
# Average
# Gender
duration_gender_mode <- gss_impedances_renamed %>%
  left_join(main_file %>% select(PUMFID, YEAR, GENDER2, WGHT_PER, dest_label),
            by = c("PUMFID", "YEAR", "dest_label")) %>%
  filter(!is.na(DURATION), DURATION > 0) %>%
  group_by(YEAR, GENDER2, MODE) %>%
  summarise(avg_duration = weighted.mean(DURATION, w = WGHT_EPI, na.rm = TRUE),
    n_episodes = n(),
    .groups = "drop"
  )

duration_gender_mode_total <- gss_impedances_renamed %>%
  left_join(main_file %>% select(PUMFID, YEAR, GENDER2, WGHT_PER, dest_label),
            by = c("PUMFID", "YEAR", "dest_label")) %>%
  filter(!is.na(DURATION), DURATION > 0) %>%
  group_by(YEAR, GENDER2) %>%
  summarise(avg_duration = weighted.mean(DURATION, w = WGHT_EPI, na.rm = TRUE),
    n_episodes = n(),
    .groups = "drop"
  ) %>% mutate(MODE = "Active") %>%
  dplyr::select(YEAR, GENDER2, MODE, avg_duration, n_episodes)

duration_gender <- rbind(duration_gender_mode, duration_gender_mode_total)

duration_gender_graph <- ggplot(duration_gender,
       aes(x = YEAR, y = avg_duration, linetype = GENDER2)) +
  geom_line(linewidth = 0.5) +
   geom_point(size = 0.75) +
  facet_wrap(~ MODE) +
  labs(
    y = "Average Duration (minutes)",
    x = "Year", 
    linetype = "Gender") +
  theme_minimal() +
  scale_x_continuous(
    breaks = c(1992, 1998, 2005, 2010, 2015, 2022),
    guide = guide_axis(angle = 45)
  )

ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/duration_gender_graph.jpg"), 
       plot = duration_gender_graph,
       width = 20, 
       height = 5, 
       units = "cm", 
       dpi = 300)

# Option by median instead of average 
duration_gender_mode_median <- gss_impedances_renamed %>%
  left_join(main_file %>% select(PUMFID, YEAR, GENDER2, WGHT_PER, dest_label),
            by = c("PUMFID", "YEAR", "dest_label")) %>%
  filter(!is.na(DURATION), DURATION > 0) %>%
  group_by(YEAR, GENDER2, MODE) %>%
  summarise(
    median_duration = wtd.quantile(DURATION, weights = WGHT_EPI, probs = 0.5, na.rm = TRUE),
    n_episodes = n(),
    .groups = "drop")

duration_gender_mode_total_median <- gss_impedances_renamed %>%
  left_join(main_file %>% select(PUMFID, YEAR, GENDER2, WGHT_PER, dest_label),
            by = c("PUMFID", "YEAR", "dest_label")) %>%
  filter(!is.na(DURATION), DURATION > 0) %>%
  group_by(YEAR, GENDER2) %>%
  summarise(
    median_duration = wtd.quantile(DURATION, weights = WGHT_EPI, probs = 0.5, na.rm = TRUE),
    n_episodes = n(),
    .groups = "drop") %>% 
  mutate(MODE = "Active") %>%
  select(YEAR, GENDER2, MODE, median_duration, n_episodes)

duration_gender_median <- bind_rows(duration_gender_mode_median, duration_gender_mode_total_median)

duration_gender_graph_median <- ggplot(duration_gender_median,
       aes(x = YEAR, y = median_duration, linetype = GENDER2)) +
  geom_line(linewidth = 0.5) +
  geom_point(size = 0.75) +
  facet_wrap(~ MODE) +
  labs(
    y = "Median Duration (minutes)",
    x = "Year", 
    linetype = "Gender") +
  theme_minimal() +
  scale_x_continuous(
    breaks = c(1992, 1998, 2005, 2010, 2015, 2022),
    guide = guide_axis(angle = 45))

# Save figure
ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/duration_gender_graph_median.jpg"), 
       plot = duration_gender_graph_median,
       width = 20, 
       height = 5, 
       units = "cm", 
       dpi = 300)
```

```{r gender-duration-boxplot, include = FALSE, cache=TRUE}
base_data <- gss_impedances_renamed %>%
   left_join(main_file %>% select(PUMFID, YEAR, GENDER2, WGHT_PER, dest_label),
             by = c("PUMFID", "YEAR", "dest_label")) %>%
   filter(MODE %in% c("Walking", "Cycling"), DURATION > 0)

active_mode <- base_data %>%
   mutate(MODE = "Active")

sampled_data <- bind_rows(base_data, active_mode) %>%
  dplyr::slice_sample(n = 1000000, weight_by = WGHT_EPI, replace = TRUE)

gender_duration_boxplots <- sampled_data %>%
   ggplot(aes(x = as.factor(YEAR), y = DURATION, fill = GENDER2)) +
   geom_boxplot(position = position_dodge(width = 1),
                size = 0.1,
                outlier.shape = NA,
                outlier.size = 0) +
   theme_bw() +
   facet_wrap(~MODE) +
   scale_x_discrete(
     breaks = c(1992, 1998, 2005, 2010, 2015, 2022)) +
   labs(
     fill = "Gender",
     x = "Year",
     y = "Travel time (in minutes)") +
   theme(
     legend.position = "bottom",
     axis.title.x = element_text(size = 10),
     axis.title.y = element_text(size = 10),
     legend.title = element_text(size = 10),
     strip.text = element_text(size = 10)
   ) +
   scale_fill_manual(values = c("Women+" = "#999999", "Men+" = "#E69F00"))

ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/gender_duration_boxplots_sample.jpg"),
        plot = gender_duration_boxplots,
        width = 20,
        height = 6,
        units = "cm",
        dpi = 300)
```

```{r gender-dur-figure, echo=FALSE, out.width="100%", fig.cap="Duration (in minutes) of active episodes by gender."}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/gender_duration_boxplots_sample.jpg"))
```

An examination by age group reveals a general increase in AT trip
duration across all groups since 1998 (Figure \ref{fig:age-dur-figure}).
With the exception of the 65 to 74 age group, for which the typical
walking duration remained constant at 10 minutes, all other groups
increased their typical walking duration to 15 minutes. Regarding
cycling trips, two distinct periods can be identified: from 1992 to
2010, when the median duration decreased, and from 2010 to 2022, when
the typical duration increased across all age groups.

```{r age-duration, include=FALSE, cache=TRUE}
# Age 
duration_age_mode <- gss_impedances_renamed %>%
  left_join(main_file %>% select(PUMFID, YEAR, AGE, WGHT_PER, dest_label),
            by = c("PUMFID", "YEAR", "dest_label")) %>%
  filter(!is.na(DURATION), DURATION > 0) %>%
  group_by(YEAR, AGE, MODE) %>%
  summarise(avg_duration = weighted.mean(DURATION, w = WGHT_EPI, na.rm = TRUE),
    n_episodes = n(),
    .groups = "drop"
  ) 

duration_age_mode_total <- gss_impedances_renamed %>%
  left_join(main_file %>% select(PUMFID, YEAR, AGE, WGHT_PER, dest_label),
            by = c("PUMFID", "YEAR", "dest_label")) %>%
  filter(!is.na(DURATION), DURATION > 0) %>%
  group_by(YEAR, AGE) %>%
  summarise(avg_duration = weighted.mean(DURATION, w = WGHT_EPI, na.rm = TRUE),
    n_episodes = n(),
    .groups = "drop"
  ) %>% mutate(MODE = "Active") %>%
  dplyr::select(YEAR, AGE, MODE, avg_duration, n_episodes)

duration_age <- rbind(duration_age_mode, duration_age_mode_total)


duration_age_graph <- ggplot(duration_age,
                           aes(x = YEAR, y = avg_duration, color = AGE)) +
  geom_line(linewidth = 0.6) +
  theme_minimal() + 
  geom_point(size = 0.75) + 
    scale_color_manual(values = age_palette) + 
  labs(
    y = "Average Duration (minutes)",
    x = "Year", 
    color = "Age") +
  scale_x_continuous(
    breaks = c(1992, 1998, 2005, 2010, 2015, 2022), guide = guide_axis(angle = 45)) +   
  facet_wrap(~MODE)

ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/duration_age_graph.jpg"), 
       plot = duration_age_graph,
       width = 20, 
       height = 6, 
       units = "cm", 
       dpi = 300)


# Option by median instead of average 
duration_age_mode_median <- gss_impedances_renamed %>%
  left_join(main_file %>% select(PUMFID, YEAR, AGE, WGHT_PER, dest_label),
            by = c("PUMFID", "YEAR", "dest_label")) %>%
  filter(!is.na(DURATION), DURATION > 0) %>%
  group_by(YEAR, AGE, MODE) %>%
  summarise(
    median_duration = wtd.quantile(DURATION, weights = WGHT_EPI, probs = 0.5, na.rm = TRUE),
    n_episodes = n(),
    .groups = "drop")

duration_age_mode_total_median <- gss_impedances_renamed %>%
  left_join(main_file %>% select(PUMFID, YEAR, AGE, WGHT_PER, dest_label),
            by = c("PUMFID", "YEAR", "dest_label")) %>%
  filter(!is.na(DURATION), DURATION > 0) %>%
  group_by(YEAR, AGE) %>%
  summarise(
    median_duration = wtd.quantile(DURATION, weights = WGHT_EPI, probs = 0.5, na.rm = TRUE),
    n_episodes = n(),
    .groups = "drop") %>% 
  mutate(MODE = "Active") %>%
  select(YEAR, AGE, MODE, median_duration, n_episodes)

duration_age_median <- bind_rows(duration_age_mode_median, duration_age_mode_total_median)

duration_age_graph_median <- ggplot(duration_age_median,
       aes(x = YEAR, y = median_duration, color = AGE)) +
  geom_line(linewidth = 0.5) +
  scale_color_manual(values = age_palette) + 
  geom_point(size = 0.75) +
  facet_wrap(~ MODE) +
  labs(
    y = "Median Duration (minutes)",
    x = "Year", 
    color = "Age group") +
  theme_minimal() +
  scale_x_continuous(
    breaks = c(1992, 1998, 2005, 2010, 2015, 2022),
    guide = guide_axis(angle = 45))

# Save figure
ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/duration_age_graph_median.jpg"), 
       plot = duration_age_graph_median,
       width = 20, 
       height = 6, 
       units = "cm", 
       dpi = 300)
```

```{r age-duration-boxplot, include = FALSE}
base_data_age <- gss_impedances_renamed %>%
  left_join(main_file %>% select(PUMFID, YEAR, AGE, WGHT_PER, dest_label),
            by = c("PUMFID", "YEAR", "dest_label")) %>%
  filter(MODE %in% c("Walking", "Cycling"), DURATION > 0)

sampled_data_age <- base_data_age %>%
  dplyr::slice_sample(n = 1000000, weight_by = WGHT_EPI, replace = TRUE)
 
 age_duration_boxplots <- sampled_data_age %>%
   ggplot(aes(x = as.factor(YEAR), y = DURATION, fill = MODE)) +
   geom_boxplot(position = position_dodge(width = 1),
                size = 0.1,
                outlier.shape = NA,
                outlier.size = 0) +
   theme_bw() +
   facet_wrap(~AGE) +
   scale_x_discrete(
     breaks = c(1992, 1998, 2005, 2010, 2015, 2022)) +
   labs(
     fill = "Mode",
     x = "Year",
     y = "Travel time (in minutes)") +
   theme(
     legend.position = "bottom",
     axis.title.x = element_text(size = 10),
     axis.title.y = element_text(size = 10),
     legend.title = element_text(size = 10),
     strip.text = element_text(size = 10)
   )

 ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/age_duration_boxplots.jpg"),
        plot = age_duration_boxplots,
        width = 20,
        height = 20,
        units = "cm",
        dpi = 300)
```

```{r age-dur-figure, echo=FALSE, out.width="100%", fig.cap="Duration (in minutes) of active episodes by Age group."}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/age_duration_boxplots.jpg"))
```

## Calibrated impedance function

```{r selected-functions, echo=FALSE, cache=FALSE, warning=FALSE, include=FALSE}
selected_functions <- gss_impedances_renamed %>% 
  group_by(MODE, YEAR, dest_label) %>% 
  dplyr::summarise(Function = first(f_name), 
            est_1 = first(est_1),
            est_2 = first(est_2),
            AIC = first(aic),
            f_name = first(f_name),
            count = first(count),
            .groups = "drop") %>% 
  mutate(Function = case_when(
    Function == "lnorm" ~ "Lognormal",
    Function == "gamma" ~ "Gamma",
    Function == "unif" ~ "Uniform",
    Function == "norm" ~ "Normal",
    TRUE ~ Function), 
  across(c(est_1,est_2), ~ round(., digits = 2)), 
  across(c(AIC), ~ round(., digits = 0))) %>% 
  rename(Mode = MODE, Year = YEAR, Destination = dest_label)

walking_functions_table <- selected_functions %>%
  arrange(Year, Destination) %>% 
  filter(Mode == 'Walking') %>% 
  select(Year, Destination, Function,est_1,est_2, AIC, count) %>% 
  mutate(across(c(AIC, count), 
                ~ number(., accuracy = 1, big.mark = ","))) %>% 
  kable(format = "latex",
        booktabs = TRUE,
        caption = paste0("\\label{tab:walking-functions-tab}Impedance functions and AIC for walking trips."), 
        col.names = c("Year", "Destination", "Impedance function","Parameter 1*","Parameter 2*", "AIC", "Count")) %>%
    kable_styling(full_width = FALSE, 
                latex_options=c("scale_down"),
                font_size = 8) %>% 
  row_spec(0, bold = TRUE, align = "c") %>% 
  collapse_rows(columns = 1, valign = "top", latex_hline = "major") %>%
  footnote(general = c("For each probability distribution, Parameter 1 and Parameter 2 correspond to their standard defining parameters: the mean and standard deviation (for lognormal and normal), the rate and shape (for gamma), and the minimum and maximum bounds (for uniform). The AIC represents the Akaike Information Criterion used to assess model fit."), threeparttable = T)  %>%
  kable_styling(latex_options = "HOLD_position")

biking_functions_table <- selected_functions %>%
  arrange(Year, Destination) %>% 
  filter(Mode == 'Cycling') %>% 
  select(Year, Destination, Function, est_1, est_2, AIC, count) %>%
  mutate(across(c(AIC, count), 
                ~ number(., accuracy = 1, big.mark = ","))) %>% 
  kable(format = "latex",
        booktabs = TRUE,
        caption = paste0("\\label{tab:cycling-functions-tab}Impedance functions and AIC for cycling trips."), 
        col.names = c("Year", "Destination", "Impedance function","Parameter 1*","Parameter 2*", "AIC", "Count")) %>% 
    kable_styling(full_width = FALSE, 
                latex_options=c("scale_down"),
                font_size = 8) %>% 
  row_spec(0, bold = TRUE, align = "c") %>% 
  collapse_rows(columns = 1, valign = "top", latex_hline = "major") %>%
  footnote(general = c("For each probability distribution, Parameter 1 and Parameter 2 correspond to their standard defining parameters: the mean and standard deviation (for lognormal and normal), the rate and shape (for gamma), and the minimum and maximum bounds (for uniform). The AIC represents the Akaike Information Criterion used to assess model fit."), threeparttable = T) %>%
  kable_styling(latex_options = "HOLD_position")
```

In total, we fitted `r nrow(selected_functions)` impedance functions
considering different destinations, AT mode, and survey-years. Among the
candidate distributions, only the negative exponential type was not
fitted as the best option. The absence of exponential functions, given
the variety of destinations, year and mode of transport, indicates that
the impedance functions applied in active accessibility studies may not
be adequately measuring travel behaviour, especially for cases when the
travel time is close to 0 minute. Table A.2 displays the selected
functions for walking trips, while Table A.3 presents the functions for
cycling trips.

As an example, figure \ref{fig:outdoors-impedance-fig} shows the calibrated functions
for the destination 'Outdoors,' along with a histogram of the empirical
distribution of trips, split by year and transportation mode. Starting
with the functions from the walking transportation mode (blue curves),
the calibrated functions from this example show a similar pattern. At a
duration of around zero minutes, the probability of making the trip is
lower (with a density of zero for the years 2015 and 2022). After a few
minutes, there is a peak in the maximum probability of traveling to
reach 'Outdoors,' followed by a drop in willingness to zero for very
high values of time, indicating a low probability of making the trip.

```{r mean_functions, include = FALSE}
mean_functions <- selected_functions %>% 
  group_by(Function) %>%
  dplyr::summarise(mean = mean(count))

mean_gamma <- round(mean_functions[mean_functions$Function == 'Gamma', ]$mean)
mean_uniform <- round(mean_functions[mean_functions$Function == 'Uniform', ]$mean)
mean_lognormal <- round(mean_functions[mean_functions$Function == 'Lognormal', ]$mean)
```

```{r theoretical_impedance_values, include = FALSE}
theoretical_impedance <- function(df_functions, travel_cost) {
  
  # Initialize the main data frame to store results
  result <- data.frame()
  
  # Create the 't' sequence
  t_seq <- seq(1, travel_cost, 1)
  
  for (mode in unique(df_functions$Mode)){
    
    for (year in unique(df_functions[df_functions$Mode == mode, ]$Year)){ 
      
      for (destino in unique(df_functions[df_functions$Year == year & df_functions$Mode == mode, ]$Destination)){
        
      name_function <- df_functions[df_functions$Year == year & 
                                      df_functions$Mode == mode & 
                                      df_functions$Destination == destino, ]$f_name
      
      print(paste0("YEAR: ", year, " MODE: ", mode," Destination: ", destino))
      
      subset <- df_functions %>% 
        filter(Year == year & Mode == mode & Destination == destino)
      
      # Temporary data frame for this iteration
      temp_df <- data.frame(t = t_seq)
      
      # Add the appropriate distribution
      if (name_function == "lnorm") {
        temp_df$f <- dlnorm(temp_df$t,
                            meanlog = subset$est_1[1],
                            sdlog = subset$est_2[1])
        
      } else if (name_function == "gamma") {  
        temp_df$f <- dgamma(temp_df$t,
                            shape = subset$est_1[1],
                            rate = subset$est_2[1])
        
      } else if (name_function == "norm") {  
        temp_df$f <- dnorm(temp_df$t,
                           mean = subset$est_1[1],
                           sd = subset$est_2[1])
        
      } else if (name_function == "exp") {  
        temp_df$f <- dexp(temp_df$t,
                          rate = subset$est_1[1])
        
      } else if (name_function == "unif") {  
        temp_df$f <- dunif(temp_df$t,
                           min = subset$est_1[1],
                           max = subset$est_2[1])
      }
      
      # Add mode, year and destination columns
      temp_df$MODE <- mode
      temp_df$YEAR <- year
      temp_df$dest_label <- destino
        
      # Append to the result data frame
      result <- rbind(result, temp_df)
    }
  }
}
  return(result)
}

theoretical_values <- theoretical_impedance(selected_functions, travel_cost = max_duration)
```

```{r include = FALSE}

for(destino in unique(gss_impedances_renamed$dest_label)){
  
  medianas <- gss_impedances_renamed %>%
    filter(dest_label == destino) %>%
    group_by(MODE) %>%
    dplyr::summarise(mediana_duracao = Hmisc::wtd.quantile(DURATION, weights = WGHT_EPI, probs = 0.5), .groups = 'drop')
  
  maximos <- theoretical_values %>%
    filter(dest_label == destino) %>%
    group_by(MODE, YEAR) %>%
    filter(f == max(f)) %>%
    slice(which.max(t)) %>%
    ungroup()
  
combined_plot <- gss_impedances_renamed %>% 
  filter(dest_label == destino) %>%
  mutate(dest_label = factor(dest_label, levels = destination_order)) %>%
  ggplot(aes(x= DURATION)) +
  geom_histogram(aes(y = ..density.., colour = MODE, fill = MODE), bins = 20, alpha=0.1, position="identity") + 
  geom_line(data = theoretical_values[theoretical_values$dest_label == destino, ], aes(x = t, y = f, colour = MODE), size = 0.8) +   
  geom_vline(data = medianas, aes(xintercept = mediana_duracao, color = MODE), linetype = "dashed") + 
  geom_point(data = maximos, aes(x = t, y = f, colour = MODE), size = 3) + 
  geom_label(data = maximos, aes(x = t, y = f, label = round(t, 2), colour = MODE), 
            vjust = 0, size = 3) +
  theme_minimal() +
  facet_wrap(~YEAR) + 
  labs(x = "Trip duration (in minutes)", y = "Density", colour = "Transportation Mode", fill = "Transportation Mode") +
  theme(legend.position="right", 
    strip.text = element_text(face = "bold", hjust = 0))

  plots <- length(unique(gss_impedances_renamed[gss_impedances_renamed$dest_label == destino, ]$YEAR))
 
  # Case of only one year 
    if(plots == 1){
      ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/impf_",destino,".jpg"), 
       plot = combined_plot,
       width = 7, 
       height = 4, 
       units = "in", 
       dpi = 300)
    
    # Destination present in 3 surveys  
    } else if(plots == 3){
      ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/impf_",destino,".jpg"), 
       plot = combined_plot,
       width = 14, 
       height = 4, 
       units = "in", 
       dpi = 300)
      
  # Destination present in 5 surveys  
    }else {
      ggsave(file = paste0(here::here(),"/Journal-manuscript/figures/impf_",destino,".jpg"), 
       plot = combined_plot,
       width = 14, 
       height = 9, 
       units = "in", 
       dpi = 300)
    }
}
```

```{r outdoors-impedance-fig, echo=FALSE, out.width="100%", fig.cap=paste0("Empirical data and impedance functions fitted for walking trips for Outdoors destination."), fig.align="center"}
# selecting mode and destination to display impedance functions
mode <- "Walking" 
destino <- "Outdoors"

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/impf_",destino,".jpg"))
```

For 2010, the selected impedance function has a gamma form, with a shape
parameter of $\alpha = 1.07$ and a rate parameter of $\sigma = 0.11$.
The rate parameter primarily controls the steepness of the curve’s
decline, while the shape parameter determines how the density peak
shifts along the $x$-axis (travel time). A larger shape value indicates
that the probability peak occurs at higher travel times. In 2010, the
peak occurs at 1 minute.

For 2005, 2015, and 2022, the probability density functions (PDFs) that
best represent the population’s transport behaviour are lognormal
distributions. In 2005, the distribution has a mean of $\mu = 1.99$ and
a standard deviation of $\sigma = 0.76$. In 2015, the mean increases to
$\mu = 2.58$ with a standard deviation of $\sigma = 0.75$, and in 2022,
the mean is $\mu = 2.28$ with a standard deviation of $\sigma = 0.78$.
In 2005, the density peak occurs at a journey duration of 4 minutes
(0.10), while in 2015, the peak occurs at 8 minutes (0.05). A lower
density peak corresponds to a more dispersed curve, with higher
densities at longer durations. While walking trips in 2005 and 2022 have
densities close to zero for durations beyond 50 minutes, the 2015 curve
shows a small density (0.002) at the 50-minute mark. In 2022, the
density peak occurs at 5 minutes (0.07), and the curve is less dispersed
than in 2015.

For cycling trips, the best-fitting impedance function in 2005 is of the
gamma type, while in 2010 and 2022 lognormal distributions provide the
best fit. In 2015, the best-fitting PDF is a uniform distribution with
an upper bound of 35 minutes and a peak density of 0.028. The presence
of uniform distributions indicates that it was not possible to
parameterize more complex functions due to the low number of episodes
for this specific combination of destination, mode, and year, and in
this case, only three episodes were identified. Overall, all uniform
functions involve a maximum of 11 episodes, most of which correspond to
cycling, which accounts for only 7% of all active travel episodes.
Cycling trips generally show greater dispersion and longer typical
durations compared to walking trips.

The complexity of the impedance function depends on the number of
episodes available for calibration. Fitting a gamma-type function
required an average of `r mean_gamma` episodes, while fitting a
lognormal function required approximately `r mean_lognormal` episodes.
In contrast, fitting a normal function required only six episodes, and
fitting a uniform function required, on average, just `r mean_uniform`
episodes.

The temporal evolution of the decay functions is illustrated in Figure
\ref{fig:walking-evolution-fig}, which shows calibrated functions for
each year across all destination and transport mode categories for
walking trips. For some destinations, the impedance functions are
consistent in type and parameters across all years analyzed. For
instance, trips to cultural venues consistently follow a gamma
distribution, with average trip durations increasing over time as peaks
shift to the right, a trend primarily captured by the rate parameter
($\sigma$). In contrast, trips to places of worship show more pronounced
temporal variation, with noticeable changes in peak positions and
density dispersion. The emergence of uniform distributions for this
destination indicates that the total number of trips has declined over
time.

```{r figure-walking-evolution, include = FALSE}
year_order <- c(1992,1998,2005,2010,2015,2022)

#my_colors <- kelly(length(destination_order))
my_colors_years <- c("#cbd9bf","#bae4bc","#7bccc4","#43a2ca","#0868ac","#053c63")

names(my_colors_years) <- year_order


walking_temporal_evolution <- theoretical_values %>%
  filter(MODE == 'Walking') %>%
  ggplot(aes(x=t, y=f, color = as.factor(YEAR))) +
  geom_line(size = 1) + 
  theme_minimal() +
  facet_wrap(~ dest_label) + 
  scale_color_manual(values = my_colors_years) +
  labs(x = "Walking trip duration", y = "Density", color = "Year") + 
  theme(
    strip.text = element_text(face = "bold", hjust = 0))


Cycling_temporal_evolution <- theoretical_values %>%
  filter(MODE == 'Cycling') %>%
  ggplot(aes(x=t, y=f, color = as.factor(YEAR))) +
  geom_line(size = 1) + 
  theme_minimal() +
  facet_wrap(~ dest_label) + 
  scale_color_manual(values = my_colors_years) +
  labs(x = "Cycling trip duration", y = "Density", color = "Year") + 
  theme(
    strip.text = element_text(face = "bold", hjust = 0))

ggsave(paste0(here::here(),"/Journal-manuscript/figures/walking_temporal_evolution.jpg"), walking_temporal_evolution, 
       width = 10, 
       height = 7, 
       units = "in", 
       dpi = 300)


ggsave(paste0(here::here(),"/Journal-manuscript/figures/cycling_temporal_evolution.jpg"), Cycling_temporal_evolution, 
       width = 10, 
       height = 7, 
       units = "in", 
       dpi = 300)
```

```{r walking-evolution-fig, echo=FALSE, out.width="100%", fig.cap=paste0("Temporal evolution of walking impedance functions."), fig.align="center"}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/walking_temporal_evolution.jpg"))
```

<!-- criar um paragrafo explicando a diferenca entre as duas figuras -->

```{r figure-walk-func-by-year, include = FALSE}
walking_func_by_year <- theoretical_values %>%
  filter(MODE == 'Walking') %>%
  mutate(dest_label = factor(dest_label, levels = destination_order)) %>%
  ggplot(aes(x=t, y=f, color = dest_label)) +
  theme_minimal() +
  geom_line(size = 1) + 
  facet_wrap(~YEAR   ) + 
  scale_color_manual(values = my_colors) +
  labs(x = "Walking trip duration", y = "Density", color = "Destination") + 
  theme(
    strip.text = element_text(face = "bold", hjust = 0))

ggsave(paste0(here::here(),"/Journal-manuscript/figures/walking_functions_by_year.jpg"), walking_func_by_year, 
       width = 10, 
       height = 5, 
       units = "in", 
       dpi = 300)
```

```{r walking-function-by-year-fig, echo=FALSE, out.width="100%", fig.cap=paste0("Walking functions grouped by year."), fig.align="center"}
# 
# knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/walking_functions_by_year.jpg"))
```

```{r bike-figure-func-by-year, include = FALSE}
functions_by_year <- theoretical_values %>%
  filter(MODE == 'Cycling') %>%
  mutate(dest_label = factor(dest_label, levels = destination_order)) %>%
  ggplot(aes(x=t, y=f, color = dest_label)) +
  theme_minimal() +
  geom_line(size = 1) + 
  facet_wrap(~YEAR   ) + 
  scale_color_manual(values = my_colors) +
  labs(x = "Cycling trip duration", y = "Density", color = "Destination") + 
  theme(
    strip.text = element_text(face = "bold", hjust = 0))

ggsave(paste0(here::here(),"/Journal-manuscript/figures/cycling_functions_by_year.jpg"), functions_by_year, 
       width = 10, 
       height = 5, 
       units = "in", 
       dpi = 300)
```

Figure \ref{fig:cycling-function-by-year-fig} presents the calibrated impedance functions for the cycling mode, separated by survey year. We observe that these functions align with the previously described trends for walking episodes, with the most recent functions (2022) showing a peak at longer durations compared with earlier cycles. Initially, peaks were concentrated around 15 minutes, whereas in the most recent cycle they shift to approximately 25 minutes. The functions also show, for each year, how Canadians' cycling behaviour varies by destination type. For example, the function for grocery store trips exhibits a more evenly distributed density, although its peak is concentrated around 45 minutes. The function for health clinic trips shows that durations longer than one hour have essentially zero probability. In contrast, Canadians who cycle to work or school typically travel around 20 minutes, with trips longer than this becoming increasingly unlikely (especially those exceeding 50 minutes).

```{r cycling-function-by-year-fig, echo=FALSE, out.width="100%", fig.cap=paste0("Cycling functions grouped by year."), fig.align="center"}

knitr::include_graphics(paste0(here::here(),"/Journal-manuscript/figures/cycling_functions_by_year.jpg"))
```

In terms of transportation planning, the diversity of impedance functions contributes to the understanding that relying on a generic function in accessibility studies can lead to misrepresented indicators, since opportunities may end up being distributed in an inadequate way. While the statistics presented earlier describe the typical travel times for different modes, destinations, and population groups over the years, calibrated impedance functions illustrate how far the general population is actually willing to walk or cycle to reach a variety of opportunities, including non-work activities.

In addition, these functions allow us to examine how accessibility to specific destinations has changed over the past 30 years. For instance, we know that the typical travel time for walking trips increased in 2022 compared with earlier cycles. With calibrated functions, we can assess whether this increase in travel time corresponds to a greater number of opportunities being reached by the population, helping us understand not only how active travel has changed over time but also how active accessibility has evolved.

# Limitations

Although the Canadian TUS is a reliable and standardized data source, its two most recent cycles (2015 and 2022) present a limitation for
transportation analysis due to their use of fixed time intervals for
reporting activities. We believe that using a 5-minute time interval introduces
fewer complications than a 10-minute interval, but it still causes
rounding effects: reported travel times are rounded to multiples of five
minutes, and trips shorter than 2.5 minutes are likely omitted.

To assess the potential impact of these omissions, we estimated the
percentage of walking and cycling episodes shorter than 2.5 minutes in
earlier cycles (1992, 1998, 2005, and 2010). For walking trips, short
episodes showed a clear upward trend: 0.6% in 1992, 12% in 1998, 13% in
2005, and 15% in 2010. This pattern suggests a growing share of very
short walking trips over time and implies that some trips were likely
omitted from the 2015 and 2022 datasets due to the 5-minute reporting
interval.

To further investigate this issue for 2022, we estimated the proportion
of omitted travel episodes by examining cases where individuals changed
location between consecutive episodes without reporting a travel
activity. We first interpreted such transitions as unreported trips
shorter than 2.5 minutes. Our analysis indicates that approximately
20.4% of travel episodes were omitted in 2022. Among all mobility cases,
walking represented 11.3% and cycling 0.96% of reported trips. Based on
these proportions, we estimate that approximately 2.3% of walking and
0.2% of cycling episodes were omitted due to time-interval rounding. In terms of population, 22.2% of respondents had at least one omitted
trip, with an estimated 2.7% missing walking and 0.25% missing cycling
episodes. Given that short trips are most often made by walking or car,
these values likely represent a conservative estimate of AT
underreporting. For cycling, short episodes represented 0% in 1992, 4%
in 1998, and less than 2.5% in both 2005 and 2010, suggesting minimal
underreporting for this mode.

In 2015, 19.2% of cases showed a change in location without an intermediate travel episode. For the 2010 TUS, the last cycle before the introduction of the 5-minutes  interval, we found 11.1% of such cases, a lower proportion than in 2015 and 2022 but still notable. Comparable rates were 10.6% in 2005, 9.8% in 1998, and 15% in 1992. These results suggest that omissions of travel episodes may also comes from reporting errors or inconsistencies in diary completion, rather than from the fixed-interval design alone.

Therefore, the adoption of a 5-minute interval by Statistics Canada in
TUS 2015 and 2022 represents the main limitation for our study. However,
because this time interval is relatively short, we believe the impact on
typical travel durations is minimal. In fact, despite the increase in
short-trip representation between 1998 and 2010, the median walking time
remained stable at 10 minutes. The more significant impact likely lies
in counts of episodes per active person and the share of the population
reporting AT episodes, as shorter trips are more likely to omission.
Nevertheless, the observed trends (a declining number of active episodes
per person and a decreasing share of the active population) were already
evident before 2015 and are consistent with other Canadian studies.

The second limitation concerns omitted trips. However, the percentage of omitted trips in each cycle does not appear to substantially affect our findings, as 1992 registered the third-highest share of omissions yet still showed the highest percentage of the population with AT records and the greatest number of active episodes per active person. 

```{r checking-short-trips,include= FALSE}
short_dur_summary <- gss_episodes_renamed %>%
  group_by(MODE, YEAR) %>%
  dplyr::summarise(total_weight = sum(WGHT_EPI, na.rm = TRUE),
                   short_weight = sum(WGHT_EPI[DURATION < 2.5], na.rm = TRUE),
                   percentage_short = round(short_weight / total_weight * 100, 1),
                   .groups = "drop") %>%
  arrange(YEAR, MODE)
```

```{r 2022-omiited-trips, include=FALSE}
gss_e_2022_spss <- read.spss(paste0(here(), "/data-raw/Time-use-2022/gss_tu_episode_2022_pumf_v1.sav"), to.data.frame = TRUE)# Original file 

gss_m_2022 <- read.spss(paste0(here(), "/data-raw/Time-use-2022/gss_tu_main_2022_pumf_v1.sav"), to.data.frame = TRUE) # Original file

gss_m_2022 <- gss_m_2022  %>%
  dplyr::select(PUMFID, WGHT_PER, LUC_RST,PRV) 

episodes_2022 <- gss_e_2022_spss %>% 
  left_join(gss_m_2022, by = 'PUMFID') %>%
  mutate(DURATION = as.numeric(as.character(DURATION)), 
         WGHT_EPI = as.numeric(as.character(WGHT_EPI)), 
         WGHT_PER = as.numeric(as.character(WGHT_PER))) %>% 
  filter(LUC_RST == "Larger urban population centres (CMA/CA)") %>% 
  dplyr::select(PUMFID:ACTIVITY,WGHT_PER, DURATION, LUC_RST) %>% 
  arrange(PUMFID, INSTANCE) %>% 
  group_by(PUMFID) %>%
  mutate(origin = lag(LOCATION)) %>% 
  ungroup() %>%
  mutate(omitted_case = LOCATION != origin & (!str_starts(LOCATION, "Travel") & !str_starts(origin, "Travel")),
    reported_case = str_starts(LOCATION, "Travel")) 

# EPS analysis 
omitted_cases_2022 <- episodes_2022 %>%
  filter(omitted_case == TRUE | reported_case == TRUE) %>% 
  dplyr::summarize(omitted_sum = sum(WGHT_EPI[omitted_case], na.rm = TRUE),
            reported_sum = sum(WGHT_EPI[reported_case], na.rm = TRUE),
            total_sum = omitted_sum + reported_sum,
            omitted_percent = round((omitted_sum/total_sum) * 100, 2))

eps_mode_share_2022 <- episodes_2022 %>%
  filter(str_starts(LOCATION, "Travel")) %>%
  group_by(LOCATION) %>%
  summarise(weighted_sum = sum(WGHT_EPI, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(total_travel = sum(weighted_sum),
         percentage = round(weighted_sum / total_travel * 100, 2))

# POP analysis 
omitted_people_2022 <- episodes_2022 %>%
  group_by(PUMFID, WGHT_PER) %>%
  summarise(WGHT_PER = first(WGHT_PER),
  has_omitted = any(omitted_case, na.rm = TRUE),.groups = "drop") %>%
  summarise(omitted_weighted = sum(WGHT_PER[has_omitted], na.rm = TRUE),
            total_weighted = sum(WGHT_PER, na.rm = TRUE),
            omitted_percent = round((omitted_weighted / total_weighted) * 100, 2))

pop_mode_share_2022 <- episodes_2022 %>%
  group_by(PUMFID) %>%
  summarise(WGHT_PER = first(WGHT_PER),
            has_travel = any(reported_case, na.rm = TRUE)) %>%
  filter(has_travel)%>%
  left_join(episodes_2022 %>%
      filter(reported_case) %>%
      mutate(MODE = str_remove(LOCATION, "^Travel - ")) %>%
      group_by(PUMFID, MODE) %>%
      summarise(has_mode = TRUE, .groups = "drop"),
    by = "PUMFID") %>%
  group_by(MODE) %>%
  summarise(weighted_sum = sum(WGHT_PER[has_mode], na.rm = TRUE),
    .groups = "drop") %>%
  mutate(total_travel_weight = sum(weighted_sum, na.rm = TRUE),
         mode_percent = round(weighted_sum / total_travel_weight * 100, 2))
```

```{r 2015-omiited-trips, include=FALSE}
gss_e_2015 <- read.csv(paste0(here(), "/data-raw/Time-use-2015/gss-e.csv"))# Original file

gss_m_2015 <- read.csv(paste0(here(), "/data-raw/Time-use-2015/gss-m.csv")) # Original file

gss_m_2015 <- gss_m_2015  %>%
  dplyr::select(PUMFID, WGHT_PER, LUC_RST,PRV) 

travel_options <- c(313:321)

episodes_2015 <- gss_e_2015 %>% 
  left_join(gss_m_2015, by = 'PUMFID') %>% 
  filter(LUC_RST == 1) %>% 
  dplyr::select(PUMFID:TUI_01,WGHT_PER, LOCATION, DURATION, LUC_RST) %>% 
  arrange(PUMFID, EPINO) %>% 
  group_by(PUMFID) %>%
  mutate(origin = lag(LOCATION)) %>% 
  ungroup() %>%
  mutate(omitted_case = LOCATION != origin & 
           !LOCATION %in% travel_options & 
           !origin %in% travel_options,
         reported_case = LOCATION %in% travel_options) 

# EPS analysis 
omitted_cases_2015 <- episodes_2015 %>%
  filter(omitted_case == TRUE | reported_case == TRUE) %>% 
  dplyr::summarize(omitted_sum = sum(WGHT_EPI[omitted_case], na.rm = TRUE),
            reported_sum = sum(WGHT_EPI[reported_case], na.rm = TRUE),
            total_sum = omitted_sum + reported_sum,
            omitted_percent = round((omitted_sum/total_sum) * 100, 2))
```


```{r 2010-short-trips, include = FALSE}
# Episode File
gss_e_2010 <- read.csv(paste0(here(), "/data-raw/Time-use-2010/gss-12M0018-E-2010-c-24-tus-ef_F1.csv")) # Original file
#gss_e_2010 <- read.csv(paste0(here(), "/data-raw/2010-gss-e-reproducibility.csv"))
# Main File
gss_m_2010 <- read.csv(paste0(here(), "/data-raw/Time-use-2010/gss-12M0018-E-2010-c-24-tus-mf_F1.csv")) # Original file
#gss_m_2010 <- read.csv(paste0(here(), "/data-raw/2010-gss-m-reproducibility.csv"))

gss_m_2010 <- gss_m_2010  %>%
  dplyr::select(RECID, WGHT_PER, LUC_RST) 

travel_options <- c(12:21)

episodes_2010 <- gss_e_2010 %>% 
  left_join(gss_m_2010, by = 'RECID') %>%
  mutate(DURATION = as.numeric(as.character(DURATION)), 
         WGHT_EPI = as.numeric(as.character(WGHT_EPI)), 
         WGHT_PER = as.numeric(as.character(WGHT_PER))) %>% 
  filter(LUC_RST == 1) %>% 
  dplyr::select(RECID, EPINO, ACTCODE, WGHT_EPI, WGHT_PER, PLACE, DURATION, LUC_RST) %>% 
  arrange(RECID, EPINO) %>% 
  group_by(RECID) %>%
  mutate(origin = lag(PLACE)) %>% 
  ungroup() %>%
  mutate(omitted_case = PLACE != origin & 
           !PLACE %in% travel_options & 
           !origin %in% travel_options,
         reported_case = PLACE %in% travel_options) 

# EPS analysis 
omitted_cases_2010 <- episodes_2010 %>%
  filter(omitted_case == TRUE | reported_case == TRUE) %>% 
  dplyr::summarize(omitted_sum = sum(WGHT_EPI[omitted_case], na.rm = TRUE),
            reported_sum = sum(WGHT_EPI[reported_case], na.rm = TRUE),
            total_sum = omitted_sum + reported_sum,
            omitted_percent = round((omitted_sum/total_sum) * 100, 2))
```

```{r 2005-short-trips, include = FALSE}
# Episode File
gss_e_2005 <- read.csv(paste0(here(), "/data-raw/Time-use-2005/gss-12M0019-E-2005-c-19-e_F1.csv")) # Original file

# Main File
gss_m_2005 <- read.csv(paste0(here(), "/data-raw/Time-use-2005/gss-12M0019-E-2005-c-19-m_F1.csv")) 

gss_m_2005 <- gss_m_2005  %>%
  dplyr::select(RECID, WGHT_PER, LUC_RST) 

travel_options <- c(12:21)

episodes_2005 <- gss_e_2005 %>% 
    dplyr::select(RECID, EPINO, ACTCODE, WGHT_EPI, PLACE, DURATION) %>% 
  left_join(gss_m_2005, by = 'RECID') %>% 
  filter(LUC_RST == 1) %>% 
  dplyr::select(RECID, EPINO, ACTCODE, WGHT_EPI, WGHT_PER, PLACE, DURATION, LUC_RST) %>% 
  arrange(RECID, EPINO) %>% 
  group_by(RECID) %>%
  mutate(origin = lag(PLACE)) %>% 
  ungroup() %>%
  mutate(omitted_case = PLACE != origin & 
           !PLACE %in% travel_options & 
           !origin %in% travel_options,
         reported_case = PLACE %in% travel_options) 

# EPS analysis 
omitted_cases_2005 <- episodes_2005 %>%
  filter(omitted_case == TRUE | reported_case == TRUE) %>% 
  dplyr::summarize(omitted_sum = sum(WGHT_EPI[omitted_case], na.rm = TRUE),
            reported_sum = sum(WGHT_EPI[reported_case], na.rm = TRUE),
            total_sum = omitted_sum + reported_sum,
            omitted_percent = round((omitted_sum/total_sum) * 100, 2))
```

```{r 1998-short-trips, include = FALSE}
# Episode File
gss_e_1998 <- read.csv(paste0(here(), "/data-raw/Time-use-1998/gss-12M0012-E-1998-c-12e_F1.csv")) # Original file

# Main File
gss_m_1998 <- read.csv(paste0(here(), "/data-raw/Time-use-1998/gss-12M0012-E-1998-c-12-m_F1.csv")) # Original file

gss_m_1998 <- gss_m_1998  %>%
  dplyr::select(RECID, WGHTFIN, CMAPRV) 

travel_options <- c(5:10)

episodes_1998 <- gss_e_1998 %>% 
    dplyr::select(RECID, EPINO, ACTCODE, WGHTEPI, PLACE, DURATION) %>% 
  left_join(gss_m_1998, by = 'RECID') %>% 
  filter(CMAPRV %in% c(6,8,11,13,15)) %>% 
  dplyr::select(RECID, EPINO, ACTCODE, WGHTEPI, WGHTFIN, PLACE, DURATION, CMAPRV) %>% 
  arrange(RECID, EPINO) %>% 
  group_by(RECID) %>%
  mutate(origin = lag(PLACE)) %>% 
  ungroup() %>%
  mutate(omitted_case = PLACE != origin & 
           !PLACE %in% travel_options & 
           !origin %in% travel_options,
         reported_case = PLACE %in% travel_options) 

# EPS analysis 
omitted_cases_1998 <- episodes_1998 %>%
  filter(omitted_case == TRUE | reported_case == TRUE) %>% 
  dplyr::summarize(omitted_sum = sum(WGHTEPI[omitted_case], na.rm = TRUE),
            reported_sum = sum(WGHTEPI[reported_case], na.rm = TRUE),
            total_sum = omitted_sum + reported_sum,
            omitted_percent = round((omitted_sum/total_sum) * 100, 2))
```


```{r 1992-short-trips, include = FALSE}
gss_e_1992 <- read.csv(paste0(here(), "/data-raw/Time-use-1992/gss-12M0007-E-1992-c-7-ep_F1.csv")) # Original file

# Main File
gss_m_1992 <- read.csv(paste0(here(), "/data-raw/Time-use-1992/gss-12M0007-E-1992-c-7-m_F1.csv")) # Original file

gss_m_1992 <- gss_m_1992  %>%
  dplyr::select(SEQNUM, FWGHT, DVCMA) 

travel_options <- c(5:10)

episodes_1992 <- gss_e_1992 %>% 
    dplyr::select(SEQNUM, NOEPISO, ACTCODE, TIMEWGT, PLACE, DURATION) %>% 
  left_join(gss_m_1992, by = 'SEQNUM') %>% 
  filter(DVCMA %in% c(6,8,11,13,15)) %>% 
  dplyr::select(SEQNUM, NOEPISO, ACTCODE, TIMEWGT, FWGHT, PLACE, DURATION, DVCMA) %>%
  arrange(SEQNUM, NOEPISO) %>% 
  group_by(SEQNUM) %>%
  mutate(origin = lag(PLACE)) %>% 
  ungroup() %>%
  mutate(omitted_case = PLACE != origin & 
           !PLACE %in% travel_options & 
           !origin %in% travel_options,
         reported_case = PLACE %in% travel_options) 

# EPS analysis 
omitted_cases_1992 <- episodes_1992 %>%
  filter(omitted_case == TRUE | reported_case == TRUE) %>% 
  dplyr::summarize(omitted_sum = sum(TIMEWGT[omitted_case], na.rm = TRUE),
            reported_sum = sum(TIMEWGT[reported_case], na.rm = TRUE),
            total_sum = omitted_sum + reported_sum,
            omitted_percent = round((omitted_sum/total_sum) * 100, 2))
```


# Summary and conclusion

The main objectives of this study were to provide an overview of AT in
Canadian metropolitan cities, focusing on main origins, destinations,
travel times and active population on terms of age group and sex, and to
identify appropriate impedance functions for AT modes across various
destinations and time periods. In this study we perform a direct
application of `ActiveCA` R package [@dossantos2025], analyzing over
13,500 cases of active travel trips that represented
`r format(gss_summary[gss_summary$Mode == 'Total',]$Total, big.mark = ",", scientific = FALSE)`
episodes, from the Time Use cycles of the General Social Survey (GSS)
from 1992 to 2022, covering a twelve different type of destinations and
considering walking and cycling as transportation modes.

<!-- episodes  -->

The rate of active trips per person with active record was around two
trips, with an increasing trend in active episodes per person being
observed for both walking and cycling. Historically, men+ recorded more
active episodes than women+, but in 2022 this trend reversed: men+
averaged 2.07 episodes, while women+ averaged 2.11. This change was
driven by a decrease in walking episodes among men+ (from 2.16 in 2015
to 2.07 in 2022) and an increase among women+ (from 1.92 to 2.11 in the
same period).

<!-- durations  -->

Our results show that the typical duration of walking trips increased to
15 minutes by 2022, following years of stability at 10 minutes. For
cycling, the typical duration rose to 30 minutes, recovering from a
decline that began in 1998 and lasted until 2010. Generally, walking
trips had consistently shorter durations than cycling trips. Although
this study does not explain the causes of these fluctuations, the
differences by year and mode were statistically significant.

When analyzed by gender, men+ increased their median cycling trip
duration from 15 minutes in 2005 to 30 minutes in 2022. Women+ increased
their median from 10 to 15 minutes. No gender differences were
identified in the duration of walking trips. When analyzing by age
groups, all of them increased their active travel times compared to
1992, especially for walking. For cycling, a marked increase in duration
emerged after 2010.

For both transportation modes trips to "Other's home" declined over
time, likely reflecting changing social behaviour enabled by technology
that allows people to stay connected without visiting in person. Walking
trips were predominantly associated with "Home" as either the origin or
destination. For cycling, the combination of "Home" and "Work or school"
accounted for the majority of trips. Walking trip durations to
"Restaurants" and "Outdoors" increased from 5 minutes in 2005 to 10
minutes in 2022. Travel to "Places of worship" also rose from 10 minutes
in 2005 to 20 minutes in 2022, tying with "Cultural venues" for the
highest typical walking travel time. Walking times to "Home" and "Work
or school" increased to 15 minutes in 2022, following three GSS cycles
where they remained stable at 10 minutes. For cycling, 2015 marked the
beginning of a trend toward longer travel times across nearly all
destinations.

<!-- share  -->

The share of the population with at least one recorded active trip
ranged from a low of 6.93% in 1998 to a peak of 15.06% in 2010. In the
most recent GSS survey (2022), participation dropped to 9.45%. Walking
dominated active trips, representing over 90% of all episodes.

<!--  About 84% of individuals who walked and 90% who cycled made only one trip. The maximum number of trips recorded by a single individual was 10 (in 1992, 2005, and 2010) for walking and 4 (in 2005) for cycling.  -->

Since 2010, the active population has declined for both genders, with a
steeper decrease among women+. This reversed a long-standing pattern in
which women+ had higher AT participation than men+. In 2022, men+ showed
higher prevalence than women+ regardless of mode, with 10.05% for men+
and 8.84% for women+. In summary, women+ made more active trips, while
men+ had higher overall participation in AT.

Regarding age cohorts, the youngest group (15 to 24 years) remained the
most active, with a prevalence of 21.47% in 2022. This was the only
group to show increased participation over the past decade, up from
17.91% in 2015. Generally, AT prevalence decreases with age. However, in
both 2005 and 2022, the oldest group (75 years and older) reported the
third-highest AT prevalence (7.02%) and showed a steady increase in
active episodes since 2010.

<!-- destinations  -->

The study underscores the importance of applying destination-specific
impedance functions when measuring cost decay effects in accessibility
analyses. To this end, we fitted 83 impedance functions for AT trips
over a 30-year period, considering destination types and transportation
modes. The results indicate that none of the fitted functions followed
an exponential distribution, suggesting that commonly used functions in
AT accessibility studies may not adequately capture actual behaviour -
especially for very short trips (under 5 minutes), which tend to be
overrepresented in these models. Destinations with many episodes were
best modeled using gamma functions, followed by lognormal and normal
distributions. In contrast, destinations with fewer than six episodes
were best represented by uniform distributions.

Harms also identified that the duration of travel episodes in the 2014
UK TUS is overestimated compared to the UK NTS, but the number of travel
episodes (sequences of trip stages) appears to be consistent with other
travel surveys. Despite the limitation of fixed time intervals, we
believe that TUS diaries offer valuable qualitative information.
Additionally, the detailed household and individual questionnaires
accompanying TUS provide rich data on socio-economic status, routine
behaviors, self-reported health, wellbeing, and attitudes. These data
could be further explored to gain deeper insights into mobility
patterns.

Given similarities in urbanization processes between Canada, the United
States, Australia, and West Europe, these findings may also be
applicable to metropolitan areas in those regions. Finally, this study
contributes to the ongoing discussion on AT, emphasizing its importance
in promoting sustainable transportation planning.

# CRediT authorship contribution statement {.unnumbered}

*(include after the review)*

# Funding sources {.unnumbered}

This research was funded through project *project name provided after
review)*, supported by the Social Sciences and Humanities Research
Council of Canada.

# Data availability {.unnumbered}

We updated the `ActiveCA` R Package to include the methodology to obtain
impedance functions from the raw data files (GSS surveys). Additionally,
we created this paper using literate programming in which the R markdown
code to fully reproduce this article is available on our GitHub
repository *(include after the review)*.

# Declaration of competing interest {.unnumbered}

The authors declare no conflicts of interest.

# Appendix {.unnumbered}

```{r kruskal-walking, include = FALSE, warning= FALSE, cache=TRUE}
result_kw <- data.frame()
anos_possiveis <- c("1992", "1998", "2005", "2010", "2015", "2022")
result_pw <- data.frame(matrix(ncol = length(anos_possiveis) + 2, nrow = 0))
colnames(result_pw) <- c(anos_possiveis, "Mode", "Destination")

for(mode in unique(gss_impedances_renamed$MODE)){
  
  for(destino in unique(gss_impedances_renamed[gss_impedances_renamed$MODE == mode, ]$dest_label)){
    
    subset <- gss_impedances_renamed[gss_impedances_renamed$MODE == mode & gss_impedances_renamed$dest_label == destino, ]
    
    if(length(unique(subset$YEAR)) > 1){
      
    subset <- subset %>% 
      uncount(weights = round(WGHT_EPI))

    kw <- kruskal.test(DURATION ~ YEAR, data = subset)
    
    pv_analise <- ifelse(kw$p.value <= 0.05, 'Significant', 'Not significant')
    
    kw_df <- data.frame("Mode" = mode, "Destination" = destino, "KWpvalue" = kw$p.value, "pvalue" = pv_analise)
    
    result_kw <- rbind(result_kw, kw_df)  
    
    if(kw$p.value <= 0.05){
      
      pw <- pairwise.wilcox.test(subset$DURATION, subset$YEAR, p.adjust.method = "bonferroni")
      
      pf_df <- as.data.frame(pw$p.value)

      for (ano in anos_possiveis) {
    if (!(ano %in% colnames(pf_df))) {
      pf_df[[ano]] <- NA  
    }
  }
  
  pf_df <- pf_df[, anos_possiveis, drop = FALSE]
  
  pf_df$Mode <- mode
  pf_df$Destination <- destino
  
  
  result_pw <- rbind(result_pw, pf_df)
    }
      
    }
  }
}

result_pw$Year <- substr(rownames(result_pw), 1, 4)
rownames(result_pw) <- NULL

result_pw_style <- result_pw %>%
  filter(rowSums(select(., `1992`:`2022`) <= 0.05, na.rm = TRUE) > 0)

result_pw_style <- result_pw_style[, colSums(!is.na(result_pw_style)) > 0]

result_pw_style <- result_pw_style[,c("Mode","Destination","Year","1992","1998","2005","2010","2015")]

# result_pw_style <- result_pw_style %>%
#   mutate(across(where(is.numeric), ~ ifelse(. > 0.05, NA, .)))

# result_pw_style <- result_pw_style %>%
#   mutate(across(where(is.numeric), ~ sprintf("%.2e", .x)))

result_pw_style <- result_pw_style %>%
  mutate(across(all_of(c("1992","1998","2005","2010","2015")),
                ~ ifelse(is.na(.x), "", formatC(.x, format = "e", digits = 2)))) 

table_stats <- result_pw_style %>%
  kable(format = "latex",
        booktabs = TRUE,
        longtable = TRUE,
        caption = paste0("\\label{tab:result-stats}P-values of the pairwise Wilcoxon test.")) %>% 
  kable_styling(full_width = FALSE, 
                latex_options = c("scale_down"),
                font_size = 8) %>%
  collapse_rows(columns = 1, valign = "top", latex_hline = "major") %>%
  kable_styling(latex_options = "HOLD_position")
```

\renewcommand{\thetable}{A.1}

```{r pvalues-table,echo=FALSE, cache=FALSE, warning=FALSE}

table_stats
```

\renewcommand{\thetable}{A.2}

```{r walking_functions_table,echo=FALSE, cache=FALSE, warning=FALSE}

walking_functions_table
```

\renewcommand{\thetable}{A.3}

```{r biking_functions_table,echo=FALSE, cache=FALSE, warning=FALSE}

biking_functions_table
```

# References {.unnumbered}
